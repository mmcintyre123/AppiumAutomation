require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _this = this;

var _ = require('../..');

var _libSimulatorXcode6 = require('../../lib/simulator-xcode-6');

var _libSimulatorXcode62 = _interopRequireDefault(_libSimulatorXcode6);

var _libSimulatorXcode7 = require('../../lib/simulator-xcode-7');

var _libSimulatorXcode72 = _interopRequireDefault(_libSimulatorXcode7);

var _nodeSimctl = require('node-simctl');

var simctl = _interopRequireWildcard(_nodeSimctl);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _assetsDeviceList = require('../assets/deviceList');

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _appiumXcode = require('appium-xcode');

var _appiumXcode2 = _interopRequireDefault(_appiumXcode);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var UDID = _assetsDeviceList.devices['7.1'][0].udid;

describe('simulator', function () {
  var xcodeMock = undefined;
  var getDevicesStub = undefined;

  beforeEach(function () {
    xcodeMock = _sinon2['default'].mock(_appiumXcode2['default']);
    getDevicesStub = _sinon2['default'].stub(simctl, 'getDevices');
    getDevicesStub.returns(_bluebird2['default'].resolve(_assetsDeviceList.devices));
  });
  afterEach(function () {
    xcodeMock.restore();
    simctl.getDevices.restore();
  });

  describe('getSimulator', function () {
    it('should create a simulator with default xcode version', function callee$2$0() {
      var xcodeVersion, sim;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeVersion = { major: 6, versionString: '6.0.0' };

            xcodeMock.expects('getVersion').returns(_bluebird2['default'].resolve(xcodeVersion));

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(UDID));

          case 4:
            sim = context$3$0.sent;

            sim.xcodeVersion.should.equal(xcodeVersion);
            sim.should.be.an['instanceof'](_libSimulatorXcode62['default']);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should create an xcode 7 simulator with xcode version 7', function callee$2$0() {
      var xcodeVersion, sim;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeVersion = { major: 7, versionString: '7.0.0' };

            xcodeMock.expects('getVersion').returns(_bluebird2['default'].resolve(xcodeVersion));

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(UDID));

          case 4:
            sim = context$3$0.sent;

            sim.xcodeVersion.should.equal(xcodeVersion);
            sim.should.be.an['instanceof'](_libSimulatorXcode72['default']);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should throw an error if xcode version less than 6', function callee$2$0() {
      var xcodeVersion;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeVersion = { major: 5, versionString: '5.4.0' };

            xcodeMock.expects('getVersion').returns(_bluebird2['default'].resolve(xcodeVersion));

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(UDID).should.eventually.be.rejectedWith('version'));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should throw an error if xcode version above 8', function callee$2$0() {
      var xcodeVersion;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeVersion = { major: 9, versionString: '9.0.0' };

            xcodeMock.expects('getVersion').returns(_bluebird2['default'].resolve(xcodeVersion));

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap((0, _.getSimulator)(UDID).should.eventually.be.rejectedWith('not yet'));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should throw an error if udid does not exist', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _.getSimulator)('123').should.be.rejectedWith('No sim found'));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should list stats for sim', function callee$2$0() {
      var xcodeVersion, sims, stats;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            xcodeVersion = { major: 6, versionString: '6.0.0' };

            xcodeMock.expects('getVersion').atLeast(1).returns(_bluebird2['default'].resolve(xcodeVersion));

            sims = [(0, _.getSimulator)('F33783B2-9EE9-4A99-866E-E126ADBAD410'), (0, _.getSimulator)('DFBC2970-9455-4FD9-BB62-9E4AE5AA6954')];
            stats = sims.map(function (simProm) {
              return simProm.then(function (sim) {
                // eslint-disable-line promise/prefer-await-to-then
                return sim.stat();
              });
            });
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_bluebird2['default'].all(stats));

          case 6:
            stats = context$3$0.sent;

            stats[0].state.should.equal('Shutdown');
            stats[0].name.should.equal('Resizable iPhone');
            stats[1].state.should.equal('Shutdown');
            stats[1].name.should.equal('Resizable iPad');

          case 11:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('getDeviceString', function () {
    describe('Xcode 6', function () {
      var xcodeVersion = { major: 6, versionString: '6.0.0' };

      beforeEach(function () {
        xcodeMock.expects('getVersion').returns(_bluebird2['default'].resolve(xcodeVersion));
      });

      it('should get the correct device for iOS 8+', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve(8.4));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)());

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.4 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 8+ when platform version passed in', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ platformVersion: '8.1' }));

            case 2:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.1 Simulator)');

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 7+', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve(7.1));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)());

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 5s (7.1 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 7+ when platform version passed in', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ platformVersion: '7.1' }));

            case 2:
              device = context$4$0.sent;

              device.should.equal('iPhone 5s (7.1 Simulator)');

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should pass through device name when passed with =', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve(8.4));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: '=fancy device' }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('fancy device');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should add a device name when passed without =', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve(8.4));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: 'fancy device' }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('fancy device (8.4 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should handle string platform version', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve('8.4'));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)());

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.4 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should strip " Simulator" when not necessary', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve('8.4'));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: "iPhone 6 Simulator" }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.4 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should handle bare "iPhone"', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve('8.4'));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: "iPhone" }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.4 Simulator)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });

    describe('Xcode 7', function () {
      var xcodeVersion = { major: 7, versionString: '7.0.0' };

      beforeEach(function () {
        xcodeMock.expects('getVersion').returns(_bluebird2['default'].resolve(xcodeVersion));
      });

      it('should get the correct device for iOS 8+', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve(8.4));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)());

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.4)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 8+ when platform version passed in', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(_libSimulatorXcode72['default'].getDeviceString({ platformVersion: '8.1' }));

            case 2:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (8.1)');

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 9+', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve(9));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)());

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (9.0) [');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should get the correct device for iOS 9+ when platform version passed in', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ platformVersion: '9.0' }));

            case 2:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (9.0) [');

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should pass through device name when passed with =', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve(9.0));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: '=fancy device' }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('fancy device');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should add a device name when passed without =', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve(9.0));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: 'fancy device' }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('fancy device (9.0)');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should strip " Simulator" when not necessary', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve('9.0'));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: "iPhone 6 Simulator" }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (9.0) [');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      it('should handle bare "iPhone"', function callee$3$0() {
        var device;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              xcodeMock.expects('getMaxIOSSDK').returns(_bluebird2['default'].resolve('9.0'));
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap((0, _.getDeviceString)({ deviceName: "iPhone" }));

            case 3:
              device = context$4$0.sent;

              device.should.equal('iPhone 6 (9.0) [');

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9zaW11bGF0b3Itc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O2dCQUU4QyxPQUFPOztrQ0FDekIsNkJBQTZCOzs7O2tDQUM3Qiw2QkFBNkI7Ozs7MEJBQ2pDLGFBQWE7O0lBQXpCLE1BQU07O29CQUNELE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3FCQUMzQixPQUFPOzs7O2dDQUNELHNCQUFzQjs7d0JBQ2hDLFVBQVU7Ozs7MkJBQ04sY0FBYzs7OztBQUVoQyxrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUNkLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0FBRXpCLElBQU0sSUFBSSxHQUFHLDBCQUFRLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQzs7QUFFcEMsUUFBUSxDQUFDLFdBQVcsRUFBRSxZQUFNO0FBQzFCLE1BQUksU0FBUyxZQUFBLENBQUM7QUFDZCxNQUFJLGNBQWMsWUFBQSxDQUFDOztBQUVuQixZQUFVLENBQUMsWUFBTTtBQUNmLGFBQVMsR0FBRyxtQkFBTSxJQUFJLDBCQUFPLENBQUM7QUFDOUIsa0JBQWMsR0FBRyxtQkFBTSxJQUFJLENBQUMsTUFBTSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBQ2xELGtCQUFjLENBQUMsT0FBTyxDQUFDLHNCQUFFLE9BQU8sMkJBQVMsQ0FBQyxDQUFDO0dBQzVDLENBQUMsQ0FBQztBQUNILFdBQVMsQ0FBQyxZQUFNO0FBQ2QsYUFBUyxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ3BCLFVBQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7R0FDN0IsQ0FBQyxDQUFDOztBQUVILFVBQVEsQ0FBQyxjQUFjLEVBQUUsWUFBTTtBQUM3QixNQUFFLENBQUMsc0RBQXNELEVBQUU7VUFDckQsWUFBWSxFQUdaLEdBQUc7Ozs7QUFISCx3QkFBWSxHQUFHLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxhQUFhLEVBQUUsT0FBTyxFQUFDOztBQUNy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Q0FBQzs7K0NBQ3pDLHVCQUFnQixFQUFDLFVBQVUsRUFBRSxvQkFBb0IsRUFBQyxDQUFDOzs7QUFBbEUsb0JBQU07O0FBQ1Ysb0JBQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7Ozs7Ozs7T0FDekMsQ0FBQyxDQUFDO0FBQ0gsUUFBRSxDQUFDLDZCQUE2QixFQUFFO1lBRTVCLE1BQU07Ozs7QUFEVix1QkFBUyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQyxPQUFPLENBQUMsc0JBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7OytDQUN6Qyx1QkFBZ0IsRUFBQyxVQUFVLEVBQUUsUUFBUSxFQUFDLENBQUM7OztBQUF0RCxvQkFBTTs7QUFDVixvQkFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQzs7Ozs7OztPQUN6QyxDQUFDLENBQUM7S0FDSixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC91bml0L3NpbXVsYXRvci1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRyYW5zcGlsZTptb2NoYVxuXG5pbXBvcnQgeyBnZXRTaW11bGF0b3IsIGdldERldmljZVN0cmluZyB9IGZyb20gJy4uLy4uJztcbmltcG9ydCBTaW11bGF0b3JYY29kZTYgZnJvbSAnLi4vLi4vbGliL3NpbXVsYXRvci14Y29kZS02JztcbmltcG9ydCBTaW11bGF0b3JYY29kZTcgZnJvbSAnLi4vLi4vbGliL3NpbXVsYXRvci14Y29kZS03JztcbmltcG9ydCAqIGFzIHNpbWN0bCBmcm9tICdub2RlLXNpbWN0bCc7XG5pbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgeyBkZXZpY2VzIH0gZnJvbSAnLi4vYXNzZXRzL2RldmljZUxpc3QnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHhjb2RlIGZyb20gJ2FwcGl1bS14Y29kZSc7XG5cbmNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cbmNvbnN0IFVESUQgPSBkZXZpY2VzWyc3LjEnXVswXS51ZGlkO1xuXG5kZXNjcmliZSgnc2ltdWxhdG9yJywgKCkgPT4ge1xuICBsZXQgeGNvZGVNb2NrO1xuICBsZXQgZ2V0RGV2aWNlc1N0dWI7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgeGNvZGVNb2NrID0gc2lub24ubW9jayh4Y29kZSk7XG4gICAgZ2V0RGV2aWNlc1N0dWIgPSBzaW5vbi5zdHViKHNpbWN0bCwgJ2dldERldmljZXMnKTtcbiAgICBnZXREZXZpY2VzU3R1Yi5yZXR1cm5zKEIucmVzb2x2ZShkZXZpY2VzKSk7XG4gIH0pO1xuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIHhjb2RlTW9jay5yZXN0b3JlKCk7XG4gICAgc2ltY3RsLmdldERldmljZXMucmVzdG9yZSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U2ltdWxhdG9yJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgc2ltdWxhdG9yIHdpdGggZGVmYXVsdCB4Y29kZSB2ZXJzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHhjb2RlVmVyc2lvbiA9IHttYWpvcjogNiwgdmVyc2lvblN0cmluZzogJzYuMC4wJ307XG4gICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0VmVyc2lvbicpLnJldHVybnMoQi5yZXNvbHZlKHhjb2RlVmVyc2lvbikpO1xuXG4gICAgICBsZXQgc2ltID0gYXdhaXQgZ2V0U2ltdWxhdG9yKFVESUQpO1xuICAgICAgc2ltLnhjb2RlVmVyc2lvbi5zaG91bGQuZXF1YWwoeGNvZGVWZXJzaW9uKTtcbiAgICAgIHNpbS5zaG91bGQuYmUuYW4uaW5zdGFuY2VvZihTaW11bGF0b3JYY29kZTYpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW4geGNvZGUgNyBzaW11bGF0b3Igd2l0aCB4Y29kZSB2ZXJzaW9uIDcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgeGNvZGVWZXJzaW9uID0ge21ham9yOiA3LCB2ZXJzaW9uU3RyaW5nOiAnNy4wLjAnfTtcbiAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRWZXJzaW9uJykucmV0dXJucyhCLnJlc29sdmUoeGNvZGVWZXJzaW9uKSk7XG5cbiAgICAgIGxldCBzaW0gPSBhd2FpdCBnZXRTaW11bGF0b3IoVURJRCk7XG4gICAgICBzaW0ueGNvZGVWZXJzaW9uLnNob3VsZC5lcXVhbCh4Y29kZVZlcnNpb24pO1xuICAgICAgc2ltLnNob3VsZC5iZS5hbi5pbnN0YW5jZW9mKFNpbXVsYXRvclhjb2RlNyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIGlmIHhjb2RlIHZlcnNpb24gbGVzcyB0aGFuIDYnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgeGNvZGVWZXJzaW9uID0ge21ham9yOiA1LCB2ZXJzaW9uU3RyaW5nOiAnNS40LjAnfTtcbiAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRWZXJzaW9uJykucmV0dXJucyhCLnJlc29sdmUoeGNvZGVWZXJzaW9uKSk7XG5cbiAgICAgIGF3YWl0IGdldFNpbXVsYXRvcihVRElEKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoJ3ZlcnNpb24nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3IgaWYgeGNvZGUgdmVyc2lvbiBhYm92ZSA4JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHhjb2RlVmVyc2lvbiA9IHttYWpvcjogOSwgdmVyc2lvblN0cmluZzogJzkuMC4wJ307XG4gICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0VmVyc2lvbicpLnJldHVybnMoQi5yZXNvbHZlKHhjb2RlVmVyc2lvbikpO1xuXG4gICAgICBhd2FpdCBnZXRTaW11bGF0b3IoVURJRCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKCdub3QgeWV0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIGlmIHVkaWQgZG9lcyBub3QgZXhpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBnZXRTaW11bGF0b3IoJzEyMycpLnNob3VsZC5iZS5yZWplY3RlZFdpdGgoJ05vIHNpbSBmb3VuZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsaXN0IHN0YXRzIGZvciBzaW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgeGNvZGVWZXJzaW9uID0ge21ham9yOiA2LCB2ZXJzaW9uU3RyaW5nOiAnNi4wLjAnfTtcbiAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRWZXJzaW9uJykuYXRMZWFzdCgxKS5yZXR1cm5zKEIucmVzb2x2ZSh4Y29kZVZlcnNpb24pKTtcblxuICAgICAgbGV0IHNpbXMgPSBbXG4gICAgICAgIGdldFNpbXVsYXRvcignRjMzNzgzQjItOUVFOS00QTk5LTg2NkUtRTEyNkFEQkFENDEwJyksXG4gICAgICAgIGdldFNpbXVsYXRvcignREZCQzI5NzAtOTQ1NS00RkQ5LUJCNjItOUU0QUU1QUE2OTU0JyksXG4gICAgICBdO1xuXG4gICAgICBsZXQgc3RhdHMgPSBzaW1zLm1hcCgoc2ltUHJvbSkgPT4ge1xuICAgICAgICByZXR1cm4gc2ltUHJvbS50aGVuKChzaW0pID0+IHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by10aGVuXG4gICAgICAgICAgcmV0dXJuIHNpbS5zdGF0KCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHN0YXRzID0gYXdhaXQgQi5hbGwoc3RhdHMpO1xuXG4gICAgICBzdGF0c1swXS5zdGF0ZS5zaG91bGQuZXF1YWwoJ1NodXRkb3duJyk7XG4gICAgICBzdGF0c1swXS5uYW1lLnNob3VsZC5lcXVhbCgnUmVzaXphYmxlIGlQaG9uZScpO1xuICAgICAgc3RhdHNbMV0uc3RhdGUuc2hvdWxkLmVxdWFsKCdTaHV0ZG93bicpO1xuICAgICAgc3RhdHNbMV0ubmFtZS5zaG91bGQuZXF1YWwoJ1Jlc2l6YWJsZSBpUGFkJyk7XG4gICAgfSk7XG4gIH0pO1xuXG5cbiAgZGVzY3JpYmUoJ2dldERldmljZVN0cmluZycsICgpID0+IHtcbiAgICBkZXNjcmliZSgnWGNvZGUgNicsICgpID0+IHtcbiAgICAgIGxldCB4Y29kZVZlcnNpb24gPSB7bWFqb3I6IDYsIHZlcnNpb25TdHJpbmc6ICc2LjAuMCd9O1xuXG4gICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldFZlcnNpb24nKS5yZXR1cm5zKEIucmVzb2x2ZSh4Y29kZVZlcnNpb24pKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGdldCB0aGUgY29ycmVjdCBkZXZpY2UgZm9yIGlPUyA4KycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldE1heElPU1NESycpLnJldHVybnMoQi5yZXNvbHZlKDguNCkpO1xuICAgICAgICBsZXQgZGV2aWNlID0gYXdhaXQgZ2V0RGV2aWNlU3RyaW5nKCk7XG4gICAgICAgIGRldmljZS5zaG91bGQuZXF1YWwoJ2lQaG9uZSA2ICg4LjQgU2ltdWxhdG9yKScpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIGdldCB0aGUgY29ycmVjdCBkZXZpY2UgZm9yIGlPUyA4KyB3aGVuIHBsYXRmb3JtIHZlcnNpb24gcGFzc2VkIGluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgZGV2aWNlID0gYXdhaXQgZ2V0RGV2aWNlU3RyaW5nKHtwbGF0Zm9ybVZlcnNpb246ICc4LjEnfSk7XG4gICAgICAgIGRldmljZS5zaG91bGQuZXF1YWwoJ2lQaG9uZSA2ICg4LjEgU2ltdWxhdG9yKScpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIGdldCB0aGUgY29ycmVjdCBkZXZpY2UgZm9yIGlPUyA3KycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldE1heElPU1NESycpLnJldHVybnMoQi5yZXNvbHZlKDcuMSkpO1xuICAgICAgICBsZXQgZGV2aWNlID0gYXdhaXQgZ2V0RGV2aWNlU3RyaW5nKCk7XG4gICAgICAgIGRldmljZS5zaG91bGQuZXF1YWwoJ2lQaG9uZSA1cyAoNy4xIFNpbXVsYXRvciknKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBnZXQgdGhlIGNvcnJlY3QgZGV2aWNlIGZvciBpT1MgNysgd2hlbiBwbGF0Zm9ybSB2ZXJzaW9uIHBhc3NlZCBpbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IGdldERldmljZVN0cmluZyh7cGxhdGZvcm1WZXJzaW9uOiAnNy4xJ30pO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdpUGhvbmUgNXMgKDcuMSBTaW11bGF0b3IpJyk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgcGFzcyB0aHJvdWdoIGRldmljZSBuYW1lIHdoZW4gcGFzc2VkIHdpdGggPScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldE1heElPU1NESycpLnJldHVybnMoQi5yZXNvbHZlKDguNCkpO1xuICAgICAgICBsZXQgZGV2aWNlID0gYXdhaXQgZ2V0RGV2aWNlU3RyaW5nKHtkZXZpY2VOYW1lOiAnPWZhbmN5IGRldmljZSd9KTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnZmFuY3kgZGV2aWNlJyk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgYWRkIGEgZGV2aWNlIG5hbWUgd2hlbiBwYXNzZWQgd2l0aG91dCA9JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0TWF4SU9TU0RLJykucmV0dXJucyhCLnJlc29sdmUoOC40KSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoe2RldmljZU5hbWU6ICdmYW5jeSBkZXZpY2UnfSk7XG4gICAgICAgIGRldmljZS5zaG91bGQuZXF1YWwoJ2ZhbmN5IGRldmljZSAoOC40IFNpbXVsYXRvciknKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgc3RyaW5nIHBsYXRmb3JtIHZlcnNpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRNYXhJT1NTREsnKS5yZXR1cm5zKEIucmVzb2x2ZSgnOC40JykpO1xuICAgICAgICBsZXQgZGV2aWNlID0gYXdhaXQgZ2V0RGV2aWNlU3RyaW5nKCk7XG4gICAgICAgIGRldmljZS5zaG91bGQuZXF1YWwoJ2lQaG9uZSA2ICg4LjQgU2ltdWxhdG9yKScpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIHN0cmlwIFwiIFNpbXVsYXRvclwiIHdoZW4gbm90IG5lY2Vzc2FyeScsIGFzeW5jICgpID0+IHtcbiAgICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldE1heElPU1NESycpLnJldHVybnMoQi5yZXNvbHZlKCc4LjQnKSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoe2RldmljZU5hbWU6IFwiaVBob25lIDYgU2ltdWxhdG9yXCJ9KTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDYgKDguNCBTaW11bGF0b3IpJyk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGJhcmUgXCJpUGhvbmVcIicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldE1heElPU1NESycpLnJldHVybnMoQi5yZXNvbHZlKCc4LjQnKSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoe2RldmljZU5hbWU6IFwiaVBob25lXCJ9KTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDYgKDguNCBTaW11bGF0b3IpJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdYY29kZSA3JywgKCkgPT4ge1xuICAgICAgbGV0IHhjb2RlVmVyc2lvbiA9IHttYWpvcjogNywgdmVyc2lvblN0cmluZzogJzcuMC4wJ307XG5cbiAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0VmVyc2lvbicpLnJldHVybnMoQi5yZXNvbHZlKHhjb2RlVmVyc2lvbikpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgZ2V0IHRoZSBjb3JyZWN0IGRldmljZSBmb3IgaU9TIDgrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0TWF4SU9TU0RLJykucmV0dXJucyhCLnJlc29sdmUoOC40KSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoKTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDYgKDguNCknKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBnZXQgdGhlIGNvcnJlY3QgZGV2aWNlIGZvciBpT1MgOCsgd2hlbiBwbGF0Zm9ybSB2ZXJzaW9uIHBhc3NlZCBpbicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IFNpbXVsYXRvclhjb2RlNy5nZXREZXZpY2VTdHJpbmcoe3BsYXRmb3JtVmVyc2lvbjogJzguMSd9KTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDYgKDguMSknKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBnZXQgdGhlIGNvcnJlY3QgZGV2aWNlIGZvciBpT1MgOSsnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRNYXhJT1NTREsnKS5yZXR1cm5zKEIucmVzb2x2ZSg5KSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoKTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDYgKDkuMCkgWycpO1xuICAgICAgfSk7XG4gICAgICBpdCgnc2hvdWxkIGdldCB0aGUgY29ycmVjdCBkZXZpY2UgZm9yIGlPUyA5KyB3aGVuIHBsYXRmb3JtIHZlcnNpb24gcGFzc2VkIGluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgZGV2aWNlID0gYXdhaXQgZ2V0RGV2aWNlU3RyaW5nKHtwbGF0Zm9ybVZlcnNpb246ICc5LjAnfSk7XG4gICAgICAgIGRldmljZS5zaG91bGQuZXF1YWwoJ2lQaG9uZSA2ICg5LjApIFsnKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBwYXNzIHRocm91Z2ggZGV2aWNlIG5hbWUgd2hlbiBwYXNzZWQgd2l0aCA9JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0TWF4SU9TU0RLJykucmV0dXJucyhCLnJlc29sdmUoOS4wKSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoe2RldmljZU5hbWU6ICc9ZmFuY3kgZGV2aWNlJ30pO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdmYW5jeSBkZXZpY2UnKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBhZGQgYSBkZXZpY2UgbmFtZSB3aGVuIHBhc3NlZCB3aXRob3V0ID0nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHhjb2RlTW9jay5leHBlY3RzKCdnZXRNYXhJT1NTREsnKS5yZXR1cm5zKEIucmVzb2x2ZSg5LjApKTtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IGdldERldmljZVN0cmluZyh7ZGV2aWNlTmFtZTogJ2ZhbmN5IGRldmljZSd9KTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnZmFuY3kgZGV2aWNlICg5LjApJyk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgc3RyaXAgXCIgU2ltdWxhdG9yXCIgd2hlbiBub3QgbmVjZXNzYXJ5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICB4Y29kZU1vY2suZXhwZWN0cygnZ2V0TWF4SU9TU0RLJykucmV0dXJucyhCLnJlc29sdmUoJzkuMCcpKTtcbiAgICAgICAgbGV0IGRldmljZSA9IGF3YWl0IGdldERldmljZVN0cmluZyh7ZGV2aWNlTmFtZTogXCJpUGhvbmUgNiBTaW11bGF0b3JcIn0pO1xuICAgICAgICBkZXZpY2Uuc2hvdWxkLmVxdWFsKCdpUGhvbmUgNiAoOS4wKSBbJyk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGJhcmUgXCJpUGhvbmVcIicsIGFzeW5jICgpID0+IHtcbiAgICAgICAgeGNvZGVNb2NrLmV4cGVjdHMoJ2dldE1heElPU1NESycpLnJldHVybnMoQi5yZXNvbHZlKCc5LjAnKSk7XG4gICAgICAgIGxldCBkZXZpY2UgPSBhd2FpdCBnZXREZXZpY2VTdHJpbmcoe2RldmljZU5hbWU6IFwiaVBob25lXCJ9KTtcbiAgICAgICAgZGV2aWNlLnNob3VsZC5lcXVhbCgnaVBob25lIDYgKDkuMCkgWycpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
