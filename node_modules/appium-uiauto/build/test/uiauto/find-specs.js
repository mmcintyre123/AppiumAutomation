require('source-map-support').install();

/* globals $, rootPage */

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _base = require('./base');

describe('find', function () {
  var _this2 = this;

  (0, _base.globalInit)(this, { chai: true });

  describe("textfields", function () {
    var _this = this;

    var ctx = undefined;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.instrumentsInstanceInit)());

          case 2:
            ctx = context$3$0.sent;

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    after(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.killAll)(ctx));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    afterEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              $('#UICatalog').first().tap();
              $.delay(1000);
            }));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should not return duplicate UIATextField', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var cell = $('cell')[0];
              var id = '' + $.getId(cell);
              var res = $.getElementsByType('UIATextField', id);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should not return duplicate UIASecureTextField', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var cell = $('cell')[2];
              var id = '' + $.getId(cell);
              var res = $.getElementsByType('UIASecureTextField', id);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('byUIAutomation', function () {
    var ctx = undefined;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.instrumentsInstanceInit)());

          case 2:
            ctx = context$3$0.sent;

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
    after(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.killAll)(ctx));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    afterEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              $('#UICatalog').first().tap();
              $.delay(1000);
            }));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should use global context by default', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var res = $.getElementsByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)');
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(5);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should eval the raw code if it does not start with a dot', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var res = $.getElementsByUIAutomation('$.getElementByType(\'UIATableCell\').getAllWithPredicate("type contains[c] \'textfield\'", true)');
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should retrieve context from cache when ctx param is a string', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var parent = $.getElementByType('UIATableCell');
              var parentId = $.getId(parent);
              var res = $.getElementsByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parentId);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should use context when ctx param is an object', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var parent = $.getElementByType('UIATableCell');
              var res = $.getElementsByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parent);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should work when retrieving only one element', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var res = [],
                  parent,
                  el;
              el = $.getElementByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)');
              res.push(el);

              el = $.getElementByUIAutomation('$.getElementByType(\'UIATableCell\').getAllWithPredicate("type contains[c] \'textfield\'", true)');
              res.push(el);

              parent = $.getElementsByType('UIATableCell')[1];
              var parentId = $.getId(parent);
              el = $.getElementByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parentId);
              res.push(el);

              parent = $.getElementsByType('UIATableCell')[2];
              el = $.getElementByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parent);
              res.push(el);

              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(4);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdWlhdXRvL2ZpbmQtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztvQkFHNkQsUUFBUTs7QUFFckUsUUFBUSxDQUFDLE1BQU0sRUFBRSxZQUFZOzs7QUFDM0Isd0JBQVcsSUFBSSxFQUFFLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7O0FBRS9CLFVBQVEsQ0FBQyxZQUFZLEVBQUUsWUFBWTs7O0FBQ2pDLFFBQUksR0FBRyxZQUFBLENBQUM7QUFDUixVQUFNLENBQUM7Ozs7OzZDQUNPLG9DQUF5Qjs7O0FBQXJDLGVBQUc7Ozs7Ozs7S0FDSixDQUFDLENBQUM7QUFDSCxTQUFLLENBQUM7Ozs7OzZDQUNFLG1CQUFRLEdBQUcsQ0FBQzs7Ozs7OztLQUNuQixDQUFDLENBQUM7O0FBRUgsYUFBUyxDQUFDOzs7Ozs2Q0FDRixHQUFHLENBQUMsUUFBUSxDQUNoQixZQUFZO0FBQ1YsZUFBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQzlCLGVBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDZixDQUNGOzs7Ozs7O0tBQ0YsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQywwQ0FBMEMsRUFBRTtVQUN6QyxHQUFHOzs7Ozs2Q0FBUyxHQUFHLENBQUMsUUFBUSxDQUMxQixZQUFZO0FBQ1Ysc0JBQVEsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDdEMsZUFBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNkLGtCQUFJLElBQUksR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDeEIsa0JBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzVCLGtCQUFJLEdBQUcsR0FBRyxDQUFDLENBQUMsaUJBQWlCLENBQUMsY0FBYyxFQUFFLEVB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LENBQUM7QUFDRixpQkFBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQzs7QUFFYixxQkFBTyxHQUFHLENBQUM7YUFDWixDQUNGOzs7QUE5QkcsZUFBRzs7QUErQlAsZUFBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFCLGVBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQzs7Ozs7OztLQUM3QixDQUFDLENBQUM7R0FFSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC91aWF1dG8vZmluZC1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRyYW5zcGlsZTptb2NoYVxuLyogZ2xvYmFscyAkLCByb290UGFnZSAqL1xuXG5pbXBvcnQgeyBpbnN0cnVtZW50c0luc3RhbmNlSW5pdCwgZ2xvYmFsSW5pdCwga2lsbEFsbCB9IGZyb20gJy4vYmFzZSc7XG5cbmRlc2NyaWJlKCdmaW5kJywgZnVuY3Rpb24gKCkge1xuICBnbG9iYWxJbml0KHRoaXMsIHtjaGFpOiB0cnVlfSk7XG5cbiAgZGVzY3JpYmUoXCJ0ZXh0ZmllbGRzXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgY3R4O1xuICAgIGJlZm9yZShhc3luYyAoKSA9PiB7XG4gICAgICBjdHggPSBhd2FpdCBpbnN0cnVtZW50c0luc3RhbmNlSW5pdCgpO1xuICAgIH0pO1xuICAgIGFmdGVyKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGtpbGxBbGwoY3R4KTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBjdHguZXhlY0Z1bmMoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAkKCcjVUlDYXRhbG9nJykuZmlyc3QoKS50YXAoKTtcbiAgICAgICAgICAkLmRlbGF5KDEwMDApO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgcmV0dXJuIGR1cGxpY2F0ZSBVSUFUZXh0RmllbGQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcmVzID0gYXdhaXQgY3R4LmV4ZWNGdW5jKFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcm9vdFBhZ2UuY2xpY2tNZW51SXRlbSgnVGV4dCBGaWVsZHMnKTtcbiAgICAgICAgICAkLmRlbGF5KDIwMDApO1xuICAgICAgICAgIHZhciBjZWxsID0gJCgnY2VsbCcpWzBdO1xuICAgICAgICAgIHZhciBpZCA9ICcnICsgJC5nZXRJZChjZWxsKTtcbiAgICAgICAgICB2YXIgcmVzID0gJC5nZXRFbGVtZW50c0J5VHlwZSgnVUlBVGV4dEZpZWxkJywgaWQpO1xuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXMuc2hvdWxkLmhhdmUubGVuZ3RoKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgcmV0dXJuIGR1cGxpY2F0ZSBVSUFTZWN1cmVUZXh0RmllbGQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcmVzID0gYXdhaXQgY3R4LmV4ZWNGdW5jKFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcm9vdFBhZ2UuY2xpY2tNZW51SXRlbSgnVGV4dCBGaWVsZHMnKTtcbiAgICAgICAgICAkLmRlbGF5KDIwMDApO1xuICAgICAgICAgIHZhciBjZWxsID0gJCgnY2VsbCcpWzJdO1xuICAgICAgICAgIHZhciBpZCA9ICcnICsgJC5nZXRJZChjZWxsKTtcbiAgICAgICAgICB2YXIgcmVzID0gJC5nZXRFbGVtZW50c0J5VHlwZSgnVUlBU2VjdXJlVGV4dEZpZWxkJywgaWQpO1xuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXMuc2hvdWxkLmhhdmUubGVuZ3RoKDEpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdieVVJQXV0b21hdGlvbicsICgpID0+IHtcbiAgICBsZXQgY3R4O1xuICAgIGJlZm9yZShhc3luYyAoKSA9PiB7XG4gICAgICBjdHggPSBhd2FpdCBpbnN0cnVtZW50c0luc3RhbmNlSW5pdCgpO1xuICAgIH0pO1xuICAgIGFmdGVyKGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGtpbGxBbGwoY3R4KTtcbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBjdHguZXhlY0Z1bmMoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAkKCcjVUlDYXRhbG9nJykuZmlyc3QoKS50YXAoKTtcbiAgICAgICAgICAkLmRlbGF5KDEwMDApO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgZ2xvYmFsIGNvbnRleHQgYnkgZGVmYXVsdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCByZXMgPSBhd2FpdCBjdHguZXhlY0Z1bmMoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByb290UGFnZS5jbGlja01lbnVJdGVtKCdUZXh0IEZpZWxkcycpO1xuICAgICAgICAgICQuZGVsYXkoMjAwMCk7XG4gICAgICAgICAgdmFyIHJlcyA9ICQuZ2V0RWxlbWVudHNCeVVJQXV0b21hdGlvbignLmdldEFsbFdpdGhQcmVkaWNhdGUoXCJ0eXBlIGNvbnRhaW5zW2NdIFxcJ3RleHRmaWVsZFxcJ1wiLCB0cnVlKScpO1xuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXMuc2hvdWxkLmhhdmUubGVuZ3RoKDUpO1xuICAgICAgcmVzWzBdLkVMRU1FTlQuc2hvdWxkLmV4aXN0O1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBldmFsIHRoZSByYXcgY29kZSBpZiBpdCBkb2VzIG5vdCBzdGFydCB3aXRoIGEgZG90JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGN0eC5leGVjRnVuYyhcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJvb3RQYWdlLmNsaWNrTWVudUl0ZW0oJ1RleHQgRmllbGRzJyk7XG4gICAgICAgICAgJC5kZWxheSgyMDAwKTtcbiAgICAgICAgICB2YXIgcmVzID0gJC5nZXRFbGVtZW50c0J5VUlBdXRvbWF0aW9uKCckLmdldEVsZW1lbnRCeVR5cGUoXFwnVUlBVGFibGVDZWxsXFwnKS5nZXRBbGxXaXRoUHJlZGljYXRlKFwidHlwZSBjb250YWluc1tjXSBcXCd0ZXh0ZmllbGRcXCdcIiwgdHJ1ZSknKTtcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmVzLnNob3VsZC5oYXZlLmxlbmd0aCgxKTtcbiAgICAgIHJlc1swXS5FTEVNRU5ULnNob3VsZC5leGlzdDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0cmlldmUgY29udGV4dCBmcm9tIGNhY2hlIHdoZW4gY3R4IHBhcmFtIGlzIGEgc3RyaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGN0eC5leGVjRnVuYyhcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJvb3RQYWdlLmNsaWNrTWVudUl0ZW0oJ1RleHQgRmllbGRzJyk7XG4gICAgICAgICAgJC5kZWxheSgyMDAwKTtcbiAgICAgICAgICB2YXIgcGFyZW50ID0gJC5nZXRFbGVtZW50QnlUeXBlKCdVSUFUYWJsZUNlbGwnKTtcbiAgICAgICAgICB2YXIgcGFyZW50SWQgPSAkLmdldElkKHBhcmVudCk7XG4gICAgICAgICAgdmFyIHJlcyA9ICQuZ2V0RWxlbWVudHNCeVVJQXV0b21hdGlvbihcbiAgICAgICAgICAgICcuZ2V0QWxsV2l0aFByZWRpY2F0ZShcInR5cGUgY29udGFpbnNbY10gXFwndGV4dGZpZWxkXFwnXCIsIHRydWUpJyxcbiAgICAgICAgICAgIHBhcmVudElkXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmVzLnNob3VsZC5oYXZlLmxlbmd0aCgxKTtcbiAgICAgIHJlc1swXS5FTEVNRU5ULnNob3VsZC5leGlzdDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGNvbnRleHQgd2hlbiBjdHggcGFyYW0gaXMgYW4gb2JqZWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGN0eC5leGVjRnVuYyhcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJvb3RQYWdlLmNsaWNrTWVudUl0ZW0oJ1RleHQgRmllbGRzJyk7XG4gICAgICAgICAgJC5kZWxheSgyMDAwKTtcbiAgICAgICAgICB2YXIgcGFyZW50ID0gJC5nZXRFbGVtZW50QnlUeXBlKCdVSUFUYWJsZUNlbGwnKTtcbiAgICAgICAgICB2YXIgcmVzID0gJC5nZXRFbGVtZW50c0J5VUlBdXRvbWF0aW9uKFxuICAgICAgICAgICAgJy5nZXRBbGxXaXRoUHJlZGljYXRlKFwidHlwZSBjb250YWluc1tjXSBcXCd0ZXh0ZmllbGRcXCdcIiwgdHJ1ZSknLFxuICAgICAgICAgICAgcGFyZW50XG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmVzLnNob3VsZC5oYXZlLmxlbmd0aCgxKTtcbiAgICAgIHJlc1swXS5FTEVNRU5ULnNob3VsZC5leGlzdDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd29yayB3aGVuIHJldHJpZXZpbmcgb25seSBvbmUgZWxlbWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCByZXMgPSBhd2FpdCBjdHguZXhlY0Z1bmMoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByb290UGFnZS5jbGlja01lbnVJdGVtKCdUZXh0IEZpZWxkcycpO1xuICAgICAgICAgICQuZGVsYXkoMjAwMCk7XG4gICAgICAgICAgdmFyIHJlcyA9IFtdLCBwYXJlbnQsIGVsO1xuICAgICAgICAgIGVsID0gJC5nZXRFbGVtZW50QnlVSUF1dG9tYXRpb24oXG4gICAgICAgICAgICAnLmdldEFsbFdpdGhQcmVkaWNhdGUoXCJ0eXBlIGNvbnRhaW5zW2NdIFxcJ3RleHRmaWVsZFxcJ1wiLCB0cnVlKSdcbiAgICAgICAgICApO1xuICAgICAgICAgIHJlcy5wdXNoKGVsKTtcblxuICAgICAgICAgIGVsID0gJC5nZXRFbGVtZW50QnlVSUF1dG9tYXRpb24oJyQuZ2V0RWxlbWVudEJ5VHlwZShcXCdVSUFUYWJsZUNlbGxcXCcpLmdldEFsbFdpdGhQcmVkaWNhdGUoXCJ0eXBlIGNvbnRhaW5zW2NdIFxcJ3RleHRmaWVsZFxcJ1wiLCB0cnVlKScpO1xuICAgICAgICAgIHJlcy5wdXNoKGVsKTtcblxuICAgICAgICAgIHBhcmVudCA9ICQuZ2V0RWxlbWVudHNCeVR5cGUoJ1VJQVRhYmxlQ2VsbCcpWzFdO1xuICAgICAgICAgIHZhciBwYXJlbnRJZCA9ICQuZ2V0SWQocGFyZW50KTtcbiAgICAgICAgICBlbCA9ICQuZ2V0RWxlbWVudEJ5VUlBdXRvbWF0aW9uKFxuICAgICAgICAgICAgJy5nZXRBbGxXaXRoUHJlZGljYXRlKFwidHlwZSBjb250YWluc1tjXSBcXCd0ZXh0ZmllbGRcXCdcIiwgdHJ1ZSknLFxuICAgICAgICAgICAgcGFyZW50SWRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJlcy5wdXNoKGVsKTtcblxuICAgICAgICAgIHBhcmVudCA9ICQuZ2V0RWxlbWVudHNCeVR5cGUoJ1VJQVRhYmxlQ2VsbCcpWzJdO1xuICAgICAgICAgIGVsID0gJC5nZXRFbGVtZW50QnlVSUF1dG9tYXRpb24oXG4gICAgICAgICAgICAnLmdldEFsbFdpdGhQcmVkaWNhdGUoXCJ0eXBlIGNvbnRhaW5zW2NdIFxcJ3RleHRmaWVsZFxcJ1wiLCB0cnVlKScsXG4gICAgICAgICAgICBwYXJlbnRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJlcy5wdXNoKGVsKTtcblxuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXMuc2hvdWxkLmhhdmUubGVuZ3RoKDQpO1xuICAgICAgcmVzWzBdLkVMRU1FTlQuc2hvdWxkLmV4aXN0O1xuICAgIH0pO1xuXG4gIH0pO1xufSk7XG4iXX0=