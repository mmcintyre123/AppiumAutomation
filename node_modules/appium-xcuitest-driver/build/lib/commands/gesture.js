'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Object$assign = require('babel-runtime/core-js/object/assign')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var _appiumSupport = require('appium-support');

var _appiumIosDriver = require('appium-ios-driver');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _logger = require('../logger');

var _logger2 = _interopRequireDefault(_logger);

var helpers = {},
    extensions = {},
    commands = {};

commands.moveTo = _appiumIosDriver.iosCommands.gesture.moveTo;

commands.click = function callee$0$0(el) {
  var atomsElement;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (this.isWebContext()) {
          context$1$0.next = 4;
          break;
        }

        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(this.nativeClick(el));

      case 3:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 4:
        el = _appiumSupport.util.unwrapElement(el);

        if (!(this.opts.nativeWebTap && !this.isRealDevice())) {
          context$1$0.next = 10;
          break;
        }

        context$1$0.next = 8;
        return _regeneratorRuntime.awrap(this.nativeWebTap(el));

      case 8:
        context$1$0.next = 14;
        break;

      case 10:
        atomsElement = this.useAtomsElement(el);
        context$1$0.next = 13;
        return _regeneratorRuntime.awrap(this.executeAtom('click', [atomsElement]));

      case 13:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 14:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.performTouch = function callee$0$0(gestures) {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        _logger2['default'].debug('Received the following touch action: ' + _lodash2['default'].map(gestures, 'action').join('-'));

        if (!isDoubleTap(gestures)) {
          context$1$0.next = 7;
          break;
        }

        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.handleDoubleTap(gestures));

      case 4:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 7:
        if (!isTap(gestures)) {
          context$1$0.next = 13;
          break;
        }

        context$1$0.next = 10;
        return _regeneratorRuntime.awrap(this.handleTap(gestures[0]));

      case 10:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 13:
        if (!isLongPress(gestures)) {
          context$1$0.next = 19;
          break;
        }

        context$1$0.next = 16;
        return _regeneratorRuntime.awrap(this.handleLongPress(gestures));

      case 16:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 19:
        if (!isDrag(gestures)) {
          context$1$0.next = 25;
          break;
        }

        context$1$0.next = 22;
        return _regeneratorRuntime.awrap(this.handleDrag(gestures));

      case 22:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 25:
        if (!isScroll(gestures)) {
          context$1$0.next = 29;
          break;
        }

        context$1$0.next = 28;
        return _regeneratorRuntime.awrap(this.handleScroll(gestures));

      case 28:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 29:
        throw new _appiumBaseDriver.errors.NotYetImplementedError('Support for this gesture is not yet implemented. Please contact an Appium dev');

      case 30:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.performMultiAction = function callee$0$0(actions) {
  var i;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        _logger2['default'].debug('Received the following multi touch action:');
        for (i in actions) {
          _logger2['default'].debug('    ' + (i + 1) + ': ' + _lodash2['default'].map(actions[i], 'action').join('-'));
        }

        if (!isPinchOrZoom(actions)) {
          context$1$0.next = 6;
          break;
        }

        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.handlePinchOrZoom(actions));

      case 5:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 6:
        throw new _appiumBaseDriver.errors.NotYetImplementedError('Support for this multi-action is not yet implemented. Please contact an Appium dev.');

      case 7:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.nativeClick = function callee$0$0(el) {
  var endpoint;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = _appiumSupport.util.unwrapElement(el);
        endpoint = '/element/' + el + '/click';
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, 'POST', {}));

      case 4:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 5:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

function isDrag(gestures) {
  return gestures.length === 4 && gestures[0].action === 'press' && gestures[1].action === 'wait' && gestures[2].action === 'moveTo' && gestures[3].action === 'release';
}

function isDoubleTap(gestures) {
  if (gestures.length === 1 && gestures[0].action.toLowerCase() === 'doubletap') {
    return true;
  } else if (gestures.length === 1 && gestures[0].action === 'tap' && (gestures[0].options || {}).count === 2) {
    return true;
  }
  return false;
}

function isTap(gestures) {
  if (gestures.length === 1 && gestures[0].action === 'tap') {
    return true;
  } else if (gestures.length === 2 && gestures[0].action === 'press' && gestures[1].action === 'release') {
    return true;
  }
  return false;
}

function isLongPress(gestures) {
  if (gestures.length === 1 && gestures[0].action.toLowerCase() === 'longpress') {
    return true;
  } else if (gestures.length === 3 && gestures[0].action === 'press' && gestures[1].action === 'wait' && gestures[2].action === 'release') {
    return true;
  }
  return false;
}

function isScroll(gestures) {
  if (gestures.length === 3 && gestures[0].action === 'press' && gestures[1].action === 'moveTo' && gestures[2].action === 'release') {
    return true;
  }
  return false;
}

function isPinchOrZoom() {
  var actions = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];

  // symmetric two-finger action consisting of press-moveto-release
  if (actions.length === 2) {
    if (actions[0].length === 3 && actions[1].length === 3) {
      return _lodash2['default'].every(actions, function (gestures) {
        return isScroll(gestures);
      });
    }
  }
  return false;
}

helpers.handleScroll = function callee$0$0(gestures) {
  var dragGestures;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!gestures[1].options.element) {
          context$1$0.next = 4;
          break;
        }

        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(this.mobileScroll({
          element: gestures[1].options.element,
          toVisible: true
        }));

      case 3:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 4:
        dragGestures = [gestures[0], { action: 'wait', options: { ms: 0 } }, gestures[1], gestures[2]];
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.handleDrag(dragGestures));

      case 7:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 8:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.handleDrag = function callee$0$0(gestures) {
  var press, wait, moveTo, pressCoordinates, duration, moveToCoordinates, params, endpoint;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        press = gestures[0];
        wait = gestures[1];
        moveTo = gestures[2];
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.getCoordinates(press));

      case 5:
        pressCoordinates = context$1$0.sent;
        duration = parseInt(wait.options.ms, 10) / 1000;
        context$1$0.next = 9;
        return _regeneratorRuntime.awrap(this.getCoordinates(moveTo));

      case 9:
        moveToCoordinates = context$1$0.sent;

        // update moveTo coordinates with offset
        moveToCoordinates = this.applyMoveToOffset(pressCoordinates, moveToCoordinates);

        // build drag command
        params = {};

        params.fromX = pressCoordinates.x;
        params.fromY = pressCoordinates.y;
        params.toX = moveToCoordinates.x;
        params.toY = moveToCoordinates.y;
        params.duration = duration;

        endpoint = '/wda/element/0/dragfromtoforduration';
        context$1$0.next = 20;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, 'POST', params));

      case 20:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 21:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.handleTap = function callee$0$0(gesture) {
  var options, params, el, endpoint;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        options = gesture.options || {};
        params = {};

        if (_appiumSupport.util.hasValue(options.x) && _appiumSupport.util.hasValue(options.y)) {
          params.x = options.x;
          params.y = options.y;
        }

        el = _appiumSupport.util.hasValue(options.element) ? options.element : '0';
        endpoint = '/wda/tap/' + el;

        if (_appiumSupport.util.hasValue(this.opts.tapWithShortPressDuration)) {
          // in some cases `tap` is too slow, so allow configurable long press
          _logger2['default'].debug('Translating tap into long press with \'' + this.opts.tapWithShortPressDuration + '\' duration');
          params.duration = parseFloat(this.opts.tapWithShortPressDuration);
          endpoint = '/wda/element/' + el + '/touchAndHold';
          params.duration = parseFloat(this.opts.tapWithShortPressDuration);
        }

        context$1$0.next = 8;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, 'POST', params));

      case 8:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 9:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.handleDoubleTap = function callee$0$0(gestures) {
  var gesture, opts, el, endpoint;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        gesture = gestures[0];
        opts = gesture.options || {};

        if (!opts.element) {
          _logger2['default'].errorAndThrow('WDA double tap needs an element');
        }

        el = _appiumSupport.util.unwrapElement(opts.element);
        endpoint = '/wda/element/' + el + '/doubleTap';
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, 'POST'));

      case 7:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 8:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.handleLongPress = function callee$0$0(gestures) {
  var pressOpts, el, duration, params, endpoint;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        pressOpts = gestures[0].options || {};
        el = _appiumSupport.util.unwrapElement(pressOpts.element);
        duration = undefined;

        if (gestures.length === 1 && _appiumSupport.util.hasValue(pressOpts.duration)) {
          duration = pressOpts.duration;
        } else if (gestures.length === 3) {
          // duration is the `wait` action
          // upstream system expects seconds not milliseconds
          duration = parseFloat(gestures[1].options.ms) / 1000;
        } else {
          // give a sane default duration
          duration = 0.8;
        }

        params = {
          duration: duration,
          x: pressOpts.x,
          y: pressOpts.y
        };
        endpoint = undefined;

        if (el) {
          endpoint = '/wda/element/' + el + '/touchAndHold';
        } else {
          params.x = pressOpts.x;
          params.y = pressOpts.y;

          endpoint = '/wda/touchAndHold';
        }
        context$1$0.next = 9;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, 'POST', params));

      case 9:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 10:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

function determinePinchScale(x, y, pinch) {
  var scale = x > y ? x - y : y - x;
  if (pinch) {
    // TODO: revisit this when pinching actually works, since it is impossible to
    // know what the scale factor does at this point (Xcode 8.1)
    scale = 1 / scale;
    if (scale < 0.02) {
      // this is the minimum that Apple will allow
      // but WDA will not throw an error if it is too low
      scale = 0.02;
    }
  } else {
    // for zoom, each 10px is one scale factor
    scale = scale / 10;
  }
  return scale;
}

helpers.handlePinchOrZoom = function callee$0$0(actions) {
  var el, scale, velocity, thumb, forefinger, params;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        // currently we can only do this action on an element
        if (!actions[0][0].options.element || actions[0][0].options.element !== actions[1][0].options.element) {
          _logger2['default'].errorAndThrow('Pinch/zoom actions must be done on a single element');
        }
        el = actions[0][0].options.element;
        scale = undefined, velocity = undefined;

        if (actions[0][0].options.y === actions[0][1].options.y) {
          thumb = actions[0][0].options.x <= actions[1][0].options.x ? actions[0] : actions[1];

          // now decipher pinch vs. zoom,
          //   pinch: thumb moving from left to right
          //   zoom: thumb moving from right to left
          scale = determinePinchScale(thumb[0].options.x, thumb[1].options.x, thumb[0].options.x <= thumb[1].options.x);
        } else {
          forefinger = actions[0][0].options.y <= actions[1][0].options.y ? actions[0] : actions[1];

          // now decipher pinch vs. zoom
          //   pinch: forefinger moving from top to bottom
          //   zoom: forefinger moving from bottom to top
          scale = determinePinchScale(forefinger[0].options.y, forefinger[1].options.y, forefinger[0].options.y <= forefinger[1].options.y);
        }
        velocity = scale < 1 ? -1 : 1;

        _logger2['default'].debug('Decoded ' + (scale < 1 ? 'pinch' : 'zoom') + ' action with scale \'' + scale + '\' and velocity \'' + velocity + '\'');
        if (scale < 1) {
          _logger2['default'].warn('Pinch actions may not work, due to Apple issue.');
        }

        params = {
          scale: scale,
          velocity: velocity
        };
        context$1$0.next = 10;
        return _regeneratorRuntime.awrap(this.proxyCommand('/wda/element/' + el + '/pinch', 'POST', params));

      case 10:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.mobileScroll = function callee$0$0() {
  var opts = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];
  var params, msg, element, endpoint;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (opts.element) {
          context$1$0.next = 4;
          break;
        }

        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(this.findElement('class name', 'XCUIElementTypeApplication'));

      case 3:
        opts.element = context$1$0.sent;

      case 4:
        params = {};

        if (opts.name) {
          params.name = opts.name;
        } else if (opts.direction) {
          params.direction = opts.direction;
        } else if (opts.predicateString) {
          params.predicateString = opts.predicateString;
        } else if (opts.toVisible) {
          params.toVisible = opts.toVisible;
        } else {
          msg = 'Mobile scroll supports the following strategies: name, ' + 'direction, predicateString, and toVisible. Specify one of these';

          _logger2['default'].errorAndThrow(msg);
        }

        element = opts.element.ELEMENT ? opts.element.ELEMENT : opts.element;
        endpoint = '/wda/element/' + element + '/scroll';
        context$1$0.next = 10;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, 'POST', params));

      case 10:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 11:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.getCoordinates = function callee$0$0(gesture) {
  var el, coordinates, rect, pos, size, offsetX, offsetY;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        el = gesture.options.element;
        coordinates = { x: 0, y: 0, areOffsets: false };

        if (!el) {
          context$1$0.next = 15;
          break;
        }

        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.getRect(el));

      case 5:
        rect = context$1$0.sent;
        pos = { x: rect.x, y: rect.y };
        size = { w: rect.width, h: rect.height };
        offsetX = 0;
        offsetY = 0;

        // get the real offsets
        if (gesture.options.x || gesture.options.y) {
          offsetX = gesture.options.x || 0;
          offsetY = gesture.options.y || 0;
        } else {
          offsetX = size.w / 2;
          offsetY = size.h / 2;
        }

        // apply the offsets
        coordinates.x = pos.x + offsetX;
        coordinates.y = pos.y + offsetY;
        context$1$0.next = 18;
        break;

      case 15:
        // moveTo coordinates are passed in as offsets
        coordinates.areOffsets = gesture.action === 'moveTo';
        coordinates.x = gesture.options.x || 0;
        coordinates.y = gesture.options.y || 0;

      case 18:
        return context$1$0.abrupt('return', coordinates);

      case 19:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.applyMoveToOffset = function (firstCoordinates, secondCoordinates) {
  if (secondCoordinates.areOffsets) {
    return {
      x: firstCoordinates.x + secondCoordinates.x,
      y: firstCoordinates.y + secondCoordinates.y
    };
  } else {
    return secondCoordinates;
  }
};

_Object$assign(extensions, helpers, commands);
exports.extensions = extensions;
exports.helpers = helpers;
exports.commands = commands;
exports['default'] = extensions;

// there are multiple commands that map here, so manually proxy

// atoms-based clicks don't always work in safari 7

// use the to-visible option of scrolling in WDA

// otherwise, for now, just translate into a drag with short duration

// get gestures

// get drag data

// assume that action is in a single plane (x or y, not horizontal at all)
// terminology all assuming right handedness

// horizontal, since y offset is the same in press and moveTo

// vertical

// WDA supports four scrolling strategies: predication based on name, direction,
// predicateString, and toVisible, in that order.

// defaults

// figure out the element coordinates.

// defaults
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9nZXN0dXJlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztnQ0FBdUIsb0JBQW9COzs2QkFDdEIsZ0JBQWdCOzsrQkFDVCxtQkFBbUI7O3NCQUNqQyxRQUFROzs7O3NCQUNOLFdBQVc7Ozs7QUFHM0IsSUFBSSxPQUFPLEdBQUcsRUFBRTtJQUFFLFVBQVUsR0FBRyxFQUFFO0lBQUUsUUFBUSxHQUFHLEVBQUUsQ0FBQzs7QUFFakQsUUFBUSxDQUFDLE1BQU0sR0FBRyw2QkFBWSxPQUFPLENBQUMsTUFBTSxDQUFDOztBQUU3QyxRQUFRLENBQUMsS0FBSyxHQUFHLG9CQUFnQixFQUFFO01BVTNCLFlBQVk7Ozs7WUFUYixJQUFJLENBQUMsWUFBWSxFQUFFOzs7Ozs7eUNBRVQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7Ozs7OztBQUVuQyxVQUFFLEdBQUcsb0JBQUssYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDOztjQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQTs7Ozs7O3lDQUUxQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQzs7Ozs7OztBQUV2QixvQkFBWSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDOzt5Q0FDOUIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQzs7Ozs7Ozs7OztDQUV6RCxDQUFDOztBQUVGLFFBQVEsQ0FBQyxZQUFZLEdBQUcsb0JBQWdCLFFBQVE7Ozs7QUFDOUMsNEJBQUksS0FBSywyQ0FBeUMsb0JBQUUsR0FBRyxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUcsQ0FBQzs7YUFFckYsV0FBVyxDQUFDLFFBQVEsQ0FBQzs7Ozs7O3lDQUNWLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDOzs7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QUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBSSxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQzs7Ozs7QUFLMUYsZUFBSyxHQUFHLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDL0csTUFBTTtBQUVELG9CQUFVLEdBQUcsQUFBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBSSxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQzs7Ozs7QUFLL0YsZUFBSyxHQUFHLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDbkk7QUFDRCxnQkFBUSxHQUFHLEtBQUssR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDOztBQUU5Qiw0QkFBSSxLQUFLLGVBQVksS0FBSyxHQUFHLENBQUMsR0FBRyxPQUFPLEdBQUcs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LENBQUMsQUFBQyxDQUFDO0FBQ3ZCLGlCQUFPLEdBQUksSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEFBQUMsQ0FBQztTQUN4Qjs7O0FBR0QsbUJBQVcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUM7QUFDaEMsbUJBQVcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUM7Ozs7OztBQUdoQyxtQkFBVyxDQUFDLFVBQVUsR0FBSSxPQUFPLENBQUMsTUFBTSxLQUFLLFFBQVEsQUFBQyxDQUFDO0FBQ3ZELG1CQUFXLENBQUMsQ0FBQyxHQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsQUFBQyxDQUFDO0FBQ3pDLG1CQUFXLENBQUMsQ0FBQyxHQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsQUFBQyxDQUFDOzs7NENBRXBDLFdBQVc7Ozs7Ozs7Q0FDbkIsQ0FBQzs7QUFFRixPQUFPLENBQUMsaUJBQWlCLEdBQUcsVUFBVSxnQkFBZ0IsRUFBRSxpQkFBaUIsRUFBRTtBQUN6RSxNQUFJLGlCQUFpQixDQUFDLFVBQVUsRUFBRTtBQUNoQyxXQUFPO0FBQ0wsT0FBQyxFQUFFLGdCQUFnQixDQUFDLENBQUMsR0FBRyxpQkFBaUIsQ0FBQyxDQUFDO0FBQzNDLE9BQUMsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLEdBQUcsaUJBQWlCLENBQUMsQ0FBQztLQUM1QyxDQUFDO0dBQ0gsTUFBTTtBQUNMLFdBQU8saUJBQWlCLENBQUM7R0FDMUI7Q0FDRixDQUFDOztBQUVGLGVBQWMsVUFBVSxFQUFFLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNwQyxVQUFVLEdBQVYsVUFBVTtRQUFFLE9BQU8sR0FBUCxPQUFPO1FBQUUsUUFBUSxHQUFSLFFBQVE7cUJBQ3ZCLFVBQVUiLCJmaWxlIjoibGliL2NvbW1hbmRzL2dlc3R1cmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IGlvc0NvbW1hbmRzIH0gZnJvbSAnYXBwaXVtLWlvcy1kcml2ZXInO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcblxuXG5sZXQgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge30sIGNvbW1hbmRzID0ge307XG5cbmNvbW1hbmRzLm1vdmVUbyA9IGlvc0NvbW1hbmRzLmdlc3R1cmUubW92ZVRvO1xuXG5jb21tYW5kcy5jbGljayA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICAvLyB0aGVyZSBhcmUgbXVsdGlwbGUgY29tbWFuZHMgdGhhdCBtYXAgaGVyZSwgc28gbWFudWFsbHkgcHJveHlcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5uYXRpdmVDbGljayhlbCk7XG4gIH1cbiAgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQoZWwpO1xuICBpZiAodGhpcy5vcHRzLm5hdGl2ZVdlYlRhcCAmJiAhdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgIC8vIGF0b21zLWJhc2VkIGNsaWNrcyBkb24ndCBhbHdheXMgd29yayBpbiBzYWZhcmkgN1xuICAgIGF3YWl0IHRoaXMubmF0aXZlV2ViVGFwKGVsKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgYXRvbXNFbGVtZW50ID0gdGhpcy51c2VBdG9tc0VsZW1lbnQoZWwpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmV4ZWN1dGVBdG9tKCdjbGljaycsIFthdG9tc0VsZW1lbnRdKTtcbiAgfVxufTtcblxuY29tbWFuZHMucGVyZm9ybVRvdWNoID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmVzKSB7XG4gIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgdGhlIGZvbGxvd2luZyB0b3VjaCBhY3Rpb246ICR7Xy5tYXAoZ2VzdHVyZXMsICdhY3Rpb24nKS5qb2luKCctJyl9YCk7XG5cbiAgaWYgKGlzRG91YmxlVGFwKGdlc3R1cmVzKSkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmhhbmRsZURvdWJsZVRhcChnZXN0dXJlcyk7XG4gIH0gZWxzZSBpZiAoaXNUYXAoZ2VzdHVyZXMpKSB7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuaGFuZGxlVGFwKGdlc3R1cmVzWzBdKTtcbiAgfSBlbHNlIGlmIChpc0xvbmdQcmVzcyhnZXN0dXJlcykpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5oYW5kbGVMb25nUHJlc3MoZ2VzdHVyZXMpO1xuICB9IGVsc2UgaWYgKGlzRHJhZyhnZXN0dXJlcykpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5oYW5kbGVEcmFnKGdlc3R1cmVzKTtcbiAgfSBlbHNlIGlmIChpc1Njcm9sbChnZXN0dXJlcykpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5oYW5kbGVTY3JvbGwoZ2VzdHVyZXMpO1xuICB9XG4gIHRocm93IG5ldyBlcnJvcnMuTm90WWV0SW1wbGVtZW50ZWRFcnJvcignU3VwcG9ydCBmb3IgdGhpcyBnZXN0dXJlIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQuIFBsZWFzZSBjb250YWN0IGFuIEFwcGl1bSBkZXYnKTtcbn07XG5cbmNvbW1hbmRzLnBlcmZvcm1NdWx0aUFjdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIChhY3Rpb25zKSB7XG4gIGxvZy5kZWJ1ZyhgUmVjZWl2ZWQgdGhlIGZvbGxvd2luZyBtdWx0aSB0b3VjaCBhY3Rpb246YCk7XG4gIGZvciAobGV0IGkgaW4gYWN0aW9ucykge1xuICAgIGxvZy5kZWJ1ZyhgICAgICR7aSsxfTogJHtfLm1hcChhY3Rpb25zW2ldLCAnYWN0aW9uJykuam9pbignLScpfWApO1xuICB9XG5cbiAgaWYgKGlzUGluY2hPclpvb20oYWN0aW9ucykpIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5oYW5kbGVQaW5jaE9yWm9vbShhY3Rpb25zKTtcbiAgfVxuICB0aHJvdyBuZXcgZXJyb3JzLk5vdFlldEltcGxlbWVudGVkRXJyb3IoJ1N1cHBvcnQgZm9yIHRoaXMgbXVsdGktYWN0aW9uIGlzIG5vdCB5ZXQgaW1wbGVtZW50ZWQuIFBsZWFzZSBjb250YWN0IGFuIEFwcGl1bSBkZXYuJyk7XG59O1xuXG5jb21tYW5kcy5uYXRpdmVDbGljayA9IGFzeW5jIGZ1bmN0aW9uIChlbCkge1xuICBlbCA9IHV0aWwudW53cmFwRWxlbWVudChlbCk7XG4gIGxldCBlbmRwb2ludCA9IGAvZWxlbWVudC8ke2VsfS9jbGlja2A7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChlbmRwb2ludCwgJ1BPU1QnLCB7fSk7XG59O1xuXG5mdW5jdGlvbiBpc0RyYWcgKGdlc3R1cmVzKSB7XG4gIHJldHVybiAoXG4gICAgICBnZXN0dXJlcy5sZW5ndGggPT09IDQgJiZcbiAgICAgIGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ3ByZXNzJyAmJlxuICAgICAgZ2VzdHVyZXNbMV0uYWN0aW9uID09PSAnd2FpdCcgJiZcbiAgICAgIGdlc3R1cmVzWzJdLmFjdGlvbiA9PT0gJ21vdmVUbycgJiZcbiAgICAgIGdlc3R1cmVzWzNdLmFjdGlvbiA9PT0gJ3JlbGVhc2UnXG4gICk7XG59XG5cbmZ1bmN0aW9uIGlzRG91YmxlVGFwIChnZXN0dXJlcykge1xuICBpZiAoZ2VzdHVyZXMubGVuZ3RoID09PSAxICYmIGdlc3R1cmVzWzBdLmFjdGlvbi50b0xvd2VyQ2FzZSgpID09PSAnZG91YmxldGFwJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9IGVsc2UgaWYgKGdlc3R1cmVzLmxlbmd0aCA9PT0gMSAmJlxuICAgICAgICAgICAgIGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ3RhcCcgJiZcbiAgICAgICAgICAgICAoZ2VzdHVyZXNbMF0ub3B0aW9ucyB8fCB7fSkuY291bnQgPT09IDIpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGlzVGFwIChnZXN0dXJlcykge1xuICBpZiAoZ2VzdHVyZXMubGVuZ3RoID09PSAxICYmIGdlc3R1cmVzWzBdLmFjdGlvbiA9PT0gJ3RhcCcpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIGlmIChnZXN0dXJlcy5sZW5ndGggPT09IDIgJiZcbiAgICAgICAgICAgICAgZ2VzdHVyZXNbMF0uYWN0aW9uID09PSAncHJlc3MnICYmXG4gICAgICAgICAgICAgIGdlc3R1cmVzWzFdLmFjdGlvbiA9PT0gJ3JlbGVhc2UnKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBpc0xvbmdQcmVzcyAoZ2VzdHVyZXMpIHtcbiAgaWYgKGdlc3R1cmVzLmxlbmd0aCA9PT0gMSAmJiBnZXN0dXJlc1swXS5hY3Rpb24udG9Mb3dlckNhc2UoKSA9PT0gJ2xvbmdwcmVzcycpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIGlmIChnZXN0dXJlcy5sZW5ndGggPT09IDMgJiZcbiAgICAgICAgICAgICAgZ2VzdHVyZXNbMF0uYWN0aW9uID09PSAncHJlc3MnICYmXG4gICAgICAgICAgICAgIGdlc3R1cmVzWzFdLmFjdGlvbiA9PT0gJ3dhaXQnICYmXG4gICAgICAgICAgICAgIGdlc3R1cmVzWzJdLmFjdGlvbiA9PT0gJ3JlbGVhc2UnKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBpc1Njcm9sbCAoZ2VzdHVyZXMpIHtcbiAgaWYgKGdlc3R1cmVzLmxlbmd0aCA9PT0gMyAmJlxuICAgICAgICBnZXN0dXJlc1swXS5hY3Rpb24gPT09ICdwcmVzcycgJiZcbiAgICAgICAgZ2VzdHVyZXNbMV0uYWN0aW9uID09PSAnbW92ZVRvJyAmJlxuICAgICAgICBnZXN0dXJlc1syXS5hY3Rpb24gPT09ICdyZWxlYXNlJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gaXNQaW5jaE9yWm9vbSAoYWN0aW9ucyA9IFtdKSB7XG4gIC8vIHN5bW1ldHJpYyB0d28tZmluZ2VyIGFjdGlvbiBjb25zaXN0aW5nIG9mIHByZXNzLW1vdmV0by1yZWxlYXNlXG4gIGlmIChhY3Rpb25zLmxlbmd0aCA9PT0gMikge1xuICAgIGlmIChhY3Rpb25zWzBdLmxlbmd0aCA9PT0gMyAmJiBhY3Rpb25zWzFdLmxlbmd0aCA9PT0gMykge1xuICAgICAgcmV0dXJuIF8uZXZlcnkoYWN0aW9ucywgKGdlc3R1cmVzKSA9PiBpc1Njcm9sbChnZXN0dXJlcykpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmhlbHBlcnMuaGFuZGxlU2Nyb2xsID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmVzKSB7XG4gIGlmIChnZXN0dXJlc1sxXS5vcHRpb25zLmVsZW1lbnQpIHtcbiAgICAvLyB1c2UgdGhlIHRvLXZpc2libGUgb3B0aW9uIG9mIHNjcm9sbGluZyBpbiBXREFcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5tb2JpbGVTY3JvbGwoe1xuICAgICAgZWxlbWVudDogZ2VzdHVyZXNbMV0ub3B0aW9ucy5lbGVtZW50LFxuICAgICAgdG9WaXNpYmxlOiB0cnVlXG4gICAgfSk7XG4gIH1cblxuICAvLyBvdGhlcndpc2UsIGZvciBub3csIGp1c3QgdHJhbnNsYXRlIGludG8gYSBkcmFnIHdpdGggc2hvcnQgZHVyYXRpb25cbiAgbGV0IGRyYWdHZXN0dXJlcyA9IFtcbiAgICBnZXN0dXJlc1swXSxcbiAgICB7YWN0aW9uOiAnd2FpdCcsIG9wdGlvbnM6IHttczogMH19LFxuICAgIGdlc3R1cmVzWzFdLFxuICAgIGdlc3R1cmVzWzJdXG4gIF07XG4gIHJldHVybiBhd2FpdCB0aGlzLmhhbmRsZURyYWcoZHJhZ0dlc3R1cmVzKTtcbn07XG5cbmhlbHBlcnMuaGFuZGxlRHJhZyA9IGFzeW5jIGZ1bmN0aW9uIChnZXN0dXJlcykge1xuICAvLyBnZXQgZ2VzdHVyZXNcbiAgbGV0IHByZXNzID0gZ2VzdHVyZXNbMF07XG4gIGxldCB3YWl0ID0gZ2VzdHVyZXNbMV07XG4gIGxldCBtb3ZlVG8gPSBnZXN0dXJlc1syXTtcblxuICAvLyBnZXQgZHJhZyBkYXRhXG4gIGxldCBwcmVzc0Nvb3JkaW5hdGVzID0gYXdhaXQgdGhpcy5nZXRDb29yZGluYXRlcyhwcmVzcyk7XG4gIGxldCBkdXJhdGlvbiA9IChwYXJzZUludCh3YWl0Lm9wdGlvbnMubXMsIDEwKSAvIDEwMDApO1xuICBsZXQgbW92ZVRvQ29vcmRpbmF0ZXMgPSBhd2FpdCB0aGlzLmdldENvb3JkaW5hdGVzKG1vdmVUbyk7XG5cbiAgLy8gdXBkYXRlIG1vdmVUbyBjb29yZGluYXRlcyB3aXRoIG9mZnNldFxuICBtb3ZlVG9Db29yZGluYXRlcyA9IHRoaXMuYXBwbHlNb3ZlVG9PZmZzZXQocHJlc3NDb29yZGluYXRlcywgbW92ZVRvQ29vcmRpbmF0ZXMpO1xuXG4gIC8vIGJ1aWxkIGRyYWcgY29tbWFuZFxuICBsZXQgcGFyYW1zID0ge307XG4gIHBhcmFtcy5mcm9tWCA9IHByZXNzQ29vcmRpbmF0ZXMueDtcbiAgcGFyYW1zLmZyb21ZID0gcHJlc3NDb29yZGluYXRlcy55O1xuICBwYXJhbXMudG9YID0gbW92ZVRvQ29vcmRpbmF0ZXMueDtcbiAgcGFyYW1zLnRvWSA9IG1vdmVUb0Nvb3JkaW5hdGVzLnk7XG4gIHBhcmFtcy5kdXJhdGlvbiA9IGR1cmF0aW9uO1xuXG4gIGxldCBlbmRwb2ludCA9IGAvd2RhL2VsZW1lbnQvMC9kcmFnZnJvbXRvZm9yZHVyYXRpb25gO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoZW5kcG9pbnQsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmhlbHBlcnMuaGFuZGxlVGFwID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmUpIHtcbiAgbGV0IG9wdGlvbnMgPSBnZXN0dXJlLm9wdGlvbnMgfHwge307XG5cbiAgbGV0IHBhcmFtcyA9IHt9O1xuICBpZiAodXRpbC5oYXNWYWx1ZShvcHRpb25zLngpICYmIHV0aWwuaGFzVmFsdWUob3B0aW9ucy55KSkge1xuICAgIHBhcmFtcy54ID0gb3B0aW9ucy54O1xuICAgIHBhcmFtcy55ID0gb3B0aW9ucy55O1xuICB9XG5cbiAgbGV0IGVsID0gdXRpbC5oYXNWYWx1ZShvcHRpb25zLmVsZW1lbnQpID8gb3B0aW9ucy5lbGVtZW50IDogJzAnO1xuICBsZXQgZW5kcG9pbnQgPSBgL3dkYS90YXAvJHtlbH1gO1xuXG4gIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy50YXBXaXRoU2hvcnRQcmVzc0R1cmF0aW9uKSkge1xuICAgIC8vIGluIHNvbWUgY2FzZXMgYHRhcGAgaXMgdG9vIHNsb3csIHNvIGFsbG93IGNvbmZpZ3VyYWJsZSBsb25nIHByZXNzXG4gICAgbG9nLmRlYnVnKGBUcmFuc2xhdGluZyB0YXAgaW50byBsb25nIHByZXNzIHdpdGggJyR7dGhpcy5vcHRzLnRhcFdpdGhTaG9ydFByZXNzRHVyYXRpb259JyBkdXJhdGlvbmApO1xuICAgIHBhcmFtcy5kdXJhdGlvbiA9IHBhcnNlRmxvYXQodGhpcy5vcHRzLnRhcFdpdGhTaG9ydFByZXNzRHVyYXRpb24pO1xuICAgIGVuZHBvaW50ID0gYC93ZGEvZWxlbWVudC8ke2VsfS90b3VjaEFuZEhvbGRgO1xuICAgIHBhcmFtcy5kdXJhdGlvbiA9IHBhcnNlRmxvYXQodGhpcy5vcHRzLnRhcFdpdGhTaG9ydFByZXNzRHVyYXRpb24pO1xuICB9XG5cbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGVuZHBvaW50LCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLmhhbmRsZURvdWJsZVRhcCA9IGFzeW5jIGZ1bmN0aW9uIChnZXN0dXJlcykge1xuICBsZXQgZ2VzdHVyZSA9IGdlc3R1cmVzWzBdO1xuICBsZXQgb3B0cyA9IGdlc3R1cmUub3B0aW9ucyB8fCB7fTtcblxuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdXREEgZG91YmxlIHRhcCBuZWVkcyBhbiBlbGVtZW50Jyk7XG4gIH1cblxuICBsZXQgZWwgPSB1dGlsLnVud3JhcEVsZW1lbnQob3B0cy5lbGVtZW50KTtcbiAgbGV0IGVuZHBvaW50ID0gYC93ZGEvZWxlbWVudC8ke2VsfS9kb3VibGVUYXBgO1xuXG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChlbmRwb2ludCwgJ1BPU1QnKTtcbn07XG5cbmhlbHBlcnMuaGFuZGxlTG9uZ1ByZXNzID0gYXN5bmMgZnVuY3Rpb24gKGdlc3R1cmVzKSB7XG4gIGxldCBwcmVzc09wdHMgPSBnZXN0dXJlc1swXS5vcHRpb25zIHx8IHt9O1xuXG4gIGxldCBlbCA9IHV0aWwudW53cmFwRWxlbWVudChwcmVzc09wdHMuZWxlbWVudCk7XG4gIGxldCBkdXJhdGlvbjtcbiAgaWYgKGdlc3R1cmVzLmxlbmd0aCA9PT0gMSAmJiB1dGlsLmhhc1ZhbHVlKHByZXNzT3B0cy5kdXJhdGlvbikpIHtcbiAgICBkdXJhdGlvbiA9IHByZXNzT3B0cy5kdXJhdGlvbjtcbiAgfSBlbHNlIGlmIChnZXN0dXJlcy5sZW5ndGggPT09IDMpIHtcbiAgICAvLyBkdXJhdGlvbiBpcyB0aGUgYHdhaXRgIGFjdGlvblxuICAgIC8vIHVwc3RyZWFtIHN5c3RlbSBleHBlY3RzIHNlY29uZHMgbm90IG1pbGxpc2Vjb25kc1xuICAgIGR1cmF0aW9uID0gcGFyc2VGbG9hdChnZXN0dXJlc1sxXS5vcHRpb25zLm1zKSAvIDEwMDA7XG4gIH0gZWxzZSB7XG4gICAgLy8gZ2l2ZSBhIHNhbmUgZGVmYXVsdCBkdXJhdGlvblxuICAgIGR1cmF0aW9uID0gMC44O1xuICB9XG5cbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBkdXJhdGlvbixcbiAgICB4OiBwcmVzc09wdHMueCxcbiAgICB5OiBwcmVzc09wdHMueSxcbiAgfTtcblxuICBsZXQgZW5kcG9pbnQ7XG4gIGlmIChlbCkge1xuICAgIGVuZHBvaW50ID0gYC93ZGEvZWxlbWVudC8ke2VsfS90b3VjaEFuZEhvbGRgO1xuICB9IGVsc2Uge1xuICAgIHBhcmFtcy54ID0gcHJlc3NPcHRzLng7XG4gICAgcGFyYW1zLnkgPSBwcmVzc09wdHMueTtcblxuICAgIGVuZHBvaW50ID0gJy93ZGEvdG91Y2hBbmRIb2xkJztcbiAgfVxuICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoZW5kcG9pbnQsICdQT1NUJywgcGFyYW1zKTtcbn07XG5cbmZ1bmN0aW9uIGRldGVybWluZVBpbmNoU2NhbGUgKHgsIHksIHBpbmNoKSB7XG4gIGxldCBzY2FsZSA9IHggPiB5ID8geCAtIHkgOiB5IC0geDtcbiAgaWYgKHBpbmNoKSB7XG4gICAgLy8gVE9ETzogcmV2aXNpdCB0aGlzIHdoZW4gcGluY2hpbmcgYWN0dWFsbHkgd29ya3MsIHNpbmNlIGl0IGlzIGltcG9zc2libGUgdG9cbiAgICAvLyBrbm93IHdoYXQgdGhlIHNjYWxlIGZhY3RvciBkb2VzIGF0IHRoaXMgcG9pbnQgKFhjb2RlIDguMSlcbiAgICBzY2FsZSA9IDEgLyBzY2FsZTtcbiAgICBpZiAoc2NhbGUgPCAwLjAyKSB7XG4gICAgICAvLyB0aGlzIGlzIHRoZSBtaW5pbXVtIHRoYXQgQXBwbGUgd2lsbCBhbGxvd1xuICAgICAgLy8gYnV0IFdEQSB3aWxsIG5vdCB0aHJvdyBhbiBlcnJvciBpZiBpdCBpcyB0b28gbG93XG4gICAgICBzY2FsZSA9IDAuMDI7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIC8vIGZvciB6b29tLCBlYWNoIDEwcHggaXMgb25lIHNjYWxlIGZhY3RvclxuICAgIHNjYWxlID0gc2NhbGUgLyAxMDtcbiAgfVxuICByZXR1cm4gc2NhbGU7XG59XG5cbmhlbHBlcnMuaGFuZGxlUGluY2hPclpvb20gPSBhc3luYyBmdW5jdGlvbiAoYWN0aW9ucykge1xuICAvLyBjdXJyZW50bHkgd2UgY2FuIG9ubHkgZG8gdGhpcyBhY3Rpb24gb24gYW4gZWxlbWVudFxuICBpZiAoIWFjdGlvbnNbMF1bMF0ub3B0aW9ucy5lbGVtZW50IHx8XG4gICAgICBhY3Rpb25zWzBdWzBdLm9wdGlvbnMuZWxlbWVudCAhPT0gYWN0aW9uc1sxXVswXS5vcHRpb25zLmVsZW1lbnQpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnUGluY2gvem9vbSBhY3Rpb25zIG11c3QgYmUgZG9uZSBvbiBhIHNpbmdsZSBlbGVtZW50Jyk7XG4gIH1cbiAgbGV0IGVsID0gYWN0aW9uc1swXVswXS5vcHRpb25zLmVsZW1lbnQ7XG5cbiAgLy8gYXNzdW1lIHRoYXQgYWN0aW9uIGlzIGluIGEgc2luZ2xlIHBsYW5lICh4IG9yIHksIG5vdCBob3Jpem9udGFsIGF0IGFsbClcbiAgLy8gdGVybWlub2xvZ3kgYWxsIGFzc3VtaW5nIHJpZ2h0IGhhbmRlZG5lc3NcbiAgbGV0IHNjYWxlLCB2ZWxvY2l0eTtcbiAgaWYgKGFjdGlvbnNbMF1bMF0ub3B0aW9ucy55ID09PSBhY3Rpb25zWzBdWzFdLm9wdGlvbnMueSkge1xuICAgIC8vIGhvcml6b250YWwsIHNpbmNlIHkgb2Zmc2V0IGlzIHRoZSBzYW1lIGluIHByZXNzIGFuZCBtb3ZlVG9cbiAgICBsZXQgdGh1bWIgPSAoYWN0aW9uc1swXVswXS5vcHRpb25zLnggPD0gYWN0aW9uc1sxXVswXS5vcHRpb25zLngpID8gYWN0aW9uc1swXSA6IGFjdGlvbnNbMV07XG5cbiAgICAvLyBub3cgZGVjaXBoZXIgcGluY2ggdnMuIHpvb20sXG4gICAgLy8gICBwaW5jaDogdGh1bWIgbW92aW5nIGZyb20gbGVmdCB0byByaWdodFxuICAgIC8vICAgem9vbTogdGh1bWIgbW92aW5nIGZyb20gcmlnaHQgdG8gbGVmdFxuICAgIHNjYWxlID0gZGV0ZXJtaW5lUGluY2hTY2FsZSh0aHVtYlswXS5vcHRpb25zLngsIHRodW1iWzFdLm9wdGlvbnMueCwgdGh1bWJbMF0ub3B0aW9ucy54IDw9IHRodW1iWzFdLm9wdGlvbnMueCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gdmVydGljYWxcbiAgICBsZXQgZm9yZWZpbmdlciA9IChhY3Rpb25zWzBdWzBdLm9wdGlvbnMueSA8PSBhY3Rpb25zWzFdWzBdLm9wdGlvbnMueSkgPyBhY3Rpb25zWzBdIDogYWN0aW9uc1sxXTtcblxuICAgIC8vIG5vdyBkZWNpcGhlciBwaW5jaCB2cy4gem9vbVxuICAgIC8vICAgcGluY2g6IGZvcmVmaW5nZXIgbW92aW5nIGZyb20gdG9wIHRvIGJvdHRvbVxuICAgIC8vICAgem9vbTogZm9yZWZpbmdlciBtb3ZpbmcgZnJvbSBib3R0b20gdG8gdG9wXG4gICAgc2NhbGUgPSBkZXRlcm1pbmVQaW5jaFNjYWxlKGZvcmVmaW5nZXJbMF0ub3B0aW9ucy55LCBmb3JlZmluZ2VyWzFdLm9wdGlvbnMueSwgZm9yZWZpbmdlclswXS5vcHRpb25zLnkgPD0gZm9yZWZpbmdlclsxXS5vcHRpb25zLnkpO1xuICB9XG4gIHZlbG9jaXR5ID0gc2NhbGUgPCAxID8gLTEgOiAxO1xuXG4gIGxvZy5kZWJ1ZyhgRGVjb2RlZCAke3NjYWxlIDwgMSA/ICdwaW5jaCcgOiAnem9vbSd9IGFjdGlvbiB3aXRoIHNjYWxlICcke3NjYWxlfScgYW5kIHZlbG9jaXR5ICcke3ZlbG9jaXR5fSdgKTtcbiAgaWYgKHNjYWxlIDwgMSkge1xuICAgIGxvZy53YXJuKCdQaW5jaCBhY3Rpb25zIG1heSBub3Qgd29yaywgZHVlIHRvIEFwcGxlIGlzc3VlLicpO1xuICB9XG5cbiAgbGV0IHBhcmFtcyA9IHtcbiAgICBzY2FsZSxcbiAgICB2ZWxvY2l0eVxuICB9O1xuICBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL3dkYS9lbGVtZW50LyR7ZWx9L3BpbmNoYCwgJ1BPU1QnLCBwYXJhbXMpO1xufTtcblxuaGVscGVycy5tb2JpbGVTY3JvbGwgPSBhc3luYyBmdW5jdGlvbiAob3B0cz17fSkge1xuICBpZiAoIW9wdHMuZWxlbWVudCkge1xuICAgIG9wdHMuZWxlbWVudCA9IGF3YWl0IHRoaXMuZmluZEVsZW1lbnQoYGNsYXNzIG5hbWVgLCBgWENVSUVsZW1lbnRUeXBlQXBwbGljYXRpb25gKTtcbiAgfVxuICAvLyBXREEgc3VwcG9ydHMgZm91ciBzY3JvbGxpbmcgc3RyYXRlZ2llczogcHJlZGljYXRpb24gYmFzZWQgb24gbmFtZSwgZGlyZWN0aW9uLFxuICAvLyBwcmVkaWNhdGVTdHJpbmcsIGFuZCB0b1Zpc2libGUsIGluIHRoYXQgb3JkZXIuXG4gIGxldCBwYXJhbXMgPSB7fTtcbiAgaWYgKG9wdHMubmFtZSkge1xuICAgIHBhcmFtcy5uYW1lID0gb3B0cy5uYW1lO1xuICB9IGVsc2UgaWYgKG9wdHMuZGlyZWN0aW9uKSB7XG4gICAgcGFyYW1zLmRpcmVjdGlvbiA9IG9wdHMuZGlyZWN0aW9uO1xuICB9IGVsc2UgaWYgKG9wdHMucHJlZGljYXRlU3RyaW5nKSB7XG4gICAgcGFyYW1zLnByZWRpY2F0ZVN0cmluZyA9IG9wdHMucHJlZGljYXRlU3RyaW5nO1xuICB9IGVsc2UgaWYgKG9wdHMudG9WaXNpYmxlKSB7XG4gICAgcGFyYW1zLnRvVmlzaWJsZSA9IG9wdHMudG9WaXNpYmxlO1xuICB9IGVsc2Uge1xuICAgIGxldCBtc2cgPSAnTW9iaWxlIHNjcm9sbCBzdXBwb3J0cyB0aGUgZm9sbG93aW5nIHN0cmF0ZWdpZXM6IG5hbWUsICcgK1xuICAgICAgICAgICAgICAnZGlyZWN0aW9uLCBwcmVkaWNhdGVTdHJpbmcsIGFuZCB0b1Zpc2libGUuIFNwZWNpZnkgb25lIG9mIHRoZXNlJztcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICB9XG5cbiAgbGV0IGVsZW1lbnQgPSBvcHRzLmVsZW1lbnQuRUxFTUVOVCA/IG9wdHMuZWxlbWVudC5FTEVNRU5UIDogb3B0cy5lbGVtZW50O1xuICBsZXQgZW5kcG9pbnQgPSBgL3dkYS9lbGVtZW50LyR7ZWxlbWVudH0vc2Nyb2xsYDtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGVuZHBvaW50LCAnUE9TVCcsIHBhcmFtcyk7XG59O1xuXG5oZWxwZXJzLmdldENvb3JkaW5hdGVzID0gYXN5bmMgZnVuY3Rpb24oZ2VzdHVyZSkge1xuICBsZXQgZWwgPSBnZXN0dXJlLm9wdGlvbnMuZWxlbWVudDtcblxuICAvLyBkZWZhdWx0c1xuICBsZXQgY29vcmRpbmF0ZXMgPSB7eDogMCwgeTogMCwgYXJlT2Zmc2V0czogZmFsc2V9O1xuXG4gIC8vIGZpZ3VyZSBvdXQgdGhlIGVsZW1lbnQgY29vcmRpbmF0ZXMuXG4gIGlmIChlbCkge1xuICAgIGxldCByZWN0ID0gYXdhaXQgdGhpcy5nZXRSZWN0KGVsKTtcbiAgICBsZXQgcG9zID0ge3g6IHJlY3QueCwgeTogcmVjdC55fTtcbiAgICBsZXQgc2l6ZSA9IHt3OiByZWN0LndpZHRoLCBoOiByZWN0LmhlaWdodH07XG5cbiAgICAvLyBkZWZhdWx0c1xuICAgIGxldCBvZmZzZXRYID0gMDtcbiAgICBsZXQgb2Zmc2V0WSA9IDA7XG5cbiAgICAvLyBnZXQgdGhlIHJlYWwgb2Zmc2V0c1xuICAgIGlmIChnZXN0dXJlLm9wdGlvbnMueCB8fCBnZXN0dXJlLm9wdGlvbnMueSkge1xuICAgICAgb2Zmc2V0WCA9IChnZXN0dXJlLm9wdGlvbnMueCB8fCAwKTtcbiAgICAgIG9mZnNldFkgPSAoZ2VzdHVyZS5vcHRpb25zLnkgfHwgMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9mZnNldFggPSAoc2l6ZS53IC8gMik7XG4gICAgICBvZmZzZXRZID0gKHNpemUuaCAvIDIpO1xuICAgIH1cblxuICAgIC8vIGFwcGx5IHRoZSBvZmZzZXRzXG4gICAgY29vcmRpbmF0ZXMueCA9IHBvcy54ICsgb2Zmc2V0WDtcbiAgICBjb29yZGluYXRlcy55ID0gcG9zLnkgKyBvZmZzZXRZO1xuICB9IGVsc2Uge1xuICAgIC8vIG1vdmVUbyBjb29yZGluYXRlcyBhcmUgcGFzc2VkIGluIGFzIG9mZnNldHNcbiAgICBjb29yZGluYXRlcy5hcmVPZmZzZXRzID0gKGdlc3R1cmUuYWN0aW9uID09PSAnbW92ZVRvJyk7XG4gICAgY29vcmRpbmF0ZXMueCA9IChnZXN0dXJlLm9wdGlvbnMueCB8fCAwKTtcbiAgICBjb29yZGluYXRlcy55ID0gKGdlc3R1cmUub3B0aW9ucy55IHx8IDApO1xuICB9XG4gIHJldHVybiBjb29yZGluYXRlcztcbn07XG5cbmhlbHBlcnMuYXBwbHlNb3ZlVG9PZmZzZXQgPSBmdW5jdGlvbiAoZmlyc3RDb29yZGluYXRlcywgc2Vjb25kQ29vcmRpbmF0ZXMpIHtcbiAgaWYgKHNlY29uZENvb3JkaW5hdGVzLmFyZU9mZnNldHMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgeDogZmlyc3RDb29yZGluYXRlcy54ICsgc2Vjb25kQ29vcmRpbmF0ZXMueCxcbiAgICAgIHk6IGZpcnN0Q29vcmRpbmF0ZXMueSArIHNlY29uZENvb3JkaW5hdGVzLnksXG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gc2Vjb25kQ29vcmRpbmF0ZXM7XG4gIH1cbn07XG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgaGVscGVycywgY29tbWFuZHMpO1xuZXhwb3J0IHsgZXh0ZW5zaW9ucywgaGVscGVycywgY29tbWFuZHMgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
