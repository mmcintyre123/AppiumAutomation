'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Object$assign = require('babel-runtime/core-js/object/assign')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var commands = {},
    helpers = {},
    extensions = {};

commands.getAlertText = function callee$0$0() {
  var _alert, text, method, endpoint;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!this.isWebContext()) {
          context$1$0.next = 8;
          break;
        }

        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(this.getAlert());

      case 3:
        _alert = context$1$0.sent;
        context$1$0.next = 6;
        return _regeneratorRuntime.awrap(_alert.getText());

      case 6:
        text = context$1$0.sent;
        return context$1$0.abrupt('return', text);

      case 8:
        method = 'GET';
        endpoint = '/alert/text';
        context$1$0.next = 12;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, method));

      case 12:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 13:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

// TODO: WDA does not currently support this natively
commands.setAlertText = function callee$0$0(text) {
  var _alert2, method, endpoint;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!Array.isArray(text)) {
          text = text.split('');
        }

        if (!this.isWebContext()) {
          context$1$0.next = 8;
          break;
        }

        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.getAlert());

      case 4:
        _alert2 = context$1$0.sent;
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(_alert2.setText(text));

      case 7:
        return context$1$0.abrupt('return');

      case 8:
        method = 'POST';
        endpoint = '/alert/text';
        context$1$0.next = 12;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, method, text));

      case 12:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 13:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.postAcceptAlert = function callee$0$0() {
  var _alert3, method, endpoint;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!this.isWebContext()) {
          context$1$0.next = 12;
          break;
        }

        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(this.getAlert());

      case 3:
        _alert3 = context$1$0.sent;

        if (!_alert3.close) {
          context$1$0.next = 9;
          break;
        }

        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(_alert3.close());

      case 7:
        context$1$0.next = 11;
        break;

      case 9:
        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(_alert3.ok());

      case 11:
        return context$1$0.abrupt('return');

      case 12:
        method = 'POST';
        endpoint = '/alert/accept';
        context$1$0.next = 16;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, method));

      case 16:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 17:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.postDismissAlert = function callee$0$0() {
  var _alert4, method, endpoint;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!this.isWebContext()) {
          context$1$0.next = 12;
          break;
        }

        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(this.getAlert());

      case 3:
        _alert4 = context$1$0.sent;

        if (!_alert4.close) {
          context$1$0.next = 9;
          break;
        }

        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(_alert4.close());

      case 7:
        context$1$0.next = 11;
        break;

      case 9:
        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(_alert4.cancel());

      case 11:
        return context$1$0.abrupt('return');

      case 12:
        method = 'POST';
        endpoint = '/alert/dismiss';
        context$1$0.next = 16;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, method));

      case 16:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 17:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.getAlert = function callee$0$0() {
  var possibleAlert, possibleAlertButtons, assertButtonName, alert;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    var _this = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.findNativeElementOrElements('class name', 'XCUIElementTypeScrollView', true));

      case 2:
        possibleAlert = context$1$0.sent;

        if (!(possibleAlert.length !== 1)) {
          context$1$0.next = 5;
          break;
        }

        throw new _appiumBaseDriver.errors.NoAlertOpenError();

      case 5:
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.findNativeElementOrElements('class name', 'XCUIElementTypeButton', true, possibleAlert[0].ELEMENT));

      case 7:
        possibleAlertButtons = context$1$0.sent;

        if (!(possibleAlertButtons.length < 1 || possibleAlertButtons.length > 2)) {
          context$1$0.next = 10;
          break;
        }

        throw new _appiumBaseDriver.errors.NoAlertOpenError();

      case 10:
        assertButtonName = function assertButtonName(button, expectedName) {
          var name;
          return _regeneratorRuntime.async(function assertButtonName$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                button = button.ELEMENT ? button.ELEMENT : button;
                context$2$0.next = 3;
                return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + button + '/attribute/name', 'GET'));

              case 3:
                name = context$2$0.sent;

                if (!(name.toLowerCase() !== expectedName)) {
                  context$2$0.next = 6;
                  break;
                }

                throw new _appiumBaseDriver.errors.NoAlertOpenError();

              case 6:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        };

        alert = possibleAlert[0];

        if (!(possibleAlertButtons.length === 1)) {
          context$1$0.next = 17;
          break;
        }

        context$1$0.next = 15;
        return _regeneratorRuntime.awrap((function callee$1$0() {
          var closeButton;
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            var _this2 = this;

            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                closeButton = possibleAlertButtons[0];
                context$2$0.next = 3;
                return _regeneratorRuntime.awrap(assertButtonName(closeButton, 'close'));

              case 3:

                alert.close = function callee$2$0() {
                  return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                    while (1) switch (context$3$0.prev = context$3$0.next) {
                      case 0:
                        context$3$0.next = 2;
                        return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + closeButton.ELEMENT + '/click', 'POST'));

                      case 2:
                      case 'end':
                        return context$3$0.stop();
                    }
                  }, null, _this2);
                };

              case 4:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        })());

      case 15:
        context$1$0.next = 19;
        break;

      case 17:
        context$1$0.next = 19;
        return _regeneratorRuntime.awrap((function callee$1$0() {
          var cancelButton, okButton;
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            var _this3 = this;

            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                cancelButton = possibleAlertButtons[0];
                context$2$0.next = 3;
                return _regeneratorRuntime.awrap(assertButtonName(cancelButton, 'cancel'));

              case 3:
                okButton = possibleAlertButtons[1];
                context$2$0.next = 6;
                return _regeneratorRuntime.awrap(assertButtonName(okButton, 'ok'));

              case 6:

                alert.cancel = function callee$2$0() {
                  return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                    while (1) switch (context$3$0.prev = context$3$0.next) {
                      case 0:
                        context$3$0.next = 2;
                        return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + cancelButton.ELEMENT + '/click', 'POST'));

                      case 2:
                      case 'end':
                        return context$3$0.stop();
                    }
                  }, null, _this3);
                };
                alert.ok = function callee$2$0() {
                  return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                    while (1) switch (context$3$0.prev = context$3$0.next) {
                      case 0:
                        context$3$0.next = 2;
                        return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + okButton.ELEMENT + '/click', 'POST'));

                      case 2:
                      case 'end':
                        return context$3$0.stop();
                    }
                  }, null, _this3);
                };

              case 8:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        })());

      case 19:

        alert.getText = function callee$1$0() {
          var textView;
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                context$2$0.next = 2;
                return _regeneratorRuntime.awrap(this.findNativeElementOrElements('class name', 'XCUIElementTypeTextView', false, alert.ELEMENT));

              case 2:
                textView = context$2$0.sent;
                context$2$0.next = 5;
                return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + textView.ELEMENT + '/attribute/value', 'GET'));

              case 5:
                return context$2$0.abrupt('return', context$2$0.sent);

              case 6:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        };
        alert.setText = function callee$1$0(value) {
          var textView;
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                context$2$0.prev = 0;
                context$2$0.next = 3;
                return _regeneratorRuntime.awrap(this.findNativeElementOrElements('class name', 'XCUIElementTypeTextField', false, alert.ELEMENT));

              case 3:
                textView = context$2$0.sent;
                context$2$0.next = 6;
                return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + textView.ELEMENT + '/value ', 'POST', { value: value }));

              case 6:
                context$2$0.next = 13;
                break;

              case 8:
                context$2$0.prev = 8;
                context$2$0.t0 = context$2$0['catch'](0);

                if (!(0, _appiumBaseDriver.isErrorType)(context$2$0.t0, _appiumBaseDriver.errors.NoSuchElementError)) {
                  context$2$0.next = 12;
                  break;
                }

                throw new Error('Tried to set text of an alert that was not a prompt');

              case 12:
                throw context$2$0.t0;

              case 13:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this, [[0, 8]]);
        };

        return context$1$0.abrupt('return', alert);

      case 22:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

_Object$assign(extensions, commands, helpers);
exports.commands = commands;
exports.helpers = helpers;
exports['default'] = extensions;

// make sure the button is 'Close'

// ensure the buttons are 'Cancel' and 'OK'
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9hbGVydC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O2dDQUFvQyxvQkFBb0I7O0FBR3hELElBQUksUUFBUSxHQUFHLEVBQUU7SUFBRSxPQUFPLEdBQUcsRUFBRTtJQUFFLFVBQVUsR0FBRyxFQUFFLENBQUM7O0FBRWpELFFBQVEsQ0FBQyxZQUFZLEdBQUc7TUFFaEIsTUFBSyxFQUNMLElBQUksRUFJTixNQUFNLEVBQ04sUUFBUTs7Ozs7YUFQUixJQUFJLENBQUMsWUFBWSxFQUFFOzs7Ozs7eUNBQ0gsSUFBSSxDQUFDLFFBQVEsRUFBRTs7O0FBQTdCLGNBQUs7O3lDQUNRLE1BQUssQ0FBQyxPQUFPLEVBQUU7OztBQUE1QixZQUFJOzRDQUNELElBQUk7OztBQUdULGNBQU0sR0FBRyxLQUFLO0FBQ2QsZ0JBQVE7O3lDQUNDLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQzs7Ozs7Ozs7OztDQUNqRCxDQUFDOzs7QUFHRixRQUFRLENBQUMsWUFBWSxHQUFHLG9CQUFnQixJQUFJO01BS3BDLE9BQUssRUFLUCxNQUFNLEVBQ04sUUFBUTs7Ozs7QUFWWixZQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtBQUN4QixjQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUN2Qjs7YUFDRyxJQUFJLENBQUMsWUFBWSxFQUFFOzs7Ozs7eUNBQ0gsSUFBSSxDQUFDLFFBQVEsRUFBRTs7O0FBQTdCLGVBQUs7O3lDQUNILE9BQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDOzs7Ozs7QUFJdkIsY0FBTSxHQUFHLE1BQU07QUFDZixnQkFBUTs7eUNBQ0MsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQzs7Ozs7Ozs7OztDQUN2RCxDQUFDOztBQUVGLFFBQVEsQ0FBQyxlQUFlLEdBQUc7TUFFbkIsT0FBSyxF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ZmlsZSI6ImxpYi9jb21tYW5kcy9hbGVydC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGVycm9ycywgaXNFcnJvclR5cGUgfSBmcm9tICdhcHBpdW0tYmFzZS1kcml2ZXInO1xuXG5cbmxldCBjb21tYW5kcyA9IHt9LCBoZWxwZXJzID0ge30sIGV4dGVuc2lvbnMgPSB7fTtcblxuY29tbWFuZHMuZ2V0QWxlcnRUZXh0ID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhbGVydCA9IGF3YWl0IHRoaXMuZ2V0QWxlcnQoKTtcbiAgICBsZXQgdGV4dCA9IGF3YWl0IGFsZXJ0LmdldFRleHQoKTtcbiAgICByZXR1cm4gdGV4dDtcbiAgfVxuXG4gIGxldCBtZXRob2QgPSAnR0VUJztcbiAgbGV0IGVuZHBvaW50ID0gYC9hbGVydC90ZXh0YDtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGVuZHBvaW50LCBtZXRob2QpO1xufTtcblxuLy8gVE9ETzogV0RBIGRvZXMgbm90IGN1cnJlbnRseSBzdXBwb3J0IHRoaXMgbmF0aXZlbHlcbmNvbW1hbmRzLnNldEFsZXJ0VGV4dCA9IGFzeW5jIGZ1bmN0aW9uICh0ZXh0KSB7XG4gIGlmICghQXJyYXkuaXNBcnJheSh0ZXh0KSkge1xuICAgIHRleHQgPSB0ZXh0LnNwbGl0KCcnKTtcbiAgfVxuICBpZiAodGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgIGxldCBhbGVydCA9IGF3YWl0IHRoaXMuZ2V0QWxlcnQoKTtcbiAgICBhd2FpdCBhbGVydC5zZXRUZXh0KHRleHQpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBtZXRob2QgPSAnUE9TVCc7XG4gIGxldCBlbmRwb2ludCA9IGAvYWxlcnQvdGV4dGA7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChlbmRwb2ludCwgbWV0aG9kLCB0ZXh0KTtcbn07XG5cbmNvbW1hbmRzLnBvc3RBY2NlcHRBbGVydCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICBsZXQgYWxlcnQgPSBhd2FpdCB0aGlzLmdldEFsZXJ0KCk7XG4gICAgaWYgKGFsZXJ0LmNsb3NlKSB7XG4gICAgICBhd2FpdCBhbGVydC5jbG9zZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBhbGVydC5vaygpO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgbWV0aG9kID0gJ1BPU1QnO1xuICBsZXQgZW5kcG9pbnQgPSBgL2FsZXJ0L2FjY2VwdGA7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChlbmRwb2ludCwgbWV0aG9kKTtcbn07XG5cbmNvbW1hbmRzLnBvc3REaXNtaXNzQWxlcnQgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGlmICh0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgbGV0IGFsZXJ0ID0gYXdhaXQgdGhpcy5nZXRBbGVydCgpO1xuICAgIGlmIChhbGVydC5jbG9zZSkge1xuICAgICAgYXdhaXQgYWxlcnQuY2xvc2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgYWxlcnQuY2FuY2VsKCk7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBtZXRob2QgPSAnUE9TVCc7XG4gIGxldCBlbmRwb2ludCA9IGAvYWxlcnQvZGlzbWlzc2A7XG4gIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChlbmRwb2ludCwgbWV0aG9kKTtcbn07XG5cbmhlbHBlcnMuZ2V0QWxlcnQgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxldCBwb3NzaWJsZUFsZXJ0ID0gYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoJ2NsYXNzIG5hbWUnLCAnWENVSUVsZW1lbnRUeXBlU2Nyb2xsVmlldycsIHRydWUpO1xuICBpZiAocG9zc2libGVBbGVydC5sZW5ndGggIT09IDEpIHRocm93IG5ldyBlcnJvcnMuTm9BbGVydE9wZW5FcnJvcigpO1xuXG4gIGxldCBwb3NzaWJsZUFsZXJ0QnV0dG9ucyA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKCdjbGFzcyBuYW1lJywgJ1hDVUlFbGVtZW50VHlwZUJ1dHRvbicsIHRydWUsIHBvc3NpYmxlQWxlcnRbMF0uRUxFTUVOVCk7XG4gIGlmIChwb3NzaWJsZUFsZXJ0QnV0dG9ucy5sZW5ndGggIDwgMSB8fCBwb3NzaWJsZUFsZXJ0QnV0dG9ucy5sZW5ndGggPiAyKSB0aHJvdyBuZXcgZXJyb3JzLk5vQWxlcnRPcGVuRXJyb3IoKTtcblxuICBsZXQgYXNzZXJ0QnV0dG9uTmFtZSA9IGFzeW5jIChidXR0b24sIGV4cGVjdGVkTmFtZSkgPT4ge1xuICAgIGJ1dHRvbiA9IGJ1dHRvbi5FTEVNRU5UID8gYnV0dG9uLkVMRU1FTlQgOiBidXR0b247XG4gICAgbGV0IG5hbWUgPSBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL2VsZW1lbnQvJHtidXR0b259L2F0dHJpYnV0ZS9uYW1lYCwgJ0dFVCcpO1xuICAgIGlmIChuYW1lLnRvTG93ZXJDYXNlKCkgIT09IGV4cGVjdGVkTmFtZSkgdGhyb3cgbmV3IGVycm9ycy5Ob0FsZXJ0T3BlbkVycm9yKCk7XG4gIH07XG5cbiAgbGV0IGFsZXJ0ID0gcG9zc2libGVBbGVydFswXTtcbiAgaWYgKHBvc3NpYmxlQWxlcnRCdXR0b25zLmxlbmd0aCA9PT0gMSkge1xuICAgIC8vIG1ha2Ugc3VyZSB0aGUgYnV0dG9uIGlzICdDbG9zZSdcbiAgICBsZXQgY2xvc2VCdXR0b24gPSBwb3NzaWJsZUFsZXJ0QnV0dG9uc1swXTtcbiAgICBhd2FpdCBhc3NlcnRCdXR0b25OYW1lKGNsb3NlQnV0dG9uLCAnY2xvc2UnKTtcblxuICAgIGFsZXJ0LmNsb3NlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7Y2xvc2VCdXR0b24uRUxFTUVOVH0vY2xpY2tgLCAnUE9TVCcpO1xuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgLy8gZW5zdXJlIHRoZSBidXR0b25zIGFyZSAnQ2FuY2VsJyBhbmQgJ09LJ1xuICAgIGxldCBjYW5jZWxCdXR0b24gPSBwb3NzaWJsZUFsZXJ0QnV0dG9uc1swXTtcbiAgICBhd2FpdCBhc3NlcnRCdXR0b25OYW1lKGNhbmNlbEJ1dHRvbiwgJ2NhbmNlbCcpO1xuICAgIGxldCBva0J1dHRvbiA9IHBvc3NpYmxlQWxlcnRCdXR0b25zWzFdO1xuICAgIGF3YWl0IGFzc2VydEJ1dHRvbk5hbWUob2tCdXR0b24sICdvaycpO1xuXG4gICAgYWxlcnQuY2FuY2VsID0gYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7Y2FuY2VsQnV0dG9uLkVMRU1FTlR9L2NsaWNrYCwgJ1BPU1QnKTtcbiAgICB9O1xuICAgIGFsZXJ0Lm9rID0gYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7b2tCdXR0b24uRUxFTUVOVH0vY2xpY2tgLCAnUE9TVCcpO1xuICAgIH07XG4gIH1cblxuICBhbGVydC5nZXRUZXh0ID0gYXN5bmMgKCkgPT4ge1xuICAgIGxldCB0ZXh0VmlldyA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKCdjbGFzcyBuYW1lJywgJ1hDVUlFbGVtZW50VHlwZVRleHRWaWV3JywgZmFsc2UsIGFsZXJ0LkVMRU1FTlQpO1xuICAgIHJldHVybiBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL2VsZW1lbnQvJHt0ZXh0Vmlldy5FTEVNRU5UfS9hdHRyaWJ1dGUvdmFsdWVgLCAnR0VUJyk7XG4gIH07XG4gIGFsZXJ0LnNldFRleHQgPSBhc3luYyAodmFsdWUpID0+IHtcbiAgICB0cnkge1xuICAgICAgbGV0IHRleHRWaWV3ID0gYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoJ2NsYXNzIG5hbWUnLCAnWENVSUVsZW1lbnRUeXBlVGV4dEZpZWxkJywgZmFsc2UsIGFsZXJ0LkVMRU1FTlQpO1xuICAgICAgYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7dGV4dFZpZXcuRUxFTUVOVH0vdmFsdWUgYCwgJ1BPU1QnLCB7dmFsdWV9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChpc0Vycm9yVHlwZShlcnIsIGVycm9ycy5Ob1N1Y2hFbGVtZW50RXJyb3IpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignVHJpZWQgdG8gc2V0IHRleHQgb2YgYW4gYWxlcnQgdGhhdCB3YXMgbm90IGEgcHJvbXB0Jyk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBhbGVydDtcbn07XG5cblxuT2JqZWN0LmFzc2lnbihleHRlbnNpb25zLCBjb21tYW5kcywgaGVscGVycyk7XG5leHBvcnQgeyBjb21tYW5kcywgaGVscGVycyB9O1xuZXhwb3J0IGRlZmF1bHQgZXh0ZW5zaW9ucztcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
