'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _ = require('../..');

var _libUtils = require('../../lib/utils');

var _libUtils2 = _interopRequireDefault(_libUtils);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var sandbox = _sinon2['default'].sandbox.create();
var should = _chai2['default'].Should();

describe('Desired Capabilities', function () {
  var driver = undefined;
  before(function () {
    driver = new _.IosDriver();
  });

  function checkCaps(caps) {
    var throws = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

    if (throws) {
      should.Throw(function () {
        driver.validateDesiredCaps(caps);
      });
    } else {
      should.not.Throw(function () {
        driver.validateDesiredCaps(caps);
      });
    }
  }

  describe('platform name, app and bundleId', function () {
    it('should throw error if neither app nor bundleId are present', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5'
      };
      checkCaps(caps, true);
    });
    it('should accept an app', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app'
      };
      checkCaps(caps);
    });
    it('should accept a bundleId', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        bundleId: 'com.some-company.some-app'
      };
      checkCaps(caps);
    });
    it('should not be sensitive to platform name casing', function () {
      var caps = {
        platformName: 'IoS',
        deviceName: 'iPhone 5',
        bundleId: 'com.some-company.some-app'
      };
      checkCaps(caps);
    });
  });

  describe('launchTimeout', function () {
    it('should accept a number', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        launchTimeout: 1
      };
      checkCaps(caps);
    });
    it('should accept an object', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        launchTimeout: {
          global: 1
        }
      };
      checkCaps(caps);
    });
    it('should accept a stringified object', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        launchTimeout: JSON.stringify({
          global: 1
        })
      };
      checkCaps(caps);
    });
    it('should fail for non-JSON string', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        launchTimeout: 'launch timeout!'
      };
      checkCaps(caps, true);
    });
  });

  describe('processArguments', function () {
    it('should accept plain string', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        processArguments: 'this is a process argument'
      };
      checkCaps(caps);
    });
    it('should accept an object', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        processArguments: {
          global: 1
        }
      };
      checkCaps(caps);
    });
    it('should accept a stringified object', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        processArguments: JSON.stringify({
          global: 1
        })
      };
      checkCaps(caps);
    });
    it('should fail for non-string, non-object', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        processArguments: 4
      };
      checkCaps(caps, true);
    });
  });

  describe('server capabilities', function () {
    it('should collect server capabilities', function callee$2$0() {
      var caps;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            sandbox.stub(driver, 'configureApp');
            sandbox.stub(driver, 'validateDesiredCaps');
            sandbox.stub(driver, 'start');
            sandbox.stub(driver, 'startNewCommandTimeout');
            sandbox.stub(_libUtils2['default'], 'detectUdid');
            sandbox.stub(_libUtils2['default'], 'prepareIosOpts');
            caps = {
              platformName: 'iOS',
              deviceName: 'iPhone 5',
              app: 'some-app'
            };
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(driver.createSession(caps));

          case 9:
            driver.caps.takesScreenshot.should.exist;
            sandbox.restore();

          case 11:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9jYXBhYmlsaXR5LXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O2dCQUEwQixPQUFPOzt3QkFDZixpQkFBaUI7Ozs7b0JBQ2xCLE1BQU07Ozs7cUJBQ0wsT0FBTzs7OztBQUV6QixJQUFJLE9BQU8sR0FBRyxtQkFBTSxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDckMsSUFBTSxNQUFNLEdBQUcsa0JBQUssTUFBTSxFQUFFLENBQUM7O0FBRTdCLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxZQUFNO0FBQ3JDLE1BQUksTUFBTSxZQUFBLENBQUM7QUFDWCxRQUFNLENBQUMsWUFBTTtBQUNYLFVBQU0sR0FBRyxpQkFBZSxDQUFDO0dBQzFCLENBQUMsQ0FBQzs7QUFFSCxXQUFTLFNBQVMsQ0FBRSxJQUFJLEVBQWtCO1FBQWhCLE1BQU0seURBQUcsS0FBSzs7QUFDdEMsUUFBSSxNQUFNLEVBQUU7QUFDVixZQUFNLENBQUMsS0FBSyxDQUFDLFlBQVk7QUFDdkIsY0FBTSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDO09BQ2xDLENBQUMsQ0FBQztLQUNKLE1BQU07QUFDTCxZQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxZQUFZO0FBQzNCLGNBQU0sQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztPQUNsQyxDQUFDLENBQUM7S0FDSjtHQUNGOztBQUVELFVBQVEsQ0FBQyxpQ0FBaUMsRUFBRSxZQUFNO0FBQ2hELE1BQUUsQ0FBQyw0REFBNEQsRUFBRSxZQUFNO0FBQ3JFLFVBQUksSUFBSSxHQUFHO0FBQ1Qsb0JBQVksRUFBRSxLQUFLO0FBQ25CLGtCQUFVLEVBQUUsVUFBVTtPQUN2QixDQUFDO0FBQ0YsZUFBUyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztLQUN2QixDQUFDLENBQUM7QUFDSCxNQUFFLENBQUMsc0JBQXNCLEVBQUUsWUFBTTtBQUMvQixVQUFJLElBQUksR0FBRztBQUNU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QkFBWSxFQUFFLEtBQUs7QUFDbkIsd0JBQVUsRUFBRSxVQUFVO0FBQ3RCLGlCQUFHLEVBQUUsVUFBVTthQUNoQjs7NkNBQ0ssTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUM7OztBQUNoQyxrQkFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztBQUN6QyxtQkFBTyxDQUFDLE9BQU8sRUFBRSxDQUFDOzs7Ozs7O0tBQ25CLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L3VuaXQvY2FwYWJpbGl0eS1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElvc0RyaXZlciB9IGZyb20gJy4uLy4uJztcbmltcG9ydCB1dGlscyBmcm9tICcuLi8uLi9saWIvdXRpbHMnO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuXG5sZXQgc2FuZGJveCA9IHNpbm9uLnNhbmRib3guY3JlYXRlKCk7XG5jb25zdCBzaG91bGQgPSBjaGFpLlNob3VsZCgpO1xuXG5kZXNjcmliZSgnRGVzaXJlZCBDYXBhYmlsaXRpZXMnLCAoKSA9PiB7XG4gIGxldCBkcml2ZXI7XG4gIGJlZm9yZSgoKSA9PiB7XG4gICAgZHJpdmVyID0gbmV3IElvc0RyaXZlcigpO1xuICB9KTtcblxuICBmdW5jdGlvbiBjaGVja0NhcHMgKGNhcHMsIHRocm93cyA9IGZhbHNlKSB7XG4gICAgaWYgKHRocm93cykge1xuICAgICAgc2hvdWxkLlRocm93KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZHJpdmVyLnZhbGlkYXRlRGVzaXJlZENhcHMoY2Fwcyk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2hvdWxkLm5vdC5UaHJvdyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRyaXZlci52YWxpZGF0ZURlc2lyZWRDYXBzKGNhcHMpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgZGVzY3JpYmUoJ3BsYXRmb3JtIG5hbWUsIGFwcCBhbmQgYnVuZGxlSWQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBpZiBuZWl0aGVyIGFwcCBub3IgYnVuZGxlSWQgYXJlIHByZXNlbnQnLCAoKSA9PiB7XG4gICAgICBsZXQgY2FwcyA9IHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnaU9TJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ2lQaG9uZSA1J1xuICAgICAgfTtcbiAgICAgIGNoZWNrQ2FwcyhjYXBzLCB0cnVlKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBhbiBhcHAnLCAoKSA9PiB7XG4gICAgICBsZXQgY2FwcyA9IHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnaU9TJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ2lQaG9uZSA1JyxcbiAgICAgICAgYXBwOiAnc29tZS1hcHAnXG4gICAgICB9O1xuICAgICAgY2hlY2tDYXBzKGNhcHMpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgYWNjZXB0IGEgYnVuZGxlSWQnLCAoKSA9PiB7XG4gICAgICBsZXQgY2FwcyA9IHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnaU9TJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ2lQaG9uZSA1JyxcbiAgICAgICAgYnVuZGxlSWQ6ICdjb20uc29tZS1jb21wYW55LnNvbWUtYXBwJ1xuICAgICAgfTtcbiAgICAgIGNoZWNrQ2FwcyhjYXBzKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG5vdCBiZSBzZW5zaXRpdmUgdG8gcGxhdGZvcm0gbmFtZSBjYXNpbmcnLCAoKSA9PiB7XG4gICAgICBsZXQgY2FwcyA9IHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnSW9TJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ2lQaG9uZSA1JyxcbiAgICAgICAgYnVuZGxlSWQ6ICdjb20uc29tZS1jb21wYW55LnNvbWUtYXBwJ1xuICAgICAgfTtcbiAgICAgIGNoZWNrQ2FwcyhjYXBzKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xhdW5jaFRpbWVvdXQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgYSBudW1iZXInLCAoKSA9PiB7XG4gICAgICBsZXQgY2FwcyA9IHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnaU9TJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ2lQaG9uZSA1JyxcbiAgICAgICAgYXBwOiAnc29tZS1hcHAnLFxuICAgICAgICBsYXVuY2hUaW1lb3V0OiAxXG4gICAgICB9O1xuICAgICAgY2hlY2tDYXBzKGNhcHMpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgYWNjZXB0IGFuIG9iamVjdCcsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBhcHA6ICdzb21lLWFwcCcsXG4gICAgICAgIGxhdW5jaFRpbWVvdXQ6IHtcbiAgICAgICAgICBnbG9iYWw6IDFcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNoZWNrQ2FwcyhjYXBzKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBhIHN0cmluZ2lmaWVkIG9iamVjdCcsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBhcHA6ICdzb21lLWFwcCcsXG4gICAgICAgIGxhdW5jaFRpbWVvdXQ6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBnbG9iYWw6IDFcbiAgICAgICAgfSlcbiAgICAgIH07XG4gICAgICBjaGVja0NhcHMoY2Fwcyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBmYWlsIGZvciBub24tSlNPTiBzdHJpbmcnLCAoKSA9PiB7XG4gICAgICBsZXQgY2FwcyA9IHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnaU9TJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ2lQaG9uZSA1JyxcbiAgICAgICAgYXBwOiAnc29tZS1hcHAnLFxuICAgICAgICBsYXVuY2hUaW1lb3V0OiAnbGF1bmNoIHRpbWVvdXQhJ1xuICAgICAgfTtcbiAgICAgIGNoZWNrQ2FwcyhjYXBzLCB0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3Byb2Nlc3NBcmd1bWVudHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgcGxhaW4gc3RyaW5nJywgKCkgPT4ge1xuICAgICAgbGV0IGNhcHMgPSB7XG4gICAgICAgIHBsYXRmb3JtTmFtZTogJ2lPUycsXG4gICAgICAgIGRldmljZU5hbWU6ICdpUGhvbmUgNScsXG4gICAgICAgIGFwcDogJ3NvbWUtYXBwJyxcbiAgICAgICAgcHJvY2Vzc0FyZ3VtZW50czogJ3RoaXMgaXMgYSBwcm9jZXNzIGFyZ3VtZW50J1xuICAgICAgfTtcbiAgICAgIGNoZWNrQ2FwcyhjYXBzKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBhbiBvYmplY3QnLCAoKSA9PiB7XG4gICAgICBsZXQgY2FwcyA9IHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnaU9TJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ2lQaG9uZSA1JyxcbiAgICAgICAgYXBwOiAnc29tZS1hcHAnLFxuICAgICAgICBwcm9jZXNzQXJndW1lbnRzOiB7XG4gICAgICAgICAgZ2xvYmFsOiAxXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBjaGVja0NhcHMoY2Fwcyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgYSBzdHJpbmdpZmllZCBvYmplY3QnLCAoKSA9PiB7XG4gICAgICBsZXQgY2FwcyA9IHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnaU9TJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ2lQaG9uZSA1JyxcbiAgICAgICAgYXBwOiAnc29tZS1hcHAnLFxuICAgICAgICBwcm9jZXNzQXJndW1lbnRzOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgZ2xvYmFsOiAxXG4gICAgICAgIH0pXG4gICAgICB9O1xuICAgICAgY2hlY2tDYXBzKGNhcHMpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZmFpbCBmb3Igbm9uLXN0cmluZywgbm9uLW9iamVjdCcsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBhcHA6ICdzb21lLWFwcCcsXG4gICAgICAgIHByb2Nlc3NBcmd1bWVudHM6IDRcbiAgICAgIH07XG4gICAgICBjaGVja0NhcHMoY2FwcywgdHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZXJ2ZXIgY2FwYWJpbGl0aWVzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY29sbGVjdCBzZXJ2ZXIgY2FwYWJpbGl0aWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgc2FuZGJveC5zdHViKGRyaXZlciwgJ2NvbmZpZ3VyZUFwcCcpO1xuICAgICAgc2FuZGJveC5zdHViKGRyaXZlciwgJ3ZhbGlkYXRlRGVzaXJlZENhcHMnKTtcbiAgICAgIHNhbmRib3guc3R1Yihkcml2ZXIsICdzdGFydCcpO1xuICAgICAgc2FuZGJveC5zdHViKGRyaXZlciwgJ3N0YXJ0TmV3Q29tbWFuZFRpbWVvdXQnKTtcbiAgICAgIHNhbmRib3guc3R1Yih1dGlscywgJ2RldGVjdFVkaWQnKTtcbiAgICAgIHNhbmRib3guc3R1Yih1dGlscywgJ3ByZXBhcmVJb3NPcHRzJyk7XG4gICAgICBsZXQgY2FwcyA9IHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnaU9TJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ2lQaG9uZSA1JyxcbiAgICAgICAgYXBwOiAnc29tZS1hcHAnXG4gICAgICB9O1xuICAgICAgYXdhaXQgZHJpdmVyLmNyZWF0ZVNlc3Npb24oY2Fwcyk7XG4gICAgICBkcml2ZXIuY2Fwcy50YWtlc1NjcmVlbnNob3Quc2hvdWxkLmV4aXN0O1xuICAgICAgc2FuZGJveC5yZXN0b3JlKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
