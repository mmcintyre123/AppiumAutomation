/* globals expect */
'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _setupBase = require('../../setup-base');

var _setupBase2 = _interopRequireDefault(_setupBase);

var _helpersWebview = require('../../helpers/webview');

var SCROLL_INTO_VIEW = 'return arguments[0].scrollIntoView(true);';
var GET_RIGHT_INNERHTML = 'return document.body.innerHTML.indexOf(\'I am some page content\') > 0';
var GET_WRONG_INNERHTML = 'return document.body.innerHTML.indexOf(\'I am not some page content\') > 0';
var GET_ELEM_BY_TAGNAME = 'return document.getElementsByTagName(\'a\');';

describe('safari - webview - execute', function () {
  var _this = this;

  var driver = (0, _setupBase2['default'])(this, _desired2['default'], { noReset: true }, false, true).driver;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver));

        case 2:
          return context$2$0.abrupt('return', context$2$0.sent);

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  describe('synchronous', function () {
    var _this2 = this;

    it('should bubble up javascript errors', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('\'nan\'--').should.eventually.be.rejected);

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should eval javascript', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('return 1'));

          case 2:
            context$3$0.sent.should.be.equal(1);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should not be returning hardcoded results', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('return 1+1'));

          case 2:
            context$3$0.sent.should.be.equal(2);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should return nothing when you don\'t explicitly return', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('1+1'));

          case 2:
            context$3$0.t0 = context$3$0.sent;
            expect(context$3$0.t0).to.not.exist;

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should execute code inside the web view', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute(GET_RIGHT_INNERHTML));

          case 2:
            context$3$0.sent.should.be.ok;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.execute(GET_WRONG_INNERHTML));

          case 5:
            context$3$0.sent.should.not.be.ok;

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should convert selenium element arg to webview element', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'useragent'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.execute(SCROLL_INTO_VIEW, [el]));

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should catch stale or undefined element as arg', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'useragent'));

          case 2:
            el = context$3$0.sent;
            return context$3$0.abrupt('return', driver.execute(SCROLL_INTO_VIEW, [{ 'ELEMENT': el.value + 1 }]).should.beRejected);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to return multiple elements from javascript', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute(GET_ELEM_BY_TAGNAME));

          case 2:
            res = context$3$0.sent;

            expect(res).to.have.length.above(0);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
    it('should pass along non-element arguments', function callee$2$0() {
      var arg;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            arg = 'non-element-argument';
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args[0];', [arg]));

          case 3:
            context$3$0.t0 = arg;
            context$3$0.sent.should.be.equal(context$3$0.t0);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
    it('should handle return values correctly', function callee$2$0() {
      var arg;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            arg = ['one', 'two', 'three'];
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args;', arg));

          case 3:
            context$3$0.t0 = arg;
            context$3$0.sent.should.eql(context$3$0.t0);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });

  describe('asynchronous', function () {
    var _this3 = this;

    it('should bubble up javascript errors', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('\'nan\'--').should.eventually.be.rejected);

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });

    it('should execute async javascript', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(1000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.executeAsync('arguments[arguments.length - 1](123);'));

          case 4:
            context$3$0.sent.should.be.equal(123);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });

    it('should timeout when callback is not invoked', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(1000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.executeAsync('return 1 + 2').should.eventually.be.rejected);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3NhZmFyaS93ZWJ2aWV3L2V4ZWN1dGUtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozt1QkFDb0IsV0FBVzs7Ozt5QkFDYixrQkFBa0I7Ozs7OEJBQ1IsdUJBQXVCOztBQUVuRCxJQUFNLGdCQUFnQiw4Q0FBOEMsQ0FBQztBQUNyRSxJQUFNLG1CQUFtQiwyRUFBeUUsQ0FBQztBQUNuRyxJQUFNLG1CQUFtQiwrRUFBNkUsQ0FBQztBQUN2RyxJQUFNLG1CQUFtQixpREFBK0MsQ0FBQzs7QUFFekUsUUFBUSxDQUFDLDRCQUE0QixFQUFFLFlBQVk7OztBQUNqRCxNQUFNLE1BQU0sR0FBRyw0QkFBTSxJQUFJLHdCQUFXLEVBQUMsT0FBTyxFQUFFLElBQUksRUFBQyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUM7QUFDekUsUUFBTSxDQUFDOzs7OzsyQ0FBa0IsdURBQXFCLE1BQU0sQ0FBQzs7Ozs7Ozs7OztHQUFBLENBQUMsQ0FBQzs7QUFFdkQsVUFBUSxDQUFDLGFBQWEsRUFBRSxZQUFZOzs7QUFDbEMsTUFBRSxDQUFDLG9DQUFvQyxFQUFFOzs7Ozs2Q0FDakMsTUFBTSxDQUFDLE9BQU8sYUFBVyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFFBQVE7Ozs7Ozs7S0FDOUQsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQyx3QkFBd0IsRUFBRTs7Ozs7NkNBQ3BCLE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDOzs7NkJBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7Ozs7OztLQUNyRCxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLDJDQUEyQyxFQUFFOzs7Ozs2Q0FDdkMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUM7Ozs2QkFBRSxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDOzs7Ozs7O0tBQ3ZELENBQUMsQ0FBQzs7QUFFSCxN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LENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxRQUFROzs7Ozs7O0tBQ3hFLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2UyZS9zYWZhcmkvd2Vidmlldy9leGVjdXRlLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFscyBleHBlY3QgKi9cbmltcG9ydCBkZXNpcmVkIGZyb20gJy4vZGVzaXJlZCc7XG5pbXBvcnQgc2V0dXAgZnJvbSAnLi4vLi4vc2V0dXAtYmFzZSc7XG5pbXBvcnQgeyBsb2FkV2ViVmlldyB9IGZyb20gJy4uLy4uL2hlbHBlcnMvd2Vidmlldyc7XG5cbmNvbnN0IFNDUk9MTF9JTlRPX1ZJRVcgPSBgcmV0dXJuIGFyZ3VtZW50c1swXS5zY3JvbGxJbnRvVmlldyh0cnVlKTtgO1xuY29uc3QgR0VUX1JJR0hUX0lOTkVSSFRNTCA9IGByZXR1cm4gZG9jdW1lbnQuYm9keS5pbm5lckhUTUwuaW5kZXhPZignSSBhbSBzb21lIHBhZ2UgY29udGVudCcpID4gMGA7XG5jb25zdCBHRVRfV1JPTkdfSU5ORVJIVE1MID0gYHJldHVybiBkb2N1bWVudC5ib2R5LmlubmVySFRNTC5pbmRleE9mKCdJIGFtIG5vdCBzb21lIHBhZ2UgY29udGVudCcpID4gMGA7XG5jb25zdCBHRVRfRUxFTV9CWV9UQUdOQU1FID0gYHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpO2A7XG5cbmRlc2NyaWJlKCdzYWZhcmkgLSB3ZWJ2aWV3IC0gZXhlY3V0ZScsIGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgZHJpdmVyID0gc2V0dXAodGhpcywgZGVzaXJlZCwge25vUmVzZXQ6IHRydWV9LCBmYWxzZSwgdHJ1ZSkuZHJpdmVyO1xuICBiZWZvcmUoYXN5bmMgKCkgPT4gYXdhaXQgbG9hZFdlYlZpZXcoZGVzaXJlZCwgZHJpdmVyKSk7XG5cbiAgZGVzY3JpYmUoJ3N5bmNocm9ub3VzJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgYnViYmxlIHVwIGphdmFzY3JpcHQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLmV4ZWN1dGUoYCduYW4nLS1gKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXZhbCBqYXZhc2NyaXB0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlKCdyZXR1cm4gMScpKS5zaG91bGQuYmUuZXF1YWwoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBiZSByZXR1cm5pbmcgaGFyZGNvZGVkIHJlc3VsdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoJ3JldHVybiAxKzEnKSkuc2hvdWxkLmJlLmVxdWFsKDIpO1xuICAgIH0pO1xuXG4gICAgaXQoYHNob3VsZCByZXR1cm4gbm90aGluZyB3aGVuIHlvdSBkb24ndCBleHBsaWNpdGx5IHJldHVybmAsIGFzeW5jICgpID0+IHtcbiAgICAgIGV4cGVjdChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgnMSsxJykpLnRvLm5vdC5leGlzdDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBjb2RlIGluc2lkZSB0aGUgd2ViIHZpZXcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoR0VUX1JJR0hUX0lOTkVSSFRNTCkpLnNob3VsZC5iZS5vaztcbiAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZShHRVRfV1JPTkdfSU5ORVJIVE1MKSkuc2hvdWxkLm5vdC5iZS5vaztcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY29udmVydCBzZWxlbml1bSBlbGVtZW50IGFyZyB0byB3ZWJ2aWV3IGVsZW1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2lkJywgJ3VzZXJhZ2VudCcpO1xuICAgICAgYXdhaXQgZHJpdmVyLmV4ZWN1dGUoU0NST0xMX0lOVE9fVklFVywgW2VsXSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhdGNoIHN0YWxlIG9yIHVuZGVmaW5lZCBlbGVtZW50IGFzIGFyZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnaWQnLCAndXNlcmFnZW50Jyk7XG4gICAgICByZXR1cm4gZHJpdmVyLmV4ZWN1dGUoU0NST0xMX0lOVE9fVklFVywgW3snRUxFTUVOVCc6IChlbC52YWx1ZSArIDEpfV0pLnNob3VsZC5iZVJlamVjdGVkO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHJldHVybiBtdWx0aXBsZSBlbGVtZW50cyBmcm9tIGphdmFzY3JpcHQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcmVzID0gYXdhaXQgZHJpdmVyLmV4ZWN1dGUoR0VUX0VMRU1fQllfVEFHTkFNRSk7XG4gICAgICBleHBlY3QocmVzKS50by5oYXZlLmxlbmd0aC5hYm92ZSgwKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHBhc3MgYWxvbmcgbm9uLWVsZW1lbnQgYXJndW1lbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGFyZyA9ICdub24tZWxlbWVudC1hcmd1bWVudCc7XG4gICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoJ3ZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsgcmV0dXJuIGFyZ3NbMF07JywgW2FyZ10pKS5zaG91bGQuYmUuZXF1YWwoYXJnKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByZXR1cm4gdmFsdWVzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBhcmcgPSBbJ29uZScsICd0d28nLCAndGhyZWUnXTtcbiAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgndmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApOyByZXR1cm4gYXJnczsnLCBhcmcpKS5zaG91bGQuZXFsKGFyZyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhc3luY2hyb25vdXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBidWJibGUgdXAgamF2YXNjcmlwdCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBkcml2ZXIuZXhlY3V0ZShgJ25hbictLWApLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleGVjdXRlIGFzeW5jIGphdmFzY3JpcHQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBkcml2ZXIuYXN5bmNTY3JpcHRUaW1lb3V0KDEwMDApO1xuICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlQXN5bmMoYGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV0oMTIzKTtgKSkuc2hvdWxkLmJlLmVxdWFsKDEyMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRpbWVvdXQgd2hlbiBjYWxsYmFjayBpcyBub3QgaW52b2tlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGRyaXZlci5hc3luY1NjcmlwdFRpbWVvdXQoMTAwMCk7XG4gICAgICBhd2FpdCBkcml2ZXIuZXhlY3V0ZUFzeW5jKGByZXR1cm4gMSArIDJgKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZDtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4ifQ==
