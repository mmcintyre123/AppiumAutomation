'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _setupBase = require('../../setup-base');

var _setupBase2 = _interopRequireDefault(_setupBase);

var _helpersWebview = require('../../helpers/webview');

var _helpersEnv = require('../../helpers/env');

var _helpersEnv2 = _interopRequireDefault(_helpersEnv);

describe('safari - webview - cookies', function () {
  var driver = (0, _setupBase2['default'])(this, _desired2['default'], { noReset: true }).driver;

  describe('within iframe webview', function () {
    var _this = this;

    it('should be able to get cookies for a page with none', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver, _helpersEnv2['default'].TEST_END_POINT + 'iframes.html', 'Iframe guinea pig'));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.deleteCookies());

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(driver.setUrl(_helpersEnv2['default'].TEST_END_POINT));

          case 6:
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 8:
            context$3$0.sent.should.have.length(0);

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('within webview', function () {
    var _this2 = this;

    beforeEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver));

          case 2:
            return context$3$0.abrupt('return', context$3$0.sent);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to get cookies for a page', function callee$2$0() {
      var cookies;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 2:
            cookies = context$3$0.sent;

            cookies.length.should.equal(2);
            cookies[0].name.should.equal('guineacookie1');
            cookies[0].value.should.equal('i am a cookie value');
            cookies[1].name.should.equal('guineacookie2');
            cookies[1].value.should.equal('cooki√©2');

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to set a cookie for a page', function callee$2$0() {
      var newCookie, cookies;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            newCookie = {
              name: 'newcookie',
              value: 'i\'m new here'
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.deleteCookie(newCookie.name));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 5:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);

            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(driver.setCookie(newCookie));

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 12:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.include(newCookie.value);
            // should not clobber old cookies
            cookies.map(function (c) {
              return c.name;
            }).should.include('guineacookie1');
            cookies.map(function (c) {
              return c.value;
            }).should.include('i am a cookie value');

          case 17:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to set a cookie with expiry', function callee$2$0() {
      var newCookie, cookies;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            newCookie = {
              name: 'newcookie',
              value: 'i\'m new here'
            };

            newCookie.expiry = parseInt(Date.now() / 1000, 10) - 1000; // set cookie in past

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.deleteCookie(newCookie.name));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 6:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);

            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(driver.setCookie(newCookie));

          case 11:
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 13:
            cookies = context$3$0.sent;

            // should not include cookie we just added because of expiry
            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);
            // should not clobber old cookies
            cookies.map(function (c) {
              return c.name;
            }).should.include('guineacookie1');
            cookies.map(function (c) {
              return c.value;
            }).should.include('i am a cookie value');

          case 18:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to delete one cookie', function callee$2$0() {
      var newCookie, cookies;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            newCookie = {
              name: 'newcookie',
              value: 'i\'m new here'
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.deleteCookie(newCookie.name));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 5:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);

            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(driver.setCookie(newCookie));

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 12:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.include(newCookie.value);

            context$3$0.next = 17;
            return _regeneratorRuntime.awrap(driver.deleteCookie('newcookie'));

          case 17:
            context$3$0.next = 19;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 19:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);

          case 22:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to delete all cookie', function callee$2$0() {
      var newCookie, cookies;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            newCookie = {
              name: 'newcookie',
              value: 'i\'m new here'
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.deleteCookie(newCookie.name));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 5:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);

            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(driver.setCookie(newCookie));

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 12:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.include(newCookie.value);

            context$3$0.next = 17;
            return _regeneratorRuntime.awrap(driver.deleteCookies());

          case 17:
            context$3$0.next = 19;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 19:
            cookies = context$3$0.sent;

            cookies.length.should.equal(0);

          case 21:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3NhZmFyaS93ZWJ2aWV3L2Nvb2tpZXMtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O3VCQUFvQixXQUFXOzs7O3lCQUNiLGtCQUFrQjs7Ozs4QkFDUix1QkFBdUI7OzBCQUNuQyxtQkFBbUI7Ozs7QUFFbkMsUUFBUSxDQUFDLDRCQUE0QixFQUFFLFlBQVk7QUFDakQsTUFBTSxNQUFNLEdBQUcsNEJBQU0sSUFBSSx3QkFBVyxFQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQzs7QUFFNUQsVUFBUSxDQUFDLHVCQUF1QixFQUFFLFlBQVk7OztBQUM1QyxNQUFFLENBQUMsb0RBQW9ELEVBQUU7Ozs7OzZDQUNqRCx1REFBcUIsTUFBTSxFQUFFLHdCQUFJLGNBQWMsR0FBRyxjQUFjLEVBQUUsbUJBQW1CLENBQUM7Ozs7NkNBQ3RGLE1BQU0sQ0FBQyxhQUFhLEVBQUU7Ozs7NkNBQ3RCLE1BQU0sQ0FBQyxNQUFNLENBQUMsd0JBQUksY0FBYyxDQUFDOzs7OzZDQUNoQyxNQUFNLENBQUMsVUFBVSxFQUFFOzs7NkJBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQzs7Ozs7OztLQUNqRCxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7O0FBRUgsVUFBUSxDQUFDLGdCQUFnQixFQUFFLFlBQVk7OztBQUNyQyxjQUFVLENBQUM7Ozs7OzZDQUFrQix1REFBcUIsTUFBTSxDQUFDOzs7Ozs7Ozs7O0tBQUEsQ0FBQyxDQUFDOztBQUUzRCxNQUFFLENBQUMsMENBQTBDLEVBQUU7VUFDekMsT0FBTzs7Ozs7NkNBQVMsTUFBTSxDQUFDLFVBQVUsRUFBRTs7O0FBQW5DLG1CQUFPOztBQUNYLG1CQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDL0IsbUJBQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FB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LENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvc2FmYXJpL3dlYnZpZXcvY29va2llcy1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkZXNpcmVkIGZyb20gJy4vZGVzaXJlZCc7XG5pbXBvcnQgc2V0dXAgZnJvbSAnLi4vLi4vc2V0dXAtYmFzZSc7XG5pbXBvcnQgeyBsb2FkV2ViVmlldyB9IGZyb20gJy4uLy4uL2hlbHBlcnMvd2Vidmlldyc7XG5pbXBvcnQgZW52IGZyb20gJy4uLy4uL2hlbHBlcnMvZW52JztcblxuZGVzY3JpYmUoJ3NhZmFyaSAtIHdlYnZpZXcgLSBjb29raWVzJywgZnVuY3Rpb24gKCkge1xuICBjb25zdCBkcml2ZXIgPSBzZXR1cCh0aGlzLCBkZXNpcmVkLCB7bm9SZXNldDogdHJ1ZX0pLmRyaXZlcjtcblxuICBkZXNjcmliZSgnd2l0aGluIGlmcmFtZSB3ZWJ2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byBnZXQgY29va2llcyBmb3IgYSBwYWdlIHdpdGggbm9uZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGxvYWRXZWJWaWV3KGRlc2lyZWQsIGRyaXZlciwgZW52LlRFU1RfRU5EX1BPSU5UICsgJ2lmcmFtZXMuaHRtbCcsICdJZnJhbWUgZ3VpbmVhIHBpZycpO1xuICAgICAgYXdhaXQgZHJpdmVyLmRlbGV0ZUNvb2tpZXMoKTtcbiAgICAgIGF3YWl0IGRyaXZlci5zZXRVcmwoZW52LlRFU1RfRU5EX1BPSU5UKTtcbiAgICAgIChhd2FpdCBkcml2ZXIuZ2V0Q29va2llcygpKS5zaG91bGQuaGF2ZS5sZW5ndGgoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd3aXRoaW4gd2VidmlldycsIGZ1bmN0aW9uICgpIHtcbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IGF3YWl0IGxvYWRXZWJWaWV3KGRlc2lyZWQsIGRyaXZlcikpO1xuXG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIGdldCBjb29raWVzIGZvciBhIHBhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgY29va2llcyA9IGF3YWl0IGRyaXZlci5nZXRDb29raWVzKCk7XG4gICAgICBjb29raWVzLmxlbmd0aC5zaG91bGQuZXF1YWwoMik7XG4gICAgICBjb29raWVzWzBdLm5hbWUuc2hvdWxkLmVxdWFsKCdndWluZWFjb29raWUxJyk7XG4gICAgICBjb29raWVzWzBdLnZhbHVlLnNob3VsZC5lcXVhbCgnaSBhbSBhIGNvb2tpZSB2YWx1ZScpO1xuICAgICAgY29va2llc1sxXS5uYW1lLnNob3VsZC5lcXVhbCgnZ3VpbmVhY29va2llMicpO1xuICAgICAgY29va2llc1sxXS52YWx1ZS5zaG91bGQuZXF1YWwoJ2Nvb2tpw6kyJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gc2V0IGEgY29va2llIGZvciBhIHBhZ2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgbmV3Q29va2llID0ge1xuICAgICAgICBuYW1lOiBgbmV3Y29va2llYCxcbiAgICAgICAgdmFsdWU6IGBpJ20gbmV3IGhlcmVgXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBkcml2ZXIuZGVsZXRlQ29va2llKG5ld0Nvb2tpZS5uYW1lKTtcbiAgICAgIGxldCBjb29raWVzID0gYXdhaXQgZHJpdmVyLmdldENvb2tpZXMoKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLm5hbWUpLnNob3VsZC5ub3QuaW5jbHVkZShuZXdDb29raWUubmFtZSk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy52YWx1ZSkuc2hvdWxkLm5vdC5pbmNsdWRlKG5ld0Nvb2tpZS52YWx1ZSk7XG5cbiAgICAgIGF3YWl0IGRyaXZlci5zZXRDb29raWUobmV3Q29va2llKTtcbiAgICAgIGNvb2tpZXMgPSBhd2FpdCBkcml2ZXIuZ2V0Q29va2llcygpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMubmFtZSkuc2hvdWxkLmluY2x1ZGUobmV3Q29va2llLm5hbWUpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMudmFsdWUpLnNob3VsZC5pbmNsdWRlKG5ld0Nvb2tpZS52YWx1ZSk7XG4gICAgICAvLyBzaG91bGQgbm90IGNsb2JiZXIgb2xkIGNvb2tpZXNcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLm5hbWUpLnNob3VsZC5pbmNsdWRlKCdndWluZWFjb29raWUxJyk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy52YWx1ZSkuc2hvdWxkLmluY2x1ZGUoJ2kgYW0gYSBjb29raWUgdmFsdWUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byBzZXQgYSBjb29raWUgd2l0aCBleHBpcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgbmV3Q29va2llID0ge1xuICAgICAgICBuYW1lOiBgbmV3Y29va2llYCxcbiAgICAgICAgdmFsdWU6IGBpJ20gbmV3IGhlcmVgXG4gICAgICB9O1xuICAgICAgbmV3Q29va2llLmV4cGlyeSA9IHBhcnNlSW50KERhdGUubm93KCkgLyAxMDAwLCAxMCkgLSAxMDAwOyAvLyBzZXQgY29va2llIGluIHBhc3RcblxuICAgICAgYXdhaXQgZHJpdmVyLmRlbGV0ZUNvb2tpZShuZXdDb29raWUubmFtZSk7XG4gICAgICBsZXQgY29va2llcyA9IGF3YWl0IGRyaXZlci5nZXRDb29raWVzKCk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy5uYW1lKS5zaG91bGQubm90LmluY2x1ZGUobmV3Q29va2llLm5hbWUpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMudmFsdWUpLnNob3VsZC5ub3QuaW5jbHVkZShuZXdDb29raWUudmFsdWUpO1xuXG4gICAgICBhd2FpdCBkcml2ZXIuc2V0Q29va2llKG5ld0Nvb2tpZSk7XG4gICAgICBjb29raWVzID0gYXdhaXQgZHJpdmVyLmdldENvb2tpZXMoKTtcbiAgICAgIC8vIHNob3VsZCBub3QgaW5jbHVkZSBjb29raWUgd2UganVzdCBhZGRlZCBiZWNhdXNlIG9mIGV4cGlyeVxuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMubmFtZSkuc2hvdWxkLm5vdC5pbmNsdWRlKG5ld0Nvb2tpZS5uYW1lKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLnZhbHVlKS5zaG91bGQubm90LmluY2x1ZGUobmV3Q29va2llLnZhbHVlKTtcbiAgICAgIC8vIHNob3VsZCBub3QgY2xvYmJlciBvbGQgY29va2llc1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMubmFtZSkuc2hvdWxkLmluY2x1ZGUoJ2d1aW5lYWNvb2tpZTEnKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLnZhbHVlKS5zaG91bGQuaW5jbHVkZSgnaSBhbSBhIGNvb2tpZSB2YWx1ZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIGRlbGV0ZSBvbmUgY29va2llJywgYXN5bmMgKCkgPT4ge1xuICAgICAgdmFyIG5ld0Nvb2tpZSA9IHtcbiAgICAgICAgbmFtZTogYG5ld2Nvb2tpZWAsXG4gICAgICAgIHZhbHVlOiBgaSdtIG5ldyBoZXJlYFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgZHJpdmVyLmRlbGV0ZUNvb2tpZShuZXdDb29raWUubmFtZSk7XG4gICAgICBsZXQgY29va2llcyA9IGF3YWl0IGRyaXZlci5nZXRDb29raWVzKCk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy5uYW1lKS5zaG91bGQubm90LmluY2x1ZGUobmV3Q29va2llLm5hbWUpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMudmFsdWUpLnNob3VsZC5ub3QuaW5jbHVkZShuZXdDb29raWUudmFsdWUpO1xuXG4gICAgICBhd2FpdCBkcml2ZXIuc2V0Q29va2llKG5ld0Nvb2tpZSk7XG4gICAgICBjb29raWVzID0gYXdhaXQgZHJpdmVyLmdldENvb2tpZXMoKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLm5hbWUpLnNob3VsZC5pbmNsdWRlKG5ld0Nvb2tpZS5uYW1lKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLnZhbHVlKS5zaG91bGQuaW5jbHVkZShuZXdDb29raWUudmFsdWUpO1xuXG4gICAgICBhd2FpdCBkcml2ZXIuZGVsZXRlQ29va2llKCduZXdjb29raWUnKTtcbiAgICAgIGNvb2tpZXMgPSBhd2FpdCBkcml2ZXIuZ2V0Q29va2llcygpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMubmFtZSkuc2hvdWxkLm5vdC5pbmNsdWRlKG5ld0Nvb2tpZS5uYW1lKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLnZhbHVlKS5zaG91bGQubm90LmluY2x1ZGUobmV3Q29va2llLnZhbHVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byBkZWxldGUgYWxsIGNvb2tpZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBuZXdDb29raWUgPSB7XG4gICAgICAgIG5hbWU6IGBuZXdjb29raWVgLFxuICAgICAgICB2YWx1ZTogYGknbSBuZXcgaGVyZWBcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGRyaXZlci5kZWxldGVDb29raWUobmV3Q29va2llLm5hbWUpO1xuICAgICAgbGV0IGNvb2tpZXMgPSBhd2FpdCBkcml2ZXIuZ2V0Q29va2llcygpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMubmFtZSkuc2hvdWxkLm5vdC5pbmNsdWRlKG5ld0Nvb2tpZS5uYW1lKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLnZhbHVlKS5zaG91bGQubm90LmluY2x1ZGUobmV3Q29va2llLnZhbHVlKTtcblxuICAgICAgYXdhaXQgZHJpdmVyLnNldENvb2tpZShuZXdDb29raWUpO1xuICAgICAgY29va2llcyA9IGF3YWl0IGRyaXZlci5nZXRDb29raWVzKCk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy5uYW1lKS5zaG91bGQuaW5jbHVkZShuZXdDb29raWUubmFtZSk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy52YWx1ZSkuc2hvdWxkLmluY2x1ZGUobmV3Q29va2llLnZhbHVlKTtcblxuICAgICAgYXdhaXQgZHJpdmVyLmRlbGV0ZUNvb2tpZXMoKTtcbiAgICAgIGNvb2tpZXMgPSBhd2FpdCBkcml2ZXIuZ2V0Q29va2llcygpO1xuICAgICAgY29va2llcy5sZW5ndGguc2hvdWxkLmVxdWFsKDApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLi8uLiJ9
