'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _setupBase = require("../setup-base");

var _setupBase2 = _interopRequireDefault(_setupBase);

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _helpersRecipes = require('../helpers/recipes');

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

describe('testapp - find element', function () {
  var _this2 = this;

  var session = (0, _setupBase2['default'])(this, _desired2['default']);
  var driver = session.driver;

  describe('by id', function () {
    var _this = this;

    it('should first attempt to match accessibility id', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'ComputeSumButton'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getAttribute('label', el));

          case 5:
            context$3$0.sent.should.equal('Compute Sum');

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should attempt to match by string if no accessibility id matches', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'Compute Sum'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getAttribute('label', el));

          case 5:
            context$3$0.sent.should.equal('Compute Sum');

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should use a localized string if the id is a localization key', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'main.button.computeSum'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getAttribute('label', el));

          case 5:
            context$3$0.sent.should.equal('Compute Sum');

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should be able to return multiple matches', function callee$2$0() {
      var els;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElements('id', 'TextField'));

          case 2:
            els = context$3$0.sent;

            els.length.should.be.greaterThan(1);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  it('should find a single element on the app', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('class name', 'UIAButton'));

        case 2:
          el = context$2$0.sent;

          el.should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should not find any invalid elements on the app and throw error', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('class name', 'UIAButtonNotThere'))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 7/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should find alerts when they exist', function callee$1$0() {
    var els, alert;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements('class name', 'UIAButton'));

        case 2:
          els = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.click(els[1]));

        case 5:
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(driver.findElement('class name', 'UIAAlert'));

        case 7:
          alert = context$2$0.sent;
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(driver.findElementFromElement('accessibility id', 'OK', alert));

        case 10:
          context$2$0.sent.should.exist;
          context$2$0.next = 13;
          return _regeneratorRuntime.awrap(driver.findElementFromElement('accessibility id', 'Cancel', alert));

        case 13:
          context$2$0.sent.should.exist;
          context$2$0.next = 16;
          return _regeneratorRuntime.awrap(driver.postDismissAlert());

        case 16:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should not find alerts when they dont exist', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('class name', 'UIAAlert'))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 7/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should get an error when strategy doesnt exist', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('css selector', 'UIAButton'))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 32/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should find all elements by class name in the app', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements('class name', 'UIAButton'));

        case 2:
          els = context$2$0.sent;

          [4, 7].should.contain(els.length);
          els[0].should.exist;

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should not find any elements on the app but fail gracefully', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements('class name', 'UIAButtonNotThere'));

        case 2:
          els = context$2$0.sent;

          els.should.have.length(0);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should find element by valid name', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('accessibility id', 'ComputeSumButton'));

        case 2:
          el = context$2$0.sent;

          el.should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should not find element by invalid name but return respective error code', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('accessibility id', 'InvalidNameForElement'))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 7/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should find an element with accessibility id containing an apostrophe', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('accessibility id', "Access'ibility"));

        case 2:
          el = context$2$0.sent;

          el.should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should not find element by incomplete class name but return respective error code', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('class name', 'notAValidReference'))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 32/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should find multiple elements by valid name', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements('accessibility id', 'AppElem'));

        case 2:
          els = context$2$0.sent;

          els.should.have.length(3);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3Rlc3RhcHAvZmluZC1lbGVtZW50LXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozt5QkFBa0IsZUFBZTs7Ozt1QkFDYixXQUFXOzs7OzhCQUNLLG9CQUFvQjs7d0JBQzFDLFVBQVU7Ozs7QUFFeEIsUUFBUSxDQUFDLHdCQUF3QixFQUFFLFlBQVk7OztBQUM3QyxNQUFJLE9BQU8sR0FBRyw0QkFBTSxJQUFJLHVCQUFVLENBQUM7QUFDbkMsTUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQzs7QUFFNUIsVUFBUSxDQUFDLE9BQU8sRUFBRSxZQUFZOzs7QUFDNUIsTUFBRSxDQUFDLGdEQUFnRCxFQUFFO1VBQy9DLEVBQUU7Ozs7OzZDQUFTLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLGtCQUFrQixDQUFDOzs7QUFBdkQsY0FBRTs7NkNBQ0MsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDOzs7NkJBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhOzs7Ozs7O0tBQ3BFLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsa0VBQWtFLEVBQUU7VUFDakUsRUFBRTs7Ozs7NkNBQVMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDOzs7QUFBbEQsY0FBRTs7NkNBQ0MsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDOzs7NkJBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhOzs7Ozs7O0tBQ3BFLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsK0RBQStELEVBQUU7VUFDOUQsRUFBRTs7Ozs7NkNBQVMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsd0JBQXdCLENBQUM7OztBQUE3RCxjQUFFOzs2Q0FDQyxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUM7Ozs2QkFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLGFBQWE7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QzNCLENBQUMsQ0FBQztDQUVKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2UyZS90ZXN0YXBwL2ZpbmQtZWxlbWVudC1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzZXR1cCBmcm9tIFwiLi4vc2V0dXAtYmFzZVwiO1xuaW1wb3J0IGRlc2lyZWQgZnJvbSAnLi9kZXNpcmVkJztcbmltcG9ydCB7IHRocm93TWF0Y2hhYmxlRXJyb3IgfSBmcm9tICcuLi9oZWxwZXJzL3JlY2lwZXMnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuXG5kZXNjcmliZSgndGVzdGFwcCAtIGZpbmQgZWxlbWVudCcsIGZ1bmN0aW9uICgpIHtcbiAgbGV0IHNlc3Npb24gPSBzZXR1cCh0aGlzLCBkZXNpcmVkKTtcbiAgbGV0IGRyaXZlciA9IHNlc3Npb24uZHJpdmVyO1xuXG4gIGRlc2NyaWJlKCdieSBpZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGZpcnN0IGF0dGVtcHQgdG8gbWF0Y2ggYWNjZXNzaWJpbGl0eSBpZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnaWQnLCAnQ29tcHV0ZVN1bUJ1dHRvbicpO1xuICAgICAgKGF3YWl0IGRyaXZlci5nZXRBdHRyaWJ1dGUoJ2xhYmVsJywgZWwpKS5zaG91bGQuZXF1YWwoJ0NvbXB1dGUgU3VtJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGF0dGVtcHQgdG8gbWF0Y2ggYnkgc3RyaW5nIGlmIG5vIGFjY2Vzc2liaWxpdHkgaWQgbWF0Y2hlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnaWQnLCAnQ29tcHV0ZSBTdW0nKTtcbiAgICAgIChhd2FpdCBkcml2ZXIuZ2V0QXR0cmlidXRlKCdsYWJlbCcsIGVsKSkuc2hvdWxkLmVxdWFsKCdDb21wdXRlIFN1bScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgYSBsb2NhbGl6ZWQgc3RyaW5nIGlmIHRoZSBpZCBpcyBhIGxvY2FsaXphdGlvbiBrZXknLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2lkJywgJ21haW4uYnV0dG9uLmNvbXB1dGVTdW0nKTtcbiAgICAgIChhd2FpdCBkcml2ZXIuZ2V0QXR0cmlidXRlKCdsYWJlbCcsIGVsKSkuc2hvdWxkLmVxdWFsKCdDb21wdXRlIFN1bScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHJldHVybiBtdWx0aXBsZSBtYXRjaGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudHMoJ2lkJywgJ1RleHRGaWVsZCcpO1xuICAgICAgZWxzLmxlbmd0aC5zaG91bGQuYmUuZ3JlYXRlclRoYW4oMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZmluZCBhIHNpbmdsZSBlbGVtZW50IG9uIHRoZSBhcHAnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCdjbGFzcyBuYW1lJywgJ1VJQUJ1dHRvbicpO1xuICAgIGVsLnNob3VsZC5leGlzdDtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBub3QgZmluZCBhbnkgaW52YWxpZCBlbGVtZW50cyBvbiB0aGUgYXBwIGFuZCB0aHJvdyBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBCLnJlc29sdmUoZHJpdmVyLmZpbmRFbGVtZW50KCdjbGFzcyBuYW1lJywgJ1VJQUJ1dHRvbk5vdFRoZXJlJykpXG4gICAgICAuY2F0Y2godGhyb3dNYXRjaGFibGVFcnJvcilcbiAgICAgIC5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKC9qc29ud3BDb2RlOiA3Lyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZmluZCBhbGVydHMgd2hlbiB0aGV5IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbHMgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnRzKCdjbGFzcyBuYW1lJywgJ1VJQUJ1dHRvbicpO1xuICAgIGF3YWl0IGRyaXZlci5jbGljayhlbHNbMV0pO1xuICAgIGxldCBhbGVydCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnY2xhc3MgbmFtZScsICdVSUFBbGVydCcpO1xuICAgIChhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnRGcm9tRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsICdPSycsIGFsZXJ0KSkuc2hvdWxkLmV4aXN0O1xuICAgIChhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnRGcm9tRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsICdDYW5jZWwnLCBhbGVydCkpLnNob3VsZC5leGlzdDtcbiAgICBhd2FpdCBkcml2ZXIucG9zdERpc21pc3NBbGVydCgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIG5vdCBmaW5kIGFsZXJ0cyB3aGVuIHRoZXkgZG9udCBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBCLnJlc29sdmUoZHJpdmVyLmZpbmRFbGVtZW50KCdjbGFzcyBuYW1lJywgJ1VJQUFsZXJ0JykpXG4gICAgICAuY2F0Y2godGhyb3dNYXRjaGFibGVFcnJvcilcbiAgICAgIC5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKC9qc29ud3BDb2RlOiA3Lyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZ2V0IGFuIGVycm9yIHdoZW4gc3RyYXRlZ3kgZG9lc250IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IEIucmVzb2x2ZShkcml2ZXIuZmluZEVsZW1lbnQoJ2NzcyBzZWxlY3RvcicsICdVSUFCdXR0b24nKSlcbiAgICAgIC5jYXRjaCh0aHJvd01hdGNoYWJsZUVycm9yKVxuICAgICAgLnNob3VsZC5iZS5yZWplY3RlZFdpdGgoL2pzb253cENvZGU6IDMyLyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZmluZCBhbGwgZWxlbWVudHMgYnkgY2xhc3MgbmFtZSBpbiB0aGUgYXBwJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbHMgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnRzKCdjbGFzcyBuYW1lJywgJ1VJQUJ1dHRvbicpO1xuICAgIFs0LCA3XS5zaG91bGQuY29udGFpbihlbHMubGVuZ3RoKTtcbiAgICBlbHNbMF0uc2hvdWxkLmV4aXN0O1xuICB9KTtcblxuICBpdCgnc2hvdWxkIG5vdCBmaW5kIGFueSBlbGVtZW50cyBvbiB0aGUgYXBwIGJ1dCBmYWlsIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudHMoJ2NsYXNzIG5hbWUnLCAnVUlBQnV0dG9uTm90VGhlcmUnKTtcbiAgICBlbHMuc2hvdWxkLmhhdmUubGVuZ3RoKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZpbmQgZWxlbWVudCBieSB2YWxpZCBuYW1lJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsICdDb21wdXRlU3VtQnV0dG9uJyk7XG4gICAgZWwuc2hvdWxkLmV4aXN0O1xuICB9KTtcblxuICBpdCgnc2hvdWxkIG5vdCBmaW5kIGVsZW1lbnQgYnkgaW52YWxpZCBuYW1lIGJ1dCByZXR1cm4gcmVzcGVjdGl2ZSBlcnJvciBjb2RlJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IEIucmVzb2x2ZShkcml2ZXIuZmluZEVsZW1lbnQoJ2FjY2Vzc2liaWxpdHkgaWQnLCAnSW52YWxpZE5hbWVGb3JFbGVtZW50JykpXG4gICAgICAuY2F0Y2godGhyb3dNYXRjaGFibGVFcnJvcilcbiAgICAgIC5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKC9qc29ud3BDb2RlOiA3Lyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZmluZCBhbiBlbGVtZW50IHdpdGggYWNjZXNzaWJpbGl0eSBpZCBjb250YWluaW5nIGFuIGFwb3N0cm9waGUnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCdhY2Nlc3NpYmlsaXR5IGlkJywgXCJBY2Nlc3MnaWJpbGl0eVwiKTtcbiAgICBlbC5zaG91bGQuZXhpc3Q7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgbm90IGZpbmQgZWxlbWVudCBieSBpbmNvbXBsZXRlIGNsYXNzIG5hbWUgYnV0IHJldHVybiByZXNwZWN0aXZlIGVycm9yIGNvZGUnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgQi5yZXNvbHZlKGRyaXZlci5maW5kRWxlbWVudCgnY2xhc3MgbmFtZScsICdub3RBVmFsaWRSZWZlcmVuY2UnKSlcbiAgICAgIC5jYXRjaCh0aHJvd01hdGNoYWJsZUVycm9yKVxuICAgICAgLnNob3VsZC5iZS5yZWplY3RlZFdpdGgoL2pzb253cENvZGU6IDMyLyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZmluZCBtdWx0aXBsZSBlbGVtZW50cyBieSB2YWxpZCBuYW1lJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbHMgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnRzKCdhY2Nlc3NpYmlsaXR5IGlkJywgJ0FwcEVsZW0nKTtcbiAgICBlbHMuc2hvdWxkLmhhdmUubGVuZ3RoKDMpO1xuICB9KTtcblxufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uIn0=
