'use strict';

var _get = require('babel-runtime/helpers/get')['default'];

var _inherits = require('babel-runtime/helpers/inherits')['default'];

var _createClass = require('babel-runtime/helpers/create-class')['default'];

var _classCallCheck = require('babel-runtime/helpers/class-call-check')['default'];

var _slicedToArray = require('babel-runtime/helpers/sliced-to-array')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Object$assign = require('babel-runtime/core-js/object/assign')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var _utils = require('./utils');

var _utils2 = _interopRequireDefault(_utils);

var _logger = require('./logger');

var _logger2 = _interopRequireDefault(_logger);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _appiumSupport = require('appium-support');

var _appiumIosSimulator = require('appium-ios-simulator');

var _appiumUiauto = require('appium-uiauto');

var _appiumInstruments = require('appium-instruments');

var _asyncbox = require('asyncbox');

var _commandsIndex = require('./commands/index');

var _commandsIndex2 = _interopRequireDefault(_commandsIndex);

var _desiredCaps = require('./desired-caps');

var _nodeIdevice = require('node-idevice');

var _nodeIdevice2 = _interopRequireDefault(_nodeIdevice);

var _commandsSafari = require('./commands/safari');

var _safariLauncher = require('./safari-launcher');

var _settings = require('./settings');

var _device = require('./device');

var _packageJson = require('../../package.json');

// eslint-disable-line import/no-unresolved

// promisify _iDevice
var iDevice = function iDevice() {
  var device = _nodeIdevice2['default'].apply(undefined, arguments);
  var promisified = {};
  var _arr = ['install', 'installAndWait', 'remove', 'isInstalled'];
  for (var _i = 0; _i < _arr.length; _i++) {
    var m = _arr[_i];
    promisified[m] = _bluebird2['default'].promisify(device[m].bind(device));
  }
  return promisified;
};

var defaultServerCaps = {
  webStorageEnabled: false,
  locationContextEnabled: false,
  browserName: '',
  platform: 'MAC',
  javascriptEnabled: true,
  databaseEnabled: false,
  takesScreenshot: true,
  networkConnectionEnabled: false
};

var LOG_LOCATIONS = [_path2['default'].resolve('/', 'Library', 'Caches', 'com.apple.dt.instruments')];
if (process.env.HOME) {
  LOG_LOCATIONS.push(_path2['default'].resolve(process.env.HOME, 'Library', 'Logs', 'CoreSimulator'));
}

var IosDriver = (function (_BaseDriver) {
  _inherits(IosDriver, _BaseDriver);

  _createClass(IosDriver, [{
    key: 'resetIos',
    value: function resetIos() {
      this.appExt = ".app";
      this.xcodeVersion = null;
      this.iosSdkVersion = null;
      this.logs = {};
      this.instruments = null;
      this.uiAutoClient = null;
      this.onInstrumentsDie = function () {};
      this.stopping = false;
      this.cbForCurrentCmd = null;
      this.remote = null;
      this.curContext = null;
      this.curWebFrames = [];
      this.selectingNewPage = false;
      this.windowHandleCache = [];
      this.webElementIds = [];
      this.implicitWaitMs = 0;
      this.asynclibWaitMs = 0;
      this.pageLoadMs = 6000;
      this.asynclibResponseCb = null;
      this.returnedFromExecuteAtom = {};
      this.executedAtomsCounter = 0;
      this.curCoords = null;
      this.curWebCoords = null;
      this.landscapeWebCoordsOffset = 0;
      this.keepAppToRetainPrefs = false;
      this.ready = false;
      this.asyncWaitMs = 0;

      this.settings = new _appiumBaseDriver.DeviceSettings({}, _lodash2['default'].noop);

      this.locatorStrategies = ['xpath', 'id', 'class name', '-ios uiautomation', 'accessibility id'];
      this.webLocatorStrategies = ['link text', 'css selector', 'tag name', 'partial link text'];
    }
  }]);

  function IosDriver(opts, shouldValidateCaps) {
    _classCallCheck(this, IosDriver);

    _get(Object.getPrototypeOf(IosDriver.prototype), 'constructor', this).call(this, opts, shouldValidateCaps);

    _logger2['default'].debug('IosDriver version: ' + _packageJson.version);

    this.desiredCapConstraints = _desiredCaps.desiredCapConstraints;
    this.resetIos();
  }

  _createClass(IosDriver, [{
    key: 'validateLocatorStrategy',
    value: function validateLocatorStrategy(strategy) {
      _get(Object.getPrototypeOf(IosDriver.prototype), 'validateLocatorStrategy', this).call(this, strategy, this.isWebContext());
    }
  }, {
    key: 'start',
    value: function start() {
      return _regeneratorRuntime.async(function start$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!this.isRealDevice()) {
              context$2$0.next = 5;
              break;
            }

            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.startRealDevice());

          case 3:
            context$2$0.next = 7;
            break;

          case 5:
            context$2$0.next = 7;
            return _regeneratorRuntime.awrap(this.startSimulator());

          case 7:
            this.ready = true;

          case 8:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'createSession',
    value: function createSession(caps) {
      var _ref, _ref2, sessionId, msg;

      return _regeneratorRuntime.async(function createSession$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(_get(Object.getPrototypeOf(IosDriver.prototype), 'createSession', this).call(this, caps));

          case 2:
            _ref = context$2$0.sent;
            _ref2 = _slicedToArray(_ref, 1);
            sessionId = _ref2[0];
            context$2$0.next = 7;
            return _regeneratorRuntime.awrap(_utils2['default'].getAndCheckXcodeVersion(this.opts));

          case 7:
            this.xcodeVersion = context$2$0.sent;

            _logger2['default'].debug('Xcode version set to ' + this.xcodeVersion.versionString);
            if (this.xcodeVersion.major >= 8) {
              msg = 'Appium\'s IosDriver does not support xcode version ' + this.xcodeVersion.versionString + '. ' + 'Apple has deprecated UIAutomation. Use the "XCUITest" automationName capability instead.';

              _logger2['default'].errorAndThrow(new _appiumBaseDriver.errors.SessionNotCreatedError(msg));
            }

            // merge server capabilities + desired capabilities
            this.caps = _Object$assign({}, defaultServerCaps, this.caps);
            this.caps.desired = caps;

            context$2$0.next = 14;
            return _regeneratorRuntime.awrap(_utils2['default'].detectUdid(this.opts));

          case 14:
            context$2$0.next = 16;
            return _regeneratorRuntime.awrap(_utils2['default'].prepareIosOpts(this.opts));

          case 16:
            this.realDevice = null;
            this.useRobot = this.opts.useRobot;
            this.safari = this.opts.safari;
            this.opts.curOrientation = this.opts.initialOrientation;

            this.sock = _path2['default'].resolve(this.opts.tmpDir || '/tmp', 'instruments_sock');
            this.perfLogEnabled = !!(typeof this.opts.loggingPrefs === 'object' && this.opts.loggingPrefs.performance);
            context$2$0.prev = 22;
            context$2$0.next = 25;
            return _regeneratorRuntime.awrap(this.configureApp());

          case 25:
            context$2$0.next = 31;
            break;

          case 27:
            context$2$0.prev = 27;
            context$2$0.t0 = context$2$0['catch'](22);

            _logger2['default'].error('Bad app: \'' + this.opts.app + '\'. App paths need to ' + 'be absolute, or relative to the appium server ' + 'install dir, or a URL to compressed file, or a ' + 'special app name.');
            throw context$2$0.t0;

          case 31:
            context$2$0.next = 33;
            return _regeneratorRuntime.awrap(this.start());

          case 33:

            // TODO: this should be in BaseDriver.postCreateSession
            this.startNewCommandTimeout('createSession');
            return context$2$0.abrupt('return', [sessionId, this.caps]);

          case 35:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[22, 27]]);
    }
  }, {
    key: 'stop',
    value: function stop() {
      return _regeneratorRuntime.async(function stop$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            this.ready = false;

            if (!this.uiAutoClient) {
              context$2$0.next = 4;
              break;
            }

            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.uiAutoClient.shutdown());

          case 4:
            if (!this.instruments) {
              context$2$0.next = 13;
              break;
            }

            context$2$0.prev = 5;
            context$2$0.next = 8;
            return _regeneratorRuntime.awrap(this.instruments.shutdown());

          case 8:
            context$2$0.next = 13;
            break;

          case 10:
            context$2$0.prev = 10;
            context$2$0.t0 = context$2$0['catch'](5);

            _logger2['default'].error('Instruments didn\'t shut down. ' + context$2$0.t0);

          case 13:
            if (!(this.caps && this.caps.customSSLCert && !this.isRealDevice())) {
              context$2$0.next = 17;
              break;
            }

            _logger2['default'].debug('Uninstalling ssl certificate for udid \'' + this.sim.udid + '\'');
            context$2$0.next = 17;
            return _regeneratorRuntime.awrap((0, _appiumIosSimulator.uninstallSSLCert)(this.caps.customSSLCert, this.sim.udid));

          case 17:

            this.uiAutoClient = null;
            this.instruments = null;
            this.realDevice = null;

            // postcleanup
            this.curCoords = null;
            this.opts.curOrientation = null;
            if (!_lodash2['default'].isEmpty(this.logs)) {
              this.logs.syslog.stopCapture();
              this.logs = {};
            }

            if (!this.remote) {
              context$2$0.next = 26;
              break;
            }

            context$2$0.next = 26;
            return _regeneratorRuntime.awrap(this.stopRemote());

          case 26:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[5, 10]]);
    }
  }, {
    key: 'deleteSession',
    value: function deleteSession() {
      return _regeneratorRuntime.async(function deleteSession$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug("Deleting ios session");

            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.stop());

          case 3:
            if (!this.opts.clearSystemFiles) {
              context$2$0.next = 8;
              break;
            }

            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(_utils2['default'].clearLogs(LOG_LOCATIONS));

          case 6:
            context$2$0.next = 9;
            break;

          case 8:
            _logger2['default'].debug('Not clearing log files. Use `clearSystemFiles` capability to turn on.');

          case 9:
            if (!this.isRealDevice()) {
              context$2$0.next = 14;
              break;
            }

            context$2$0.next = 12;
            return _regeneratorRuntime.awrap((0, _device.runRealDeviceReset)(this.realDevice, this.opts));

          case 12:
            context$2$0.next = 16;
            break;

          case 14:
            context$2$0.next = 16;
            return _regeneratorRuntime.awrap((0, _device.runSimulatorReset)(this.sim, this.opts, this.keepAppToRetainPrefs));

          case 16:
            context$2$0.next = 18;
            return _regeneratorRuntime.awrap(_get(Object.getPrototypeOf(IosDriver.prototype), 'deleteSession', this).call(this));

          case 18:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'executeCommand',
    value: function executeCommand(cmd) {
      for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        args[_key - 1] = arguments[_key];
      }

      var _get2;

      return _regeneratorRuntime.async(function executeCommand$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug('Executing iOS command \'' + cmd + '\'');

            if (!(cmd === 'receiveAsyncResponse')) {
              context$2$0.next = 7;
              break;
            }

            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.receiveAsyncResponse.apply(this, args));

          case 4:
            return context$2$0.abrupt('return', context$2$0.sent);

          case 7:
            if (!(this.ready || _lodash2['default'].includes(['launchApp'], cmd))) {
              context$2$0.next = 11;
              break;
            }

            context$2$0.next = 10;
            return _regeneratorRuntime.awrap((_get2 = _get(Object.getPrototypeOf(IosDriver.prototype), 'executeCommand', this)).call.apply(_get2, [this, cmd].concat(args)));

          case 10:
            return context$2$0.abrupt('return', context$2$0.sent);

          case 11:
            throw new _appiumBaseDriver.errors.NoSuchDriverError('Driver is not ready, cannot execute ' + cmd + '.');

          case 12:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }

    // TODO: reformat this.helpers + configureApp
  }, {
    key: 'configureApp',
    value: function configureApp() {
      return _regeneratorRuntime.async(function configureApp$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.prev = 0;

            // if the app name is a bundleId assign it to the bundleId property
            if (!this.opts.bundleId && _utils2['default'].appIsPackageOrBundle(this.opts.app)) {
              this.opts.bundleId = this.opts.app;
            }

            if (!(this.opts.app && this.opts.app.toLowerCase() === "settings")) {
              context$2$0.next = 6;
              break;
            }

            if (parseFloat(this.opts.platformVersion) >= 8) {
              _logger2['default'].debug("We are on iOS8+ so not copying preferences app");
              this.opts.bundleId = "com.apple.Preferences";
              this.opts.app = null;
            }
            context$2$0.next = 34;
            break;

          case 6:
            if (!(this.opts.app && this.opts.app.toLowerCase() === "calendar")) {
              context$2$0.next = 10;
              break;
            }

            if (parseFloat(this.opts.platformVersion) >= 8) {
              _logger2['default'].debug("We are on iOS8+ so not copying calendar app");
              this.opts.bundleId = "com.apple.mobilecal";
              this.opts.app = null;
            }
            context$2$0.next = 34;
            break;

          case 10:
            if (!this.isSafari()) {
              context$2$0.next = 27;
              break;
            }

            if (this.isRealDevice()) {
              context$2$0.next = 15;
              break;
            }

            if (parseFloat(this.opts.platformVersion) >= 8) {
              _logger2['default'].debug("We are on iOS8+ so not copying Safari app");
              this.opts.bundleId = _commandsSafari.SAFARI_BUNDLE;
              this.opts.app = null;
            }
            context$2$0.next = 25;
            break;

          case 15:
            context$2$0.next = 17;
            return _regeneratorRuntime.awrap(this.realDevice.isInstalled(this.opts.bundleId));

          case 17:
            if (context$2$0.sent) {
              context$2$0.next = 24;
              break;
            }

            context$2$0.next = 20;
            return _regeneratorRuntime.awrap((0, _safariLauncher.needsInstall)());

          case 20:
            if (!context$2$0.sent) {
              context$2$0.next = 24;
              break;
            }

            _logger2['default'].debug('SafariLauncher not found, building...');
            context$2$0.next = 24;
            return _regeneratorRuntime.awrap((0, _safariLauncher.install)());

          case 24:
            this.opts.bundleId = _safariLauncher.SAFARI_LAUNCHER_BUNDLE;

          case 25:
            context$2$0.next = 34;
            break;

          case 27:
            if (!(this.opts.bundleId && _utils2['default'].appIsPackageOrBundle(this.opts.bundleId) && (this.opts.app === "" || _utils2['default'].appIsPackageOrBundle(this.opts.app)))) {
              context$2$0.next = 31;
              break;
            }

            // we have a bundle ID, but no app, or app is also a bundle
            _logger2['default'].debug("App is an iOS bundle, will attempt to run as pre-existing");
            context$2$0.next = 34;
            break;

          case 31:
            context$2$0.next = 33;
            return _regeneratorRuntime.awrap(this.helpers.configureApp(this.opts.app, '.app'));

          case 33:
            this.opts.app = context$2$0.sent;

          case 34:
            context$2$0.next = 40;
            break;

          case 36:
            context$2$0.prev = 36;
            context$2$0.t0 = context$2$0['catch'](0);

            _logger2['default'].error(context$2$0.t0);
            throw new Error('Bad app: ' + this.opts.app + '. App paths need to be absolute, or relative to the appium ' + "server install dir, or a URL to compressed file, or a special app name.");

          case 40:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[0, 36]]);
    }
  }, {
    key: 'startSimulator',
    value: function startSimulator() {
      var timeout, availableDevices, iosSimUdid, dString;
      return _regeneratorRuntime.async(function startSimulator$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(_utils2['default'].removeInstrumentsSocket(this.sock));

          case 2:
            if (this.xcodeVersion) {
              context$2$0.next = 8;
              break;
            }

            _logger2['default'].debug("Setting Xcode version");
            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(_utils2['default'].getAndCheckXcodeVersion(this.opts));

          case 6:
            this.xcodeVersion = context$2$0.sent;

            _logger2['default'].debug('Xcode version set to ' + this.xcodeVersion.versionString);

          case 8:

            _logger2['default'].debug("Setting iOS SDK Version");
            context$2$0.next = 11;
            return _regeneratorRuntime.awrap(_utils2['default'].getAndCheckIosSdkVersion());

          case 11:
            this.iosSdkVersion = context$2$0.sent;

            _logger2['default'].debug('iOS SDK Version set to ' + this.iosSdkVersion);

            timeout = _lodash2['default'].isObject(this.opts.launchTimeout) ? this.opts.launchTimeout.global : this.opts.launchTimeout;
            context$2$0.next = 16;
            return _regeneratorRuntime.awrap((0, _asyncbox.retry)(3, _appiumInstruments.utils.getAvailableDevices, timeout));

          case 16:
            availableDevices = context$2$0.sent;
            context$2$0.next = 19;
            return _regeneratorRuntime.awrap((0, _device.checkSimulatorAvailable)(this.opts, this.iosSdkVersion, availableDevices));

          case 19:
            iosSimUdid = context$2$0.sent;
            context$2$0.next = 22;
            return _regeneratorRuntime.awrap((0, _appiumIosSimulator.getSimulator)(iosSimUdid, this.xcodeVersion.versionString));

          case 22:
            this.sim = context$2$0.sent;
            context$2$0.next = 25;
            return _regeneratorRuntime.awrap((0, _device.moveBuiltInApp)(this.sim));

          case 25:
            context$2$0.next = 27;
            return _regeneratorRuntime.awrap(_utils2['default'].parseLocalizableStrings(this.opts));

          case 27:
            context$2$0.next = 29;
            return _regeneratorRuntime.awrap(_utils2['default'].setBundleIdFromApp(this.opts));

          case 29:
            context$2$0.next = 31;
            return _regeneratorRuntime.awrap(this.createInstruments());

          case 31:
            // previously setDeviceInfo()
            this.shouldPrelaunchSimulator = _utils2['default'].shouldPrelaunchSimulator(this.opts, this.iosSdkVersion);
            context$2$0.next = 34;
            return _regeneratorRuntime.awrap((0, _device.getAdjustedDeviceName)(this.opts));

          case 34:
            dString = context$2$0.sent;

            if (!this.caps.app) {
              context$2$0.next = 38;
              break;
            }

            context$2$0.next = 38;
            return _regeneratorRuntime.awrap(_utils2['default'].setDeviceTypeInInfoPlist(this.opts.app, dString));

          case 38:
            if (!(this.caps.customSSLCert && !this.isRealDevice())) {
              context$2$0.next = 41;
              break;
            }

            context$2$0.next = 41;
            return _regeneratorRuntime.awrap((0, _appiumIosSimulator.installSSLCert)(this.caps.customSSLCert, this.sim.udid));

          case 41:
            context$2$0.next = 43;
            return _regeneratorRuntime.awrap((0, _device.runSimulatorReset)(this.sim, this.opts, this.keepAppToRetainPrefs));

          case 43:
            context$2$0.next = 45;
            return _regeneratorRuntime.awrap((0, _device.isolateSimulatorDevice)(this.sim, this.opts));

          case 45:
            context$2$0.next = 47;
            return _regeneratorRuntime.awrap((0, _settings.setLocale)(this.sim, this.opts, this.localConfig, this.isSafari()));

          case 47:
            this.localConfig = context$2$0.sent;
            context$2$0.next = 50;
            return _regeneratorRuntime.awrap((0, _settings.setPreferences)(this.sim, this.opts, this.isSafari()));

          case 50:
            context$2$0.next = 52;
            return _regeneratorRuntime.awrap(this.startLogCapture(this.sim));

          case 52:
            context$2$0.next = 54;
            return _regeneratorRuntime.awrap(this.prelaunchSimulator());

          case 54:
            context$2$0.next = 56;
            return _regeneratorRuntime.awrap(this.startInstruments());

          case 56:
            context$2$0.next = 58;
            return _regeneratorRuntime.awrap(this.onInstrumentsLaunch());

          case 58:
            context$2$0.next = 60;
            return _regeneratorRuntime.awrap(this.configureBootstrap());

          case 60:
            context$2$0.next = 62;
            return _regeneratorRuntime.awrap(this.setBundleId());

          case 62:
            context$2$0.next = 64;
            return _regeneratorRuntime.awrap(this.setInitialOrientation());

          case 64:
            context$2$0.next = 66;
            return _regeneratorRuntime.awrap(this.initAutoWebview());

          case 66:
            context$2$0.next = 68;
            return _regeneratorRuntime.awrap(this.waitForAppLaunched());

          case 68:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'startRealDevice',
    value: function startRealDevice() {
      return _regeneratorRuntime.async(function startRealDevice$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap(_utils2['default'].removeInstrumentsSocket(this.sock));

          case 2:
            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(_utils2['default'].parseLocalizableStrings(this.opts));

          case 4:
            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(_utils2['default'].setBundleIdFromApp(this.opts));

          case 6:
            context$2$0.next = 8;
            return _regeneratorRuntime.awrap(this.createInstruments());

          case 8:
            context$2$0.next = 10;
            return _regeneratorRuntime.awrap((0, _device.runRealDeviceReset)(this.realDevice, this.opts));

          case 10:
            context$2$0.next = 12;
            return _regeneratorRuntime.awrap(this.startLogCapture());

          case 12:
            context$2$0.next = 14;
            return _regeneratorRuntime.awrap(this.installToRealDevice());

          case 14:
            context$2$0.next = 16;
            return _regeneratorRuntime.awrap(this.startInstruments());

          case 16:
            context$2$0.next = 18;
            return _regeneratorRuntime.awrap(this.onInstrumentsLaunch());

          case 18:
            context$2$0.next = 20;
            return _regeneratorRuntime.awrap(this.configureBootstrap());

          case 20:
            context$2$0.next = 22;
            return _regeneratorRuntime.awrap(this.setBundleId());

          case 22:
            context$2$0.next = 24;
            return _regeneratorRuntime.awrap(this.setInitialOrientation());

          case 24:
            context$2$0.next = 26;
            return _regeneratorRuntime.awrap(this.initAutoWebview());

          case 26:
            context$2$0.next = 28;
            return _regeneratorRuntime.awrap(this.waitForAppLaunched());

          case 28:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'installToRealDevice',
    value: function installToRealDevice() {
      var ext, msg;
      return _regeneratorRuntime.async(function installToRealDevice$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!(this.opts.autoLaunch === false)) {
              context$2$0.next = 2;
              break;
            }

            return context$2$0.abrupt('return');

          case 2:

            // if we have an ipa file, set it in opts
            if (this.opts.app) {
              ext = this.opts.app.substring(this.opts.app.length - 3).toLowerCase();

              if (ext === 'ipa') {
                this.opts.ipa = this.opts.app;
              }
            }

            if (!this.opts.udid) {
              context$2$0.next = 38;
              break;
            }

            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(this.realDevice.isInstalled(this.opts.bundleId));

          case 6:
            if (!context$2$0.sent) {
              context$2$0.next = 16;
              break;
            }

            _logger2['default'].debug("App is installed.");

            if (!this.opts.fullReset) {
              context$2$0.next = 12;
              break;
            }

            _logger2['default'].debug("fullReset requested. Forcing app install.");
            context$2$0.next = 14;
            break;

          case 12:
            _logger2['default'].debug("fullReset not requested. No need to install.");
            return context$2$0.abrupt('return');

          case 14:
            context$2$0.next = 17;
            break;

          case 16:
            _logger2['default'].debug("App is not installed. Will try to install.");

          case 17:
            if (!(this.opts.ipa && this.opts.bundleId)) {
              context$2$0.next = 23;
              break;
            }

            context$2$0.next = 20;
            return _regeneratorRuntime.awrap(this.installIpa());

          case 20:
            _logger2['default'].debug('App installed.');
            context$2$0.next = 36;
            break;

          case 23:
            if (!this.opts.ipa) {
              context$2$0.next = 29;
              break;
            }

            msg = "You specified a UDID and ipa but did not include the bundle id";

            _logger2['default'].warn(msg);
            throw new _appiumBaseDriver.errors.UnknownError(msg);

          case 29:
            if (!this.opts.app) {
              context$2$0.next = 35;
              break;
            }

            context$2$0.next = 32;
            return _regeneratorRuntime.awrap(this.realDevice.install(this.opts.app));

          case 32:
            _logger2['default'].debug('App installed.');
            context$2$0.next = 36;
            break;

          case 35:
            _logger2['default'].debug("Real device specified but no ipa or app path, assuming bundle ID is " + "on device");

          case 36:
            context$2$0.next = 39;
            break;

          case 38:
            _logger2['default'].debug("No device id or app, not installing to real device.");

          case 39:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'getIDeviceObj',
    value: function getIDeviceObj() {
      var idiPath = _path2['default'].resolve(__dirname, "../../../build/", "libimobiledevice-macosx/ideviceinstaller");
      _logger2['default'].debug('Creating iDevice object with udid ' + this.opts.udid);
      try {
        return iDevice(this.opts.udid);
      } catch (e1) {
        _logger2['default'].debug('Couldn\'t find ideviceinstaller, trying built-in at ' + idiPath);
        try {
          return iDevice(this.opts.udid, { cmd: idiPath });
        } catch (e2) {
          var msg = "Could not initialize ideviceinstaller; make sure it is " + "installed and works on your system";
          _logger2['default'].error(msg);
          throw new Error(msg);
        }
      }
    }
  }, {
    key: 'installIpa',
    value: function installIpa() {
      return _regeneratorRuntime.async(function installIpa$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug('Installing ipa found at ' + this.opts.ipa);
            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(this.realDevice.isInstalled(this.opts.bundleId));

          case 3:
            if (!context$2$0.sent) {
              context$2$0.next = 9;
              break;
            }

            _logger2['default'].debug("Bundle found on device, removing before reinstalling.");
            context$2$0.next = 7;
            return _regeneratorRuntime.awrap(this.realDevice.remove(this.opts.bundleId));

          case 7:
            context$2$0.next = 10;
            break;

          case 9:
            _logger2['default'].debug("Nothing found on device, going ahead and installing.");

          case 10:
            context$2$0.next = 12;
            return _regeneratorRuntime.awrap(this.realDevice.installAndWait(this.opts.ipa, this.opts.bundleId));

          case 12:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'validateDesiredCaps',
    value: function validateDesiredCaps(caps) {
      // check with the base class, and return if it fails
      var res = _get(Object.getPrototypeOf(IosDriver.prototype), 'validateDesiredCaps', this).call(this, caps);
      if (!res) return res;

      return (0, _desiredCaps.desiredCapValidation)(caps);
    }
  }, {
    key: 'prelaunchSimulator',
    value: function prelaunchSimulator() {
      return _regeneratorRuntime.async(function prelaunchSimulator$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (this.shouldPrelaunchSimulator) {
              context$2$0.next = 3;
              break;
            }

            _logger2['default'].debug("Not pre-launching simulator");
            return context$2$0.abrupt('return');

          case 3:
            context$2$0.next = 5;
            return _regeneratorRuntime.awrap((0, _device.endSimulator)(this.sim));

          case 5:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'onInstrumentsLaunch',

    // TODO: implement prelaunch sim in simulator package
    value: function onInstrumentsLaunch() {
      return _regeneratorRuntime.async(function onInstrumentsLaunch$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug('Instruments launched. Starting poll loop for new commands.');

            if (!this.opts.origAppPath) {
              context$2$0.next = 6;
              break;
            }

            _logger2['default'].debug("Copying app back to its original place");
            context$2$0.next = 5;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.copyFile(this.opts.app, this.opts.origAppPath));

          case 5:
            return context$2$0.abrupt('return', context$2$0.sent);

          case 6:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'setBundleId',
    value: function setBundleId() {
      var bId;
      return _regeneratorRuntime.async(function setBundleId$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!this.opts.bundleId) {
              context$2$0.next = 4;
              break;
            }

            return context$2$0.abrupt('return');

          case 4:
            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('au.bundleId()'));

          case 6:
            bId = context$2$0.sent;

            _logger2['default'].debug('Bundle ID for open app is ' + bId.value);
            this.opts.bundleId = bId.value;

          case 9:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'setInitialOrientation',
    value: function setInitialOrientation() {
      var command;
      return _regeneratorRuntime.async(function setInitialOrientation$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            if (!(typeof this.opts.initialOrientation === "string" && _lodash2['default'].includes(["LANDSCAPE", "PORTRAIT"], this.opts.initialOrientation.toUpperCase()))) {
              context$2$0.next = 12;
              break;
            }

            _logger2['default'].debug('Setting initial orientation to ' + this.opts.initialOrientation);
            command = 'au.setScreenOrientation(\'' + this.opts.initialOrientation.toUpperCase() + '\')';
            context$2$0.prev = 3;
            context$2$0.next = 6;
            return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(command));

          case 6:
            this.opts.curOrientation = this.opts.initialOrientation;
            context$2$0.next = 12;
            break;

          case 9:
            context$2$0.prev = 9;
            context$2$0.t0 = context$2$0['catch'](3);

            _logger2['default'].warn('Setting initial orientation failed with: ' + context$2$0.t0);

          case 12:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[3, 9]]);
    }
  }, {
    key: 'isRealDevice',
    value: function isRealDevice() {
      return !!this.opts.udid;
    }
  }, {
    key: 'isSafari',
    value: function isSafari() {
      return this.opts.safari;
    }
  }, {
    key: 'waitForAppLaunched',
    value: function waitForAppLaunched() {
      var condFn;
      return _regeneratorRuntime.async(function waitForAppLaunched$(context$2$0) {
        var _this = this;

        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            condFn = undefined;

            if (!this.opts.waitForAppScript) {
              context$2$0.next = 6;
              break;
            }

            // the default getSourceForElementForXML does not fit some use case, so making this customizable.
            // TODO: collect script from customer and propose several options, please comment in issue #4190.
            _logger2['default'].debug('Using custom script to wait for app start: ' + this.opts.waitForAppScript);
            condFn = function callee$2$0() {
              var res;
              return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                while (1) switch (context$3$0.prev = context$3$0.next) {
                  case 0:
                    res = undefined;
                    context$3$0.prev = 1;
                    context$3$0.next = 4;
                    return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('try{\n' + this.opts.waitForAppScript + '\n} catch(err) { $.log("waitForAppScript err: " + error); false; };'));

                  case 4:
                    res = context$3$0.sent;
                    context$3$0.next = 11;
                    break;

                  case 7:
                    context$3$0.prev = 7;
                    context$3$0.t0 = context$3$0['catch'](1);

                    _logger2['default'].debug('Cannot eval waitForAppScript script, err: ' + context$3$0.t0);
                    return context$3$0.abrupt('return', false);

                  case 11:
                    if (!(typeof res !== 'boolean')) {
                      context$3$0.next = 14;
                      break;
                    }

                    _logger2['default'].debug('Unexpected return type in waitForAppScript script');
                    return context$3$0.abrupt('return', false);

                  case 14:
                    return context$3$0.abrupt('return', res);

                  case 15:
                  case 'end':
                    return context$3$0.stop();
                }
              }, null, _this, [[1, 7]]);
            };
            context$2$0.next = 18;
            break;

          case 6:
            if (!this.isSafari()) {
              context$2$0.next = 16;
              break;
            }

            if (!this.isRealDevice()) {
              context$2$0.next = 10;
              break;
            }

            context$2$0.next = 10;
            return _regeneratorRuntime.awrap(this.clickButtonToLaunchSafari());

          case 10:
            _logger2['default'].debug('Waiting for initial webview');
            context$2$0.next = 13;
            return _regeneratorRuntime.awrap(this.navToInitialWebview());

          case 13:
            condFn = function callee$2$0() {
              return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                while (1) switch (context$3$0.prev = context$3$0.next) {
                  case 0:
                    return context$3$0.abrupt('return', true);

                  case 1:
                  case 'end':
                    return context$3$0.stop();
                }
              }, null, _this);
            };
            context$2$0.next = 18;
            break;

          case 16:
            _logger2['default'].debug("Waiting for app source to contain elements");
            condFn = function callee$2$0() {
              var source, appEls;
              return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                while (1) switch (context$3$0.prev = context$3$0.next) {
                  case 0:
                    context$3$0.prev = 0;
                    context$3$0.next = 3;
                    return _regeneratorRuntime.awrap(this.getSourceForElementForXML());

                  case 3:
                    source = context$3$0.sent;

                    source = JSON.parse(source || "{}");
                    appEls = (source.UIAApplication || {})['>'];
                    return context$3$0.abrupt('return', appEls && appEls.length > 0 && !IosDriver.isSpringBoard(source.UIAApplication));

                  case 9:
                    context$3$0.prev = 9;
                    context$3$0.t0 = context$3$0['catch'](0);

                    _logger2['default'].warn('Couldn\'t extract app element from source, error was: ' + context$3$0.t0);
                    return context$3$0.abrupt('return', false);

                  case 13:
                  case 'end':
                    return context$3$0.stop();
                }
              }, null, _this, [[0, 9]]);
            };

          case 18:
            context$2$0.prev = 18;
            context$2$0.next = 21;
            return _regeneratorRuntime.awrap((0, _asyncbox.waitForCondition)(condFn, { logger: _logger2['default'], waitMs: 10000, intervalMs: 500 }));

          case 21:
            context$2$0.next = 31;
            break;

          case 23:
            context$2$0.prev = 23;
            context$2$0.t0 = context$2$0['catch'](18);

            if (!(context$2$0.t0.message && context$2$0.t0.message.match(/Condition unmet/))) {
              context$2$0.next = 30;
              break;
            }

            _logger2['default'].warn('Initial spin timed out, continuing but the app might not be ready.');
            _logger2['default'].debug('Initial spin error was: ' + context$2$0.t0);
            context$2$0.next = 31;
            break;

          case 30:
            throw context$2$0.t0;

          case 31:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[18, 23]]);
    }
  }, {
    key: 'createInstruments',
    value: function createInstruments() {
      return _regeneratorRuntime.async(function createInstruments$(context$2$0) {
        var _this2 = this;

        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug("Creating instruments");
            this.uiAutoClient = new _appiumUiauto.UIAutoClient(this.sock);
            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.makeInstruments());

          case 4:
            this.instruments = context$2$0.sent;

            this.instruments.onShutdown['catch'](function callee$2$0() {
              return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                while (1) switch (context$3$0.prev = context$3$0.next) {
                  case 0:
                    context$3$0.next = 2;
                    return _regeneratorRuntime.awrap(this.startUnexpectedShutdown(new _appiumBaseDriver.errors.UnknownError('Abnormal Instruments termination!')));

                  case 2:
                  case 'end':
                    return context$3$0.stop();
                }
              }, null, _this2);
            }).done();

          case 6:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'shouldIgnoreInstrumentsExit',
    value: function shouldIgnoreInstrumentsExit() {
      return this.safari && this.isRealDevice();
    }
  }, {
    key: 'makeInstruments',
    value: function makeInstruments() {
      var bootstrapPath, instruments;
      return _regeneratorRuntime.async(function makeInstruments$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap((0, _appiumUiauto.prepareBootstrap)({
              sock: this.sock,
              interKeyDelay: this.opts.interKeyDelay,
              justLoopInfinitely: false,
              autoAcceptAlerts: this.opts.autoAcceptAlerts,
              autoDismissAlerts: this.opts.autoDismissAlerts,
              sendKeyStrategy: this.opts.sendKeyStrategy || (this.isRealDevice() ? 'grouped' : 'oneByOne')
            }));

          case 2:
            bootstrapPath = context$2$0.sent;
            context$2$0.t0 = _appiumInstruments.Instruments;
            context$2$0.t1 = (!this.isRealDevice() ? this.opts.app : null) || this.opts.bundleId;
            context$2$0.t2 = this.opts.udid;
            context$2$0.t3 = this.opts.processArguments;
            context$2$0.t4 = this.shouldIgnoreInstrumentsExit();
            context$2$0.t5 = bootstrapPath;
            context$2$0.t6 = this.opts.automationTraceTemplatePath;
            context$2$0.t7 = this.opts.instrumentsPath;
            context$2$0.t8 = this.opts.withoutDelay;
            context$2$0.t9 = this.opts.platformVersion;
            context$2$0.t10 = this.opts.webSocket;
            context$2$0.t11 = this.opts.launchTimeout;
            context$2$0.t12 = this.opts.backendRetries;
            context$2$0.t13 = this.isRealDevice();

            if (!(this.iosSdkVersion >= 7.1)) {
              context$2$0.next = 23;
              break;
            }

            context$2$0.next = 20;
            return _regeneratorRuntime.awrap((0, _device.getAdjustedDeviceName)(this.opts));

          case 20:
            context$2$0.t14 = context$2$0.sent;
            context$2$0.next = 24;
            break;

          case 23:
            context$2$0.t14 = null;

          case 24:
            context$2$0.t15 = context$2$0.t14;
            context$2$0.t16 = _path2['default'].resolve(this.opts.tmpDir || '/tmp', 'appium-instruments');
            context$2$0.t17 = this.opts.traceDir;
            context$2$0.t18 = this.opts.locale;
            context$2$0.t19 = this.opts.language;
            context$2$0.t20 = {
              app: context$2$0.t1,
              udid: context$2$0.t2,
              processArguments: context$2$0.t3,
              ignoreStartupExit: context$2$0.t4,
              bootstrap: context$2$0.t5,
              template: context$2$0.t6,
              instrumentsPath: context$2$0.t7,
              withoutDelay: context$2$0.t8,
              platformVersion: context$2$0.t9,
              webSocket: context$2$0.t10,
              launchTimeout: context$2$0.t11,
              flakeyRetries: context$2$0.t12,
              realDevice: context$2$0.t13,
              simulatorSdkAndDevice: context$2$0.t15,
              tmpDir: context$2$0.t16,
              traceDir: context$2$0.t17,
              locale: context$2$0.t18,
              language: context$2$0.t19
            };
            instruments = new context$2$0.t0(context$2$0.t20);
            return context$2$0.abrupt('return', instruments);

          case 32:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'startInstruments',
    value: function startInstruments() {
      return _regeneratorRuntime.async(function startInstruments$(context$2$0) {
        var _this3 = this;

        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug("Starting UIAutoClient, and launching Instruments.");

            context$2$0.next = 3;
            return _regeneratorRuntime.awrap(_bluebird2['default'].all([this.uiAutoClient.start().then(function () {
              _this3.instruments.registerLaunch();
            }), this.instruments.launch()]));

          case 3:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'configureBootstrap',
    value: function configureBootstrap() {
      var isVerbose, cmd;
      return _regeneratorRuntime.async(function configureBootstrap$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            _logger2['default'].debug("Setting bootstrap config keys/values");
            isVerbose = true;
            cmd = 'target = $.target();\n';

            cmd += 'au = $;\n';
            cmd += '$.isVerbose = ' + isVerbose + ';\n';
            // Not using uiauto grace period because of bug.
            // cmd += '$.target().setTimeout(1);\n';
            context$2$0.next = 7;
            return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand(cmd));

          case 7:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'getSourceForElementForXML',
    value: function getSourceForElementForXML(ctx) {
      var source;
      return _regeneratorRuntime.async(function getSourceForElementForXML$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            source = undefined;

            if (ctx) {
              context$2$0.next = 7;
              break;
            }

            context$2$0.next = 4;
            return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand("au.mainApp().getTreeForXML()"));

          case 4:
            source = context$2$0.sent;
            context$2$0.next = 10;
            break;

          case 7:
            context$2$0.next = 9;
            return _regeneratorRuntime.awrap(this.uiAutoClient.sendCommand('au.getElement(\'' + ctx + '\').getTreeForXML()'));

          case 9:
            source = context$2$0.sent;

          case 10:
            if (!source) {
              context$2$0.next = 14;
              break;
            }

            return context$2$0.abrupt('return', JSON.stringify(source));

          case 14:
            throw new Error('Bad response from getTreeForXML. res was ' + JSON.stringify(source));

          case 15:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'realDevice',
    get: function get() {
      this._realDevice = this._realDevice || this.getIDeviceObj();
      return this._realDevice;
    },
    set: function set(rd) {
      this._realDevice = rd;
    }
  }], [{
    key: 'isSpringBoard',
    value: function isSpringBoard(uiAppObj) {
      // TODO: move to helpers
      // Test for iOS homescreen (SpringBoard). AUT occassionally start the sim, but fails to load
      // the app. If that occurs, getSourceForElementFoXML will return a doc object that meets our
      // app-check conditions, resulting in a false positive. This function tests the UiApplication
      // property's meta data to ensure that the Appium doesn't confuse SpringBoard with the app
      // under test.
      return _lodash2['default'].propertyOf(uiAppObj['@'])('name') === 'SpringBoard';
    }
  }]);

  return IosDriver;
})(_appiumBaseDriver.BaseDriver);

var _iteratorNormalCompletion = true;
var _didIteratorError = false;
var _iteratorError = undefined;

try {

  for (var _iterator = _getIterator(_lodash2['default'].toPairs(_commandsIndex2['default'])), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
    var _step$value = _slicedToArray(_step.value, 2);

    var cmd = _step$value[0];
    var fn = _step$value[1];

    IosDriver.prototype[cmd] = fn;
  }
} catch (err) {
  _didIteratorError = true;
  _iteratorError = err;
} finally {
  try {
    if (!_iteratorNormalCompletion && _iterator['return']) {
      _iterator['return']();
    }
  } finally {
    if (_didIteratorError) {
      throw _iteratorError;
    }
  }
}

exports.IosDriver = IosDriver;
exports.defaultServerCaps = defaultServerCaps;
exports['default'] = IosDriver;

// appium-ios-driver uses Instruments to automate the device
// but Xcode 8 does not have Instruments, so short circuit

// on real device, need to check if safari launcher exists
// first check if it is already on the device

// it's not on the device, so check if we need to build

// if user has passed in desiredCaps.autoLaunch = false
// meaning they will manage app install / launching

// We already have a bundle Id

// on iOS8 in particular, we can get a working session before the app
// is ready to respond to commands; in that case the source will be empty
// so we just spin until it's not
// eslint-disable-line promise/catch-or-return
// unexpected exit

// at the moment all the logging in uiauto is at debug level

// on real devices bundleId is always used
// TODO: level was configured according to logger

// TODO: all this json/xml logic is very expensive, we need
// to use a SAX parser instead.

// this should never happen but we've received bug reports; this will help us track down
// what's wrong in getTreeForXML
//# sourceMappingURL=data:application/json;charset=utf8;base64,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anMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlRHJpdmVyLCBEZXZpY2VTZXR0aW5ncywgZXJyb3JzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB1dGlscyBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgZnMgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBnZXRTaW11bGF0b3IsIGluc3RhbGxTU0xDZXJ0LCB1bmluc3RhbGxTU0xDZXJ0IH0gZnJvbSAnYXBwaXVtLWlvcy1zaW11bGF0b3InO1xuaW1wb3J0IHsgcHJlcGFyZUJvb3RzdHJhcCwgVUlBdXRvQ2xpZW50IH0gZnJvbSAnYXBwaXVtLXVpYXV0byc7XG5pbXBvcnQgeyBJbnN0cnVtZW50cywgdXRpbHMgYXMgaW5zdHJ1bWVudHNVdGlscyB9IGZyb20gJ2FwcGl1bS1pbnN0cnVtZW50cyc7XG5pbXBvcnQgeyByZXRyeSwgd2FpdEZvckNvbmRpdGlvbiB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCBjb21tYW5kcyBmcm9tICcuL2NvbW1hbmRzL2luZGV4JztcbmltcG9ydCB7IGRlc2lyZWRDYXBDb25zdHJhaW50cywgZGVzaXJlZENhcFZhbGlkYXRpb24gfSBmcm9tICcuL2Rlc2lyZWQtY2Fwcyc7XG5pbXBvcnQgX2lEZXZpY2UgZnJvbSAnbm9kZS1pZGV2aWNlJztcbmltcG9ydCB7IFNBRkFSSV9CVU5ETEUgfSBmcm9tICcuL2NvbW1hbmRzL3NhZmFyaSc7XG5pbXBvcnQgeyBpbnN0YWxsLCBuZWVkc0luc3RhbGwsIFNBRkFSSV9MQVVOQ0hFUl9CVU5ETEUgfSBmcm9tICcuL3NhZmFyaS1sYXVuY2hlcic7XG5pbXBvcnQgeyBzZXRMb2NhbGUsIHNldFByZWZlcmVuY2VzIH0gZnJvbSAnLi9zZXR0aW5ncyc7XG5pbXBvcnQgeyBydW5TaW11bGF0b3JSZXNldCwgaXNvbGF0ZVNpbXVsYXRvckRldmljZSwgY2hlY2tTaW11bGF0b3JBdmFpbGFibGUsXG4gICAgICAgICBtb3ZlQnVpbHRJbkFwcCwgZ2V0QWRqdXN0ZWREZXZpY2VOYW1lLCBlbmRTaW11bGF0b3IsIHJ1blJlYWxEZXZpY2VSZXNldCB9IGZyb20gJy4vZGV2aWNlJztcbmltcG9ydCB7IHZlcnNpb24gfSBmcm9tICcuLi8uLi9wYWNrYWdlLmpzb24nOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGltcG9ydC9uby11bnJlc29sdmVkXG5cblxuLy8gcHJvbWlzaWZ5IF9pRGV2aWNlXG5sZXQgaURldmljZSA9IGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gIGxldCBkZXZpY2UgPSBfaURldmljZSguLi5hcmdzKTtcbiAgbGV0IHByb21pc2lmaWVkID0ge307XG4gIGZvciAobGV0IG0gb2YgWydpbnN0YWxsJywgJ2luc3RhbGxBbmRXYWl0JywgJ3JlbW92ZScsICdpc0luc3RhbGxlZCddKSB7XG4gICAgcHJvbWlzaWZpZWRbbV0gPSBCLnByb21pc2lmeShkZXZpY2VbbV0uYmluZChkZXZpY2UpKTtcbiAgfVxuICByZXR1cm4gcHJvbWlzaWZpZWQ7XG59O1xuXG5jb25zdCBkZWZhdWx0U2VydmVyQ2FwcyA9IHtcbiAgd2ViU3RvcmFnZUVuYWJsZWQ6IGZhbHNlLFxuICBsb2NhdGlvbkNvbnRleHRFbmFibGVkOiBmYWxzZSxcbiAgYnJvd3Nlck5hbWU6ICcnLFxuICBwbGF0Zm9ybTogJ01BQycsXG4gIGphdmFzY3JpcHRFbmFibGVkOiB0cnVlLFxuICBkYXRhYmFzZUVuYWJsZWQ6IGZhbHNlLFxuICB0YWtlc1NjcmVlbnNob3Q6IHRydWUsXG4gIG5ldHdvcmtDb25uZWN0aW9uRW5hYmxlZDogZmFsc2UsXG59O1xuXG5jb25zdCBMT0dfTE9DQVRJT05TID0gW1xuICBwYXRoLnJlc29sdmUoJy8nLCAnTGlicmFyeScsICdDYWNoZXMnLCAnY29tLmFwcGxlLmR0Lmluc3RydW1lbnRzJyksXG5dO1xuaWYgKHByb2Nlc3MuZW52LkhPTUUpIHtcbiAgTE9HX0xPQ0FUSU9OUy5wdXNoKHBhdGgucmVzb2x2ZShwcm9jZXNzLmVudi5IT01FLCAnTGlicmFyeScsICdMb2dzJywgJ0NvcmVTaW11bGF0b3InKSk7XG59XG5cbmNsYXNzIElvc0RyaXZlciBleHRlbmRzIEJhc2VEcml2ZXIge1xuICByZXNldElvcyAoKSB7XG4gICAgdGhpcy5hcHBFeHQgPSBcIi5hcHBcIjtcbiAgICB0aGlzLnhjb2RlVmVyc2lvbiA9IG51bGw7XG4gICAgdGhpcy5pb3NTZGtWZXJzaW9uID0gbnVsbDtcbiAgICB0aGlzLmxvZ3MgPSB7fTtcbiAgICB0aGlzLmluc3RydW1lbnRzID0gbnVsbDtcbiAgICB0aGlzLnVpQXV0b0NsaWVudCA9IG51bGw7XG4gICAgdGhpcy5vbkluc3RydW1lbnRzRGllID0gZnVuY3Rpb24gKCkge307XG4gICAgdGhpcy5zdG9wcGluZyA9IGZhbHNlO1xuICAgIHRoaXMuY2JGb3JDdXJyZW50Q21kID0gbnVsbDtcbiAgICB0aGlzLnJlbW90ZSA9IG51bGw7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gbnVsbDtcbiAgICB0aGlzLmN1cldlYkZyYW1lcyA9IFtdO1xuICAgIHRoaXMuc2VsZWN0aW5nTmV3UGFnZSA9IGZhbHNlO1xuICAgIHRoaXMud2luZG93SGFuZGxlQ2FjaGUgPSBbXTtcbiAgICB0aGlzLndlYkVsZW1lbnRJZHMgPSBbXTtcbiAgICB0aGlzLmltcGxpY2l0V2FpdE1zID0gMDtcbiAgICB0aGlzLmFzeW5jbGliV2FpdE1zID0gMDtcbiAgICB0aGlzLnBhZ2VMb2FkTXMgPSA2MDAwO1xuICAgIHRoaXMuYXN5bmNsaWJSZXNwb25zZUNiID0gbnVsbDtcbiAgICB0aGlzLnJldHVybmVkRnJvbUV4ZWN1dGVBdG9tID0ge307XG4gICAgdGhpcy5leGVjdXRlZEF0b21zQ291bnRlciA9IDA7XG4gICAgdGhpcy5jdXJDb29yZHMgPSBudWxsO1xuICAgIHRoaXMuY3VyV2ViQ29vcmRzID0gbnVsbDtcbiAgICB0aGlzLmxhbmRzY2FwZVdlYkNvb3Jkc09mZnNldCA9IDA7XG4gICAgdGhpcy5rZWVwQXBwVG9SZXRhaW5QcmVmcyA9IGZhbHNlO1xuICAgIHRoaXMucmVhZHkgPSBmYWxzZTtcbiAgICB0aGlzLmFzeW5jV2FpdE1zID0gMDtcblxuICAgIHRoaXMuc2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3Moe30sIF8ubm9vcCk7XG5cbiAgICB0aGlzLmxvY2F0b3JTdHJhdGVnaWVzID0gW1xuICAgICAgJ3hwYXRoJyxcbiAgICAgICdpZCcsXG4gICAgICAnY2xhc3MgbmFtZScsXG4gICAgICAnLWlvcyB1aWF1dG9tYXRpb24nLFxuICAgICAgJ2FjY2Vzc2liaWxpdHkgaWQnXG4gICAgXTtcbiAgICB0aGlzLndlYkxvY2F0b3JTdHJhdGVnaWVzID0gW1xuICAgICAgJ2xpbmsgdGV4dCcsXG4gICAgICAnY3NzIHNlbGVjdG9yJyxcbiAgICAgICd0YWcgbmFtZScsXG4gICAgICAncGFydGlhbCBsaW5rIHRleHQnXG4gICAgXTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yIChvcHRzLCBzaG91bGRWYWxpZGF0ZUNhcHMpIHtcbiAgICBzdXBlcihvcHRzLCBzaG91bGRWYWxpZGF0ZUNhcHMpO1xuXG4gICAgbG9nZ2VyLmRlYnVnKGBJb3NEcml2ZXIgdmVyc2lvbjogJHt2ZXJzaW9ufWApO1xuXG4gICAgdGhpcy5kZXNpcmVkQ2FwQ29uc3RyYWludHMgPSBkZXNpcmVkQ2FwQ29uc3RyYWludHM7XG4gICAgdGhpcy5yZXNldElvcygpO1xuICB9XG5cbiAgdmFsaWRhdGVMb2NhdG9yU3RyYXRlZ3kgKHN0cmF0ZWd5KSB7XG4gICAgc3VwZXIudmFsaWRhdGVMb2NhdG9yU3RyYXRlZ3koc3RyYXRlZ3ksIHRoaXMuaXNXZWJDb250ZXh0KCkpO1xuICB9XG5cbiAgYXN5bmMgc3RhcnQgKCkge1xuICAgIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICBhd2FpdCB0aGlzLnN0YXJ0UmVhbERldmljZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCB0aGlzLnN0YXJ0U2ltdWxhdG9yKCk7XG4gICAgfVxuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlU2Vzc2lvbiAoY2Fwcykge1xuICAgIGxldCBbc2Vzc2lvbklkXSA9IGF3YWl0IHN1cGVyLmNyZWF0ZVNlc3Npb24oY2Fwcyk7XG5cbiAgICAvLyBhcHBpdW0taW9zLWRyaXZlciB1c2VzIEluc3RydW1lbnRzIHRvIGF1dG9tYXRlIHRoZSBkZXZpY2VcbiAgICAvLyBidXQgWGNvZGUgOCBkb2VzIG5vdCBoYXZlIEluc3RydW1lbnRzLCBzbyBzaG9ydCBjaXJjdWl0XG4gICAgdGhpcy54Y29kZVZlcnNpb24gPSBhd2FpdCB1dGlscy5nZXRBbmRDaGVja1hjb2RlVmVyc2lvbih0aGlzLm9wdHMpO1xuICAgIGxvZ2dlci5kZWJ1ZyhgWGNvZGUgdmVyc2lvbiBzZXQgdG8gJHt0aGlzLnhjb2RlVmVyc2lvbi52ZXJzaW9uU3RyaW5nfWApO1xuICAgIGlmICh0aGlzLnhjb2RlVmVyc2lvbi5tYWpvciA+PSA4KSB7XG4gICAgICBsZXQgbXNnID0gYEFwcGl1bSdzIElvc0RyaXZlciBkb2VzIG5vdCBzdXBwb3J0IHhjb2RlIHZlcnNpb24gJHt0aGlzLnhjb2RlVmVyc2lvbi52ZXJzaW9uU3RyaW5nfS4gYCArXG4gICAgICAgICAgICAgICAgJ0FwcGxlIGhhcyBkZXByZWNhdGVkIFVJQXV0b21hdGlvbi4gVXNlIHRoZSBcIlhDVUlUZXN0XCIgYXV0b21hdGlvbk5hbWUgY2FwYWJpbGl0eSBpbnN0ZWFkLic7XG4gICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhuZXcgZXJyb3JzLlNlc3Npb25Ob3RDcmVhdGVkRXJyb3IobXNnKSk7XG4gICAgfVxuXG4gICAgLy8gbWVyZ2Ugc2VydmVyIGNhcGFiaWxpdGllcyArIGRlc2lyZWQgY2FwYWJpbGl0aWVzXG4gICAgdGhpcy5jYXBzID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdFNlcnZlckNhcHMsIHRoaXMuY2Fwcyk7XG4gICAgdGhpcy5jYXBzLmRlc2lyZWQgPSBjYXBzO1xuXG4gICAgYXdhaXQgdXRpbHMuZGV0ZWN0VWRpZCh0aGlzLm9wdHMpO1xuICAgIGF3YWl0IHV0aWxzLnByZXBhcmVJb3NPcHRzKHRoaXMub3B0cyk7XG4gICAgdGhpcy5yZWFsRGV2aWNlID0gbnVsbDtcbiAgICB0aGlzLnVzZVJvYm90ID0gdGhpcy5vcHRzLnVzZVJvYm90O1xuICAgIHRoaXMuc2FmYXJpID0gdGhpcy5vcHRzLnNhZmFyaTtcbiAgICB0aGlzLm9wdHMuY3VyT3JpZW50YXRpb24gPSB0aGlzLm9wdHMuaW5pdGlhbE9yaWVudGF0aW9uO1xuXG4gICAgdGhpcy5zb2NrID0gcGF0aC5yZXNvbHZlKHRoaXMub3B0cy50bXBEaXIgfHwgJy90bXAnLCAnaW5zdHJ1bWVudHNfc29jaycpO1xuICAgIHRoaXMucGVyZkxvZ0VuYWJsZWQgPSAhISh0eXBlb2YgdGhpcy5vcHRzLmxvZ2dpbmdQcmVmcyA9PT0gJ29iamVjdCcgJiYgdGhpcy5vcHRzLmxvZ2dpbmdQcmVmcy5wZXJmb3JtYW5jZSk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuY29uZmlndXJlQXBwKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoYEJhZCBhcHA6ICcke3RoaXMub3B0cy5hcHB9Jy4gQXBwIHBhdGhzIG5lZWQgdG8gYCArXG4gICAgICAgICAgICAgICAgICAgYGJlIGFic29sdXRlLCBvciByZWxhdGl2ZSB0byB0aGUgYXBwaXVtIHNlcnZlciBgICtcbiAgICAgICAgICAgICAgICAgICBgaW5zdGFsbCBkaXIsIG9yIGEgVVJMIHRvIGNvbXByZXNzZWQgZmlsZSwgb3IgYSBgICtcbiAgICAgICAgICAgICAgICAgICBgc3BlY2lhbCBhcHAgbmFtZS5gKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgYXdhaXQgdGhpcy5zdGFydCgpO1xuXG4gICAgLy8gVE9ETzogdGhpcyBzaG91bGQgYmUgaW4gQmFzZURyaXZlci5wb3N0Q3JlYXRlU2Vzc2lvblxuICAgIHRoaXMuc3RhcnROZXdDb21tYW5kVGltZW91dCgnY3JlYXRlU2Vzc2lvbicpO1xuICAgIHJldHVybiBbc2Vzc2lvbklkLCB0aGlzLmNhcHNdO1xuICB9XG5cbiAgYXN5bmMgc3RvcCAoKSB7XG4gICAgdGhpcy5yZWFkeSA9IGZhbHNlO1xuXG4gICAgaWYgKHRoaXMudWlBdXRvQ2xpZW50KSB7XG4gICAgICBhd2FpdCB0aGlzLnVpQXV0b0NsaWVudC5zaHV0ZG93bigpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmluc3RydW1lbnRzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmluc3RydW1lbnRzLnNodXRkb3duKCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKGBJbnN0cnVtZW50cyBkaWRuJ3Qgc2h1dCBkb3duLiAke2Vycn1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5jYXBzICYmIHRoaXMuY2Fwcy5jdXN0b21TU0xDZXJ0ICYmICF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICBsb2dnZXIuZGVidWcoYFVuaW5zdGFsbGluZyBzc2wgY2VydGlmaWNhdGUgZm9yIHVkaWQgJyR7dGhpcy5zaW0udWRpZH0nYCk7XG4gICAgICBhd2FpdCB1bmluc3RhbGxTU0xDZXJ0KHRoaXMuY2Fwcy5jdXN0b21TU0xDZXJ0LCB0aGlzLnNpbS51ZGlkKTtcbiAgICB9XG5cbiAgICB0aGlzLnVpQXV0b0NsaWVudCA9IG51bGw7XG4gICAgdGhpcy5pbnN0cnVtZW50cyA9IG51bGw7XG4gICAgdGhpcy5yZWFsRGV2aWNlID0gbnVsbDtcblxuICAgIC8vIHBvc3RjbGVhbnVwXG4gICAgdGhpcy5jdXJDb29yZHMgPSBudWxsO1xuICAgIHRoaXMub3B0cy5jdXJPcmllbnRhdGlvbiA9IG51bGw7XG4gICAgaWYgKCFfLmlzRW1wdHkodGhpcy5sb2dzKSkge1xuICAgICAgdGhpcy5sb2dzLnN5c2xvZy5zdG9wQ2FwdHVyZSgpO1xuICAgICAgdGhpcy5sb2dzID0ge307XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucmVtb3RlKSB7XG4gICAgICBhd2FpdCB0aGlzLnN0b3BSZW1vdGUoKTtcbiAgICB9XG5cbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVNlc3Npb24gKCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIkRlbGV0aW5nIGlvcyBzZXNzaW9uXCIpO1xuXG4gICAgYXdhaXQgdGhpcy5zdG9wKCk7XG5cbiAgICBpZiAodGhpcy5vcHRzLmNsZWFyU3lzdGVtRmlsZXMpIHtcbiAgICAgIGF3YWl0IHV0aWxzLmNsZWFyTG9ncyhMT0dfTE9DQVRJT05TKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdOb3QgY2xlYXJpbmcgbG9nIGZpbGVzLiBVc2UgYGNsZWFyU3lzdGVtRmlsZXNgIGNhcGFiaWxpdHkgdG8gdHVybiBvbi4nKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgYXdhaXQgcnVuUmVhbERldmljZVJlc2V0KHRoaXMucmVhbERldmljZSwgdGhpcy5vcHRzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgcnVuU2ltdWxhdG9yUmVzZXQodGhpcy5zaW0sIHRoaXMub3B0cywgdGhpcy5rZWVwQXBwVG9SZXRhaW5QcmVmcyk7XG4gICAgfVxuICAgIGF3YWl0IHN1cGVyLmRlbGV0ZVNlc3Npb24oKTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGVDb21tYW5kIChjbWQsIC4uLmFyZ3MpIHtcbiAgICBsb2dnZXIuZGVidWcoYEV4ZWN1dGluZyBpT1MgY29tbWFuZCAnJHtjbWR9J2ApO1xuICAgIGlmIChjbWQgPT09ICdyZWNlaXZlQXN5bmNSZXNwb25zZScpIHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlY2VpdmVBc3luY1Jlc3BvbnNlKC4uLmFyZ3MpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5yZWFkeSB8fCBfLmluY2x1ZGVzKFsnbGF1bmNoQXBwJ10sIGNtZCkpIHtcbiAgICAgIHJldHVybiBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChjbWQsIC4uLmFyZ3MpO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBlcnJvcnMuTm9TdWNoRHJpdmVyRXJyb3IoYERyaXZlciBpcyBub3QgcmVhZHksIGNhbm5vdCBleGVjdXRlICR7Y21kfS5gKTtcbiAgfVxuXG4gIC8vIFRPRE86IHJlZm9ybWF0IHRoaXMuaGVscGVycyArIGNvbmZpZ3VyZUFwcFxuICBhc3luYyBjb25maWd1cmVBcHAgKCkge1xuICAgIHRyeSB7XG4gICAgICAvLyBpZiB0aGUgYXBwIG5hbWUgaXMgYSBidW5kbGVJZCBhc3NpZ24gaXQgdG8gdGhlIGJ1bmRsZUlkIHByb3BlcnR5XG4gICAgICBpZiAoIXRoaXMub3B0cy5idW5kbGVJZCAmJiB1dGlscy5hcHBJc1BhY2thZ2VPckJ1bmRsZSh0aGlzLm9wdHMuYXBwKSkge1xuICAgICAgICB0aGlzLm9wdHMuYnVuZGxlSWQgPSB0aGlzLm9wdHMuYXBwO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vcHRzLmFwcCAmJiB0aGlzLm9wdHMuYXBwLnRvTG93ZXJDYXNlKCkgPT09IFwic2V0dGluZ3NcIikge1xuICAgICAgICBpZiAocGFyc2VGbG9hdCh0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uKSA+PSA4KSB7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKFwiV2UgYXJlIG9uIGlPUzgrIHNvIG5vdCBjb3B5aW5nIHByZWZlcmVuY2VzIGFwcFwiKTtcbiAgICAgICAgICB0aGlzLm9wdHMuYnVuZGxlSWQgPSBcImNvbS5hcHBsZS5QcmVmZXJlbmNlc1wiO1xuICAgICAgICAgIHRoaXMub3B0cy5hcHAgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3B0cy5hcHAgJiYgdGhpcy5vcHRzLmFwcC50b0xvd2VyQ2FzZSgpID09PSBcImNhbGVuZGFyXCIpIHtcbiAgICAgICAgaWYgKHBhcnNlRmxvYXQodGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbikgPj0gOCkge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcIldlIGFyZSBvbiBpT1M4KyBzbyBub3QgY29weWluZyBjYWxlbmRhciBhcHBcIik7XG4gICAgICAgICAgdGhpcy5vcHRzLmJ1bmRsZUlkID0gXCJjb20uYXBwbGUubW9iaWxlY2FsXCI7XG4gICAgICAgICAgdGhpcy5vcHRzLmFwcCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc1NhZmFyaSgpKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgICAgIGlmIChwYXJzZUZsb2F0KHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24pID49IDgpIHtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcIldlIGFyZSBvbiBpT1M4KyBzbyBub3QgY29weWluZyBTYWZhcmkgYXBwXCIpO1xuICAgICAgICAgICAgdGhpcy5vcHRzLmJ1bmRsZUlkID0gU0FGQVJJX0JVTkRMRTtcbiAgICAgICAgICAgIHRoaXMub3B0cy5hcHAgPSBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBvbiByZWFsIGRldmljZSwgbmVlZCB0byBjaGVjayBpZiBzYWZhcmkgbGF1bmNoZXIgZXhpc3RzXG4gICAgICAgICAgLy8gZmlyc3QgY2hlY2sgaWYgaXQgaXMgYWxyZWFkeSBvbiB0aGUgZGV2aWNlXG4gICAgICAgICAgaWYgKCFhd2FpdCB0aGlzLnJlYWxEZXZpY2UuaXNJbnN0YWxsZWQodGhpcy5vcHRzLmJ1bmRsZUlkKSkge1xuICAgICAgICAgICAgLy8gaXQncyBub3Qgb24gdGhlIGRldmljZSwgc28gY2hlY2sgaWYgd2UgbmVlZCB0byBidWlsZFxuICAgICAgICAgICAgaWYgKGF3YWl0IG5lZWRzSW5zdGFsbCgpKSB7XG4gICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnU2FmYXJpTGF1bmNoZXIgbm90IGZvdW5kLCBidWlsZGluZy4uLicpO1xuICAgICAgICAgICAgICBhd2FpdCBpbnN0YWxsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMub3B0cy5idW5kbGVJZCA9IFNBRkFSSV9MQVVOQ0hFUl9CVU5ETEU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRzLmJ1bmRsZUlkICYmXG4gICAgICAgICAgICAgICAgIHV0aWxzLmFwcElzUGFja2FnZU9yQnVuZGxlKHRoaXMub3B0cy5idW5kbGVJZCkgJiZcbiAgICAgICAgICAgICAgICAgKHRoaXMub3B0cy5hcHAgPT09IFwiXCIgfHwgdXRpbHMuYXBwSXNQYWNrYWdlT3JCdW5kbGUodGhpcy5vcHRzLmFwcCkpKSB7XG4gICAgICAgIC8vIHdlIGhhdmUgYSBidW5kbGUgSUQsIGJ1dCBubyBhcHAsIG9yIGFwcCBpcyBhbHNvIGEgYnVuZGxlXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcIkFwcCBpcyBhbiBpT1MgYnVuZGxlLCB3aWxsIGF0dGVtcHQgdG8gcnVuIGFzIHByZS1leGlzdGluZ1wiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMub3B0cy5hcHAgPSBhd2FpdCB0aGlzLmhlbHBlcnMuY29uZmlndXJlQXBwKHRoaXMub3B0cy5hcHAsICcuYXBwJyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoZXJyKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEJhZCBhcHA6ICR7dGhpcy5vcHRzLmFwcH0uIEFwcCBwYXRocyBuZWVkIHRvIGJlIGFic29sdXRlLCBvciByZWxhdGl2ZSB0byB0aGUgYXBwaXVtIGAgK1xuICAgICAgICBcInNlcnZlciBpbnN0YWxsIGRpciwgb3IgYSBVUkwgdG8gY29tcHJlc3NlZCBmaWxlLCBvciBhIHNwZWNpYWwgYXBwIG5hbWUuXCIpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHN0YXJ0U2ltdWxhdG9yICgpIHtcbiAgICBhd2FpdCB1dGlscy5yZW1vdmVJbnN0cnVtZW50c1NvY2tldCh0aGlzLnNvY2spO1xuXG4gICAgaWYgKCF0aGlzLnhjb2RlVmVyc2lvbikge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiU2V0dGluZyBYY29kZSB2ZXJzaW9uXCIpO1xuICAgICAgdGhpcy54Y29kZVZlcnNpb24gPSBhd2FpdCB1dGlscy5nZXRBbmRDaGVja1hjb2RlVmVyc2lvbih0aGlzLm9wdHMpO1xuICAgICAgbG9nZ2VyLmRlYnVnKGBYY29kZSB2ZXJzaW9uIHNldCB0byAke3RoaXMueGNvZGVWZXJzaW9uLnZlcnNpb25TdHJpbmd9YCk7XG4gICAgfVxuXG4gICAgbG9nZ2VyLmRlYnVnKFwiU2V0dGluZyBpT1MgU0RLIFZlcnNpb25cIik7XG4gICAgdGhpcy5pb3NTZGtWZXJzaW9uID0gYXdhaXQgdXRpbHMuZ2V0QW5kQ2hlY2tJb3NTZGtWZXJzaW9uKCk7XG4gICAgbG9nZ2VyLmRlYnVnKGBpT1MgU0RLIFZlcnNpb24gc2V0IHRvICR7dGhpcy5pb3NTZGtWZXJzaW9ufWApO1xuXG4gICAgbGV0IHRpbWVvdXQgPSBfLmlzT2JqZWN0KHRoaXMub3B0cy5sYXVuY2hUaW1lb3V0KSA/IHRoaXMub3B0cy5sYXVuY2hUaW1lb3V0Lmdsb2JhbCA6IHRoaXMub3B0cy5sYXVuY2hUaW1lb3V0O1xuICAgIGxldCBhdmFpbGFibGVEZXZpY2VzID0gYXdhaXQgcmV0cnkoMywgaW5zdHJ1bWVudHNVdGlscy5nZXRBdmFpbGFibGVEZXZpY2VzLCB0aW1lb3V0KTtcblxuICAgIGxldCBpb3NTaW1VZGlkID0gYXdhaXQgY2hlY2tTaW11bGF0b3JBdmFpbGFibGUodGhpcy5vcHRzLCB0aGlzLmlvc1Nka1ZlcnNpb24sIGF2YWlsYWJsZURldmljZXMpO1xuXG4gICAgdGhpcy5zaW0gPSBhd2FpdCBnZXRTaW11bGF0b3IoaW9zU2ltVWRpZCwgdGhpcy54Y29kZVZlcnNpb24udmVyc2lvblN0cmluZyk7XG5cbiAgICBhd2FpdCBtb3ZlQnVpbHRJbkFwcCh0aGlzLnNpbSk7XG5cbiAgICBhd2FpdCB1dGlscy5wYXJzZUxvY2FsaXphYmxlU3RyaW5ncyh0aGlzLm9wdHMpO1xuXG4gICAgYXdhaXQgdXRpbHMuc2V0QnVuZGxlSWRGcm9tQXBwKHRoaXMub3B0cyk7XG5cbiAgICBhd2FpdCB0aGlzLmNyZWF0ZUluc3RydW1lbnRzKCk7XG5cbiAgICB7XG4gICAgICAvLyBwcmV2aW91c2x5IHNldERldmljZUluZm8oKVxuICAgICAgdGhpcy5zaG91bGRQcmVsYXVuY2hTaW11bGF0b3IgPSB1dGlscy5zaG91bGRQcmVsYXVuY2hTaW11bGF0b3IodGhpcy5vcHRzLCB0aGlzLmlvc1Nka1ZlcnNpb24pO1xuICAgICAgbGV0IGRTdHJpbmcgPSBhd2FpdCBnZXRBZGp1c3RlZERldmljZU5hbWUodGhpcy5vcHRzKTtcbiAgICAgIGlmICh0aGlzLmNhcHMuYXBwKSB7XG4gICAgICAgIGF3YWl0IHV0aWxzLnNldERldmljZVR5cGVJbkluZm9QbGlzdCh0aGlzLm9wdHMuYXBwLCBkU3RyaW5nKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5jYXBzLmN1c3RvbVNTTENlcnQgJiYgIXRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICAgIGF3YWl0IGluc3RhbGxTU0xDZXJ0KHRoaXMuY2Fwcy5jdXN0b21TU0xDZXJ0LCB0aGlzLnNpbS51ZGlkKTtcbiAgICB9XG5cbiAgICBhd2FpdCBydW5TaW11bGF0b3JSZXNldCh0aGlzLnNpbSwgdGhpcy5vcHRzLCB0aGlzLmtlZXBBcHBUb1JldGFpblByZWZzKTtcbiAgICBhd2FpdCBpc29sYXRlU2ltdWxhdG9yRGV2aWNlKHRoaXMuc2ltLCB0aGlzLm9wdHMpO1xuICAgIHRoaXMubG9jYWxDb25maWcgPSBhd2FpdCBzZXRMb2NhbGUodGhpcy5zaW0sIHRoaXMub3B0cywgdGhpcy5sb2NhbENvbmZpZywgdGhpcy5pc1NhZmFyaSgpKTtcbiAgICBhd2FpdCBzZXRQcmVmZXJlbmNlcyh0aGlzLnNpbSwgdGhpcy5vcHRzLCB0aGlzLmlzU2FmYXJpKCkpO1xuICAgIGF3YWl0IHRoaXMuc3RhcnRMb2dDYXB0dXJlKHRoaXMuc2ltKTtcbiAgICBhd2FpdCB0aGlzLnByZWxhdW5jaFNpbXVsYXRvcigpO1xuICAgIGF3YWl0IHRoaXMuc3RhcnRJbnN0cnVtZW50cygpO1xuICAgIGF3YWl0IHRoaXMub25JbnN0cnVtZW50c0xhdW5jaCgpO1xuICAgIGF3YWl0IHRoaXMuY29uZmlndXJlQm9vdHN0cmFwKCk7XG4gICAgYXdhaXQgdGhpcy5zZXRCdW5kbGVJZCgpO1xuICAgIGF3YWl0IHRoaXMuc2V0SW5pdGlhbE9yaWVudGF0aW9uKCk7XG4gICAgYXdhaXQgdGhpcy5pbml0QXV0b1dlYnZpZXcoKTtcbiAgICBhd2FpdCB0aGlzLndhaXRGb3JBcHBMYXVuY2hlZCgpO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRSZWFsRGV2aWNlICgpIHtcbiAgICBhd2FpdCB1dGlscy5yZW1vdmVJbnN0cnVtZW50c1NvY2tldCh0aGlzLnNvY2spO1xuICAgIGF3YWl0IHV0aWxzLnBhcnNlTG9jYWxpemFibGVTdHJpbmdzKHRoaXMub3B0cyk7XG4gICAgYXdhaXQgdXRpbHMuc2V0QnVuZGxlSWRGcm9tQXBwKHRoaXMub3B0cyk7XG4gICAgYXdhaXQgdGhpcy5jcmVhdGVJbnN0cnVtZW50cygpO1xuICAgIGF3YWl0IHJ1blJlYWxEZXZpY2VSZXNldCh0aGlzLnJlYWxEZXZpY2UsIHRoaXMub3B0cyk7XG4gICAgYXdhaXQgdGhpcy5zdGFydExvZ0NhcHR1cmUoKTtcbiAgICBhd2FpdCB0aGlzLmluc3RhbGxUb1JlYWxEZXZpY2UoKTtcbiAgICBhd2FpdCB0aGlzLnN0YXJ0SW5zdHJ1bWVudHMoKTtcbiAgICBhd2FpdCB0aGlzLm9uSW5zdHJ1bWVudHNMYXVuY2goKTtcbiAgICBhd2FpdCB0aGlzLmNvbmZpZ3VyZUJvb3RzdHJhcCgpO1xuICAgIGF3YWl0IHRoaXMuc2V0QnVuZGxlSWQoKTtcbiAgICBhd2FpdCB0aGlzLnNldEluaXRpYWxPcmllbnRhdGlvbigpO1xuICAgIGF3YWl0IHRoaXMuaW5pdEF1dG9XZWJ2aWV3KCk7XG4gICAgYXdhaXQgdGhpcy53YWl0Rm9yQXBwTGF1bmNoZWQoKTtcbiAgfVxuXG4gIGFzeW5jIGluc3RhbGxUb1JlYWxEZXZpY2UgKCkge1xuICAgIC8vIGlmIHVzZXIgaGFzIHBhc3NlZCBpbiBkZXNpcmVkQ2Fwcy5hdXRvTGF1bmNoID0gZmFsc2VcbiAgICAvLyBtZWFuaW5nIHRoZXkgd2lsbCBtYW5hZ2UgYXBwIGluc3RhbGwgLyBsYXVuY2hpbmdcbiAgICBpZiAodGhpcy5vcHRzLmF1dG9MYXVuY2ggPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gaWYgd2UgaGF2ZSBhbiBpcGEgZmlsZSwgc2V0IGl0IGluIG9wdHNcbiAgICBpZiAodGhpcy5vcHRzLmFwcCkge1xuICAgICAgbGV0IGV4dCA9IHRoaXMub3B0cy5hcHAuc3Vic3RyaW5nKHRoaXMub3B0cy5hcHAubGVuZ3RoIC0gMykudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChleHQgPT09ICdpcGEnKSB7XG4gICAgICAgIHRoaXMub3B0cy5pcGEgPSB0aGlzLm9wdHMuYXBwO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLm9wdHMudWRpZCkge1xuICAgICAgaWYgKGF3YWl0IHRoaXMucmVhbERldmljZS5pc0luc3RhbGxlZCh0aGlzLm9wdHMuYnVuZGxlSWQpKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcIkFwcCBpcyBpbnN0YWxsZWQuXCIpO1xuICAgICAgICBpZiAodGhpcy5vcHRzLmZ1bGxSZXNldCkge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcImZ1bGxSZXNldCByZXF1ZXN0ZWQuIEZvcmNpbmcgYXBwIGluc3RhbGwuXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcImZ1bGxSZXNldCBub3QgcmVxdWVzdGVkLiBObyBuZWVkIHRvIGluc3RhbGwuXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFwiQXBwIGlzIG5vdCBpbnN0YWxsZWQuIFdpbGwgdHJ5IHRvIGluc3RhbGwuXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vcHRzLmlwYSAmJiB0aGlzLm9wdHMuYnVuZGxlSWQpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5pbnN0YWxsSXBhKCk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnQXBwIGluc3RhbGxlZC4nKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRzLmlwYSkge1xuICAgICAgICBsZXQgbXNnID0gXCJZb3Ugc3BlY2lmaWVkIGEgVURJRCBhbmQgaXBhIGJ1dCBkaWQgbm90IGluY2x1ZGUgdGhlIGJ1bmRsZSBpZFwiO1xuICAgICAgICBsb2dnZXIud2Fybihtc2cpO1xuICAgICAgICB0aHJvdyBuZXcgZXJyb3JzLlVua25vd25FcnJvcihtc2cpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdHMuYXBwKSB7XG4gICAgICAgIGF3YWl0IHRoaXMucmVhbERldmljZS5pbnN0YWxsKHRoaXMub3B0cy5hcHApO1xuICAgICAgICBsb2dnZXIuZGVidWcoJ0FwcCBpbnN0YWxsZWQuJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuZGVidWcoXCJSZWFsIGRldmljZSBzcGVjaWZpZWQgYnV0IG5vIGlwYSBvciBhcHAgcGF0aCwgYXNzdW1pbmcgYnVuZGxlIElEIGlzIFwiICtcbiAgICAgICAgICAgICAgICAgICAgIFwib24gZGV2aWNlXCIpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJObyBkZXZpY2UgaWQgb3IgYXBwLCBub3QgaW5zdGFsbGluZyB0byByZWFsIGRldmljZS5cIik7XG4gICAgfVxuICB9XG5cbiAgZ2V0SURldmljZU9iaiAoKSB7XG4gICAgbGV0IGlkaVBhdGggPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBcIi4uLy4uLy4uL2J1aWxkL1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGliaW1vYmlsZWRldmljZS1tYWNvc3gvaWRldmljZWluc3RhbGxlclwiKTtcbiAgICBsb2dnZXIuZGVidWcoYENyZWF0aW5nIGlEZXZpY2Ugb2JqZWN0IHdpdGggdWRpZCAke3RoaXMub3B0cy51ZGlkfWApO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gaURldmljZSh0aGlzLm9wdHMudWRpZCk7XG4gICAgfSBjYXRjaCAoZTEpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgQ291bGRuJ3QgZmluZCBpZGV2aWNlaW5zdGFsbGVyLCB0cnlpbmcgYnVpbHQtaW4gYXQgJHtpZGlQYXRofWApO1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGlEZXZpY2UodGhpcy5vcHRzLnVkaWQsIHtjbWQ6IGlkaVBhdGh9KTtcbiAgICAgIH0gY2F0Y2ggKGUyKSB7XG4gICAgICAgIGxldCBtc2cgPSBcIkNvdWxkIG5vdCBpbml0aWFsaXplIGlkZXZpY2VpbnN0YWxsZXI7IG1ha2Ugc3VyZSBpdCBpcyBcIiArXG4gICAgICAgICAgICAgICAgICBcImluc3RhbGxlZCBhbmQgd29ya3Mgb24geW91ciBzeXN0ZW1cIjtcbiAgICAgICAgbG9nZ2VyLmVycm9yKG1zZyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGluc3RhbGxJcGEgKCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhgSW5zdGFsbGluZyBpcGEgZm91bmQgYXQgJHt0aGlzLm9wdHMuaXBhfWApO1xuICAgIGlmIChhd2FpdCB0aGlzLnJlYWxEZXZpY2UuaXNJbnN0YWxsZWQodGhpcy5vcHRzLmJ1bmRsZUlkKSkge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiQnVuZGxlIGZvdW5kIG9uIGRldmljZSwgcmVtb3ZpbmcgYmVmb3JlIHJlaW5zdGFsbGluZy5cIik7XG4gICAgICBhd2FpdCB0aGlzLnJlYWxEZXZpY2UucmVtb3ZlKHRoaXMub3B0cy5idW5kbGVJZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhcIk5vdGhpbmcgZm91bmQgb24gZGV2aWNlLCBnb2luZyBhaGVhZCBhbmQgaW5zdGFsbGluZy5cIik7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMucmVhbERldmljZS5pbnN0YWxsQW5kV2FpdCh0aGlzLm9wdHMuaXBhLCB0aGlzLm9wdHMuYnVuZGxlSWQpO1xuICB9XG5cbiAgdmFsaWRhdGVEZXNpcmVkQ2FwcyAoY2Fwcykge1xuICAgIC8vIGNoZWNrIHdpdGggdGhlIGJhc2UgY2xhc3MsIGFuZCByZXR1cm4gaWYgaXQgZmFpbHNcbiAgICBsZXQgcmVzID0gc3VwZXIudmFsaWRhdGVEZXNpcmVkQ2FwcyhjYXBzKTtcbiAgICBpZiAoIXJlcykgcmV0dXJuIHJlcztcblxuICAgIHJldHVybiBkZXNpcmVkQ2FwVmFsaWRhdGlvbihjYXBzKTtcbiAgfVxuXG4gIGFzeW5jIHByZWxhdW5jaFNpbXVsYXRvciAoKSB7XG4gICAgaWYgKCF0aGlzLnNob3VsZFByZWxhdW5jaFNpbXVsYXRvcikge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiTm90IHByZS1sYXVuY2hpbmcgc2ltdWxhdG9yXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhd2FpdCBlbmRTaW11bGF0b3IodGhpcy5zaW0pO1xuICAgIC8vIFRPRE86IGltcGxlbWVudCBwcmVsYXVuY2ggc2ltIGluIHNpbXVsYXRvciBwYWNrYWdlXG4gIH1cblxuICBhc3luYyBvbkluc3RydW1lbnRzTGF1bmNoICgpIHtcbiAgICBsb2dnZXIuZGVidWcoJ0luc3RydW1lbnRzIGxhdW5jaGVkLiBTdGFydGluZyBwb2xsIGxvb3AgZm9yIG5ldyBjb21tYW5kcy4nKTtcbiAgICBpZiAodGhpcy5vcHRzLm9yaWdBcHBQYXRoKSB7XG4gICAgICBsb2dnZXIuZGVidWcoXCJDb3B5aW5nIGFwcCBiYWNrIHRvIGl0cyBvcmlnaW5hbCBwbGFjZVwiKTtcbiAgICAgIHJldHVybiBhd2FpdCBmcy5jb3B5RmlsZSh0aGlzLm9wdHMuYXBwLCB0aGlzLm9wdHMub3JpZ0FwcFBhdGgpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNldEJ1bmRsZUlkICgpIHtcbiAgICBpZiAodGhpcy5vcHRzLmJ1bmRsZUlkKSB7XG4gICAgICAvLyBXZSBhbHJlYWR5IGhhdmUgYSBidW5kbGUgSWRcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGJJZCA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKCdhdS5idW5kbGVJZCgpJyk7XG4gICAgICBsb2dnZXIuZGVidWcoYEJ1bmRsZSBJRCBmb3Igb3BlbiBhcHAgaXMgJHtiSWQudmFsdWV9YCk7XG4gICAgICB0aGlzLm9wdHMuYnVuZGxlSWQgPSBiSWQudmFsdWU7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2V0SW5pdGlhbE9yaWVudGF0aW9uICgpIHtcbiAgICBpZiAodHlwZW9mIHRoaXMub3B0cy5pbml0aWFsT3JpZW50YXRpb24gPT09IFwic3RyaW5nXCIgJiZcbiAgICAgICAgXy5pbmNsdWRlcyhbXCJMQU5EU0NBUEVcIiwgXCJQT1JUUkFJVFwiXSxcbiAgICAgICAgICAgICAgICAgICB0aGlzLm9wdHMuaW5pdGlhbE9yaWVudGF0aW9uLnRvVXBwZXJDYXNlKCkpXG4gICAgICAgICkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBTZXR0aW5nIGluaXRpYWwgb3JpZW50YXRpb24gdG8gJHt0aGlzLm9wdHMuaW5pdGlhbE9yaWVudGF0aW9ufWApO1xuICAgICAgbGV0IGNvbW1hbmQgPSBgYXUuc2V0U2NyZWVuT3JpZW50YXRpb24oJyR7dGhpcy5vcHRzLmluaXRpYWxPcmllbnRhdGlvbi50b1VwcGVyQ2FzZSgpfScpYDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKGNvbW1hbmQpO1xuICAgICAgICB0aGlzLm9wdHMuY3VyT3JpZW50YXRpb24gPSB0aGlzLm9wdHMuaW5pdGlhbE9yaWVudGF0aW9uO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKGBTZXR0aW5nIGluaXRpYWwgb3JpZW50YXRpb24gZmFpbGVkIHdpdGg6ICR7ZXJyfWApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlzUmVhbERldmljZSAoKSB7XG4gICAgcmV0dXJuICEhdGhpcy5vcHRzLnVkaWQ7XG4gIH1cblxuICBpc1NhZmFyaSAoKSB7XG4gICAgcmV0dXJuIHRoaXMub3B0cy5zYWZhcmk7XG4gIH1cblxuICBhc3luYyB3YWl0Rm9yQXBwTGF1bmNoZWQgICgpIHtcbiAgICAvLyBvbiBpT1M4IGluIHBhcnRpY3VsYXIsIHdlIGNhbiBnZXQgYSB3b3JraW5nIHNlc3Npb24gYmVmb3JlIHRoZSBhcHBcbiAgICAvLyBpcyByZWFkeSB0byByZXNwb25kIHRvIGNvbW1hbmRzOyBpbiB0aGF0IGNhc2UgdGhlIHNvdXJjZSB3aWxsIGJlIGVtcHR5XG4gICAgLy8gc28gd2UganVzdCBzcGluIHVudGlsIGl0J3Mgbm90XG4gICAgbGV0IGNvbmRGbjtcbiAgICBpZiAodGhpcy5vcHRzLndhaXRGb3JBcHBTY3JpcHQpIHtcbiAgICAgIC8vIHRoZSBkZWZhdWx0IGdldFNvdXJjZUZvckVsZW1lbnRGb3JYTUwgZG9lcyBub3QgZml0IHNvbWUgdXNlIGNhc2UsIHNvIG1ha2luZyB0aGlzIGN1c3RvbWl6YWJsZS5cbiAgICAgIC8vIFRPRE86IGNvbGxlY3Qgc2NyaXB0IGZyb20gY3VzdG9tZXIgYW5kIHByb3Bvc2Ugc2V2ZXJhbCBvcHRpb25zLCBwbGVhc2UgY29tbWVudCBpbiBpc3N1ZSAjNDE5MC5cbiAgICAgIGxvZ2dlci5kZWJ1ZyhgVXNpbmcgY3VzdG9tIHNjcmlwdCB0byB3YWl0IGZvciBhcHAgc3RhcnQ6ICR7dGhpcy5vcHRzLndhaXRGb3JBcHBTY3JpcHR9YCk7XG4gICAgICBjb25kRm4gPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCByZXM7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoYHRyeXtcXG4ke3RoaXMub3B0cy53YWl0Rm9yQXBwU2NyaXB0fWAgK1xuICAgICAgICAgICAgICAgICAgICAgYFxcbn0gY2F0Y2goZXJyKSB7ICQubG9nKFwid2FpdEZvckFwcFNjcmlwdCBlcnI6IFwiICsgZXJyb3IpOyBmYWxzZTsgfTtgKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKGBDYW5ub3QgZXZhbCB3YWl0Rm9yQXBwU2NyaXB0IHNjcmlwdCwgZXJyOiAke2Vycn1gKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiByZXMgIT09ICdib29sZWFuJykge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnVW5leHBlY3RlZCByZXR1cm4gdHlwZSBpbiB3YWl0Rm9yQXBwU2NyaXB0IHNjcmlwdCcpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNTYWZhcmkoKSkge1xuICAgICAgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5jbGlja0J1dHRvblRvTGF1bmNoU2FmYXJpKCk7XG4gICAgICB9XG4gICAgICBsb2dnZXIuZGVidWcoJ1dhaXRpbmcgZm9yIGluaXRpYWwgd2VidmlldycpO1xuICAgICAgYXdhaXQgdGhpcy5uYXZUb0luaXRpYWxXZWJ2aWV3KCk7XG4gICAgICBjb25kRm4gPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nZ2VyLmRlYnVnKFwiV2FpdGluZyBmb3IgYXBwIHNvdXJjZSB0byBjb250YWluIGVsZW1lbnRzXCIpO1xuICAgICAgY29uZEZuID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGxldCBzb3VyY2UgPSBhd2FpdCB0aGlzLmdldFNvdXJjZUZvckVsZW1lbnRGb3JYTUwoKTtcbiAgICAgICAgICBzb3VyY2UgPSBKU09OLnBhcnNlKHNvdXJjZSB8fCBcInt9XCIpO1xuICAgICAgICAgIGxldCBhcHBFbHMgPSAoc291cmNlLlVJQUFwcGxpY2F0aW9uIHx8IHt9KVsnPiddO1xuICAgICAgICAgIHJldHVybiBhcHBFbHMgJiYgYXBwRWxzLmxlbmd0aCA+IDAgJiYgIUlvc0RyaXZlci5pc1NwcmluZ0JvYXJkKHNvdXJjZS5VSUFBcHBsaWNhdGlvbik7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBsb2dnZXIud2FybihgQ291bGRuJ3QgZXh0cmFjdCBhcHAgZWxlbWVudCBmcm9tIHNvdXJjZSwgZXJyb3Igd2FzOiAke2V9YCk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihjb25kRm4sIHtsb2dnZXIsIHdhaXRNczogMTAwMDAsIGludGVydmFsTXM6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyci5tZXNzYWdlICYmIGVyci5tZXNzYWdlLm1hdGNoKC9Db25kaXRpb24gdW5tZXQvKSkge1xuICAgICAgICBsb2dnZXIud2FybignSW5pdGlhbCBzcGluIHRpbWVkIG91dCwgY29udGludWluZyBidXQgdGhlIGFwcCBtaWdodCBub3QgYmUgcmVhZHkuJyk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgSW5pdGlhbCBzcGluIGVycm9yIHdhczogJHtlcnJ9YCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGlzU3ByaW5nQm9hcmQgKHVpQXBwT2JqKSB7XG4gIC8vIFRPRE86IG1vdmUgdG8gaGVscGVyc1xuICAvLyBUZXN0IGZvciBpT1MgaG9tZXNjcmVlbiAoU3ByaW5nQm9hcmQpLiBBVVQgb2NjYXNzaW9uYWxseSBzdGFydCB0aGUgc2ltLCBidXQgZmFpbHMgdG8gbG9hZFxuICAvLyB0aGUgYXBwLiBJZiB0aGF0IG9jY3VycywgZ2V0U291cmNlRm9yRWxlbWVudEZvWE1MIHdpbGwgcmV0dXJuIGEgZG9jIG9iamVjdCB0aGF0IG1lZXRzIG91clxuICAvLyBhcHAtY2hlY2sgY29uZGl0aW9ucywgcmVzdWx0aW5nIGluIGEgZmFsc2UgcG9zaXRpdmUuIFRoaXMgZnVuY3Rpb24gdGVzdHMgdGhlIFVpQXBwbGljYXRpb25cbiAgLy8gcHJvcGVydHkncyBtZXRhIGRhdGEgdG8gZW5zdXJlIHRoYXQgdGhlIEFwcGl1bSBkb2Vzbid0IGNvbmZ1c2UgU3ByaW5nQm9hcmQgd2l0aCB0aGUgYXBwXG4gIC8vIHVuZGVyIHRlc3QuXG4gICAgcmV0dXJuIF8ucHJvcGVydHlPZih1aUFwcE9ialsnQCddKSgnbmFtZScpID09PSAnU3ByaW5nQm9hcmQnO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlSW5zdHJ1bWVudHMgKCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIkNyZWF0aW5nIGluc3RydW1lbnRzXCIpO1xuICAgIHRoaXMudWlBdXRvQ2xpZW50ID0gbmV3IFVJQXV0b0NsaWVudCh0aGlzLnNvY2spO1xuICAgIHRoaXMuaW5zdHJ1bWVudHMgPSBhd2FpdCB0aGlzLm1ha2VJbnN0cnVtZW50cygpO1xuICAgIHRoaXMuaW5zdHJ1bWVudHMub25TaHV0ZG93bi5jYXRjaChhc3luYyAoKSA9PiB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcHJvbWlzZS9jYXRjaC1vci1yZXR1cm5cbiAgICAgIC8vIHVuZXhwZWN0ZWQgZXhpdFxuICAgICAgYXdhaXQgdGhpcy5zdGFydFVuZXhwZWN0ZWRTaHV0ZG93bihuZXcgZXJyb3JzLlVua25vd25FcnJvcignQWJub3JtYWwgSW5zdHJ1bWVudHMgdGVybWluYXRpb24hJykpO1xuICAgIH0pLmRvbmUoKTtcbiAgfVxuXG4gIHNob3VsZElnbm9yZUluc3RydW1lbnRzRXhpdCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2FmYXJpICYmIHRoaXMuaXNSZWFsRGV2aWNlKCk7XG4gIH1cblxuICBhc3luYyBtYWtlSW5zdHJ1bWVudHMgKCkge1xuICAgIC8vIGF0IHRoZSBtb21lbnQgYWxsIHRoZSBsb2dnaW5nIGluIHVpYXV0byBpcyBhdCBkZWJ1ZyBsZXZlbFxuICAgIGxldCBib290c3RyYXBQYXRoID0gYXdhaXQgcHJlcGFyZUJvb3RzdHJhcCh7XG4gICAgICBzb2NrOiB0aGlzLnNvY2ssXG4gICAgICBpbnRlcktleURlbGF5OiB0aGlzLm9wdHMuaW50ZXJLZXlEZWxheSxcbiAgICAgIGp1c3RMb29wSW5maW5pdGVseTogZmFsc2UsXG4gICAgICBhdXRvQWNjZXB0QWxlcnRzOiB0aGlzLm9wdHMuYXV0b0FjY2VwdEFsZXJ0cyxcbiAgICAgIGF1dG9EaXNtaXNzQWxlcnRzOiB0aGlzLm9wdHMuYXV0b0Rpc21pc3NBbGVydHMsXG4gICAgICBzZW5kS2V5U3RyYXRlZ3k6IHRoaXMub3B0cy5zZW5kS2V5U3RyYXRlZ3kgfHwgKHRoaXMuaXNSZWFsRGV2aWNlKCkgPyAnZ3JvdXBlZCcgOiAnb25lQnlPbmUnKVxuICAgIH0pO1xuICAgIGxldCBpbnN0cnVtZW50cyA9IG5ldyBJbnN0cnVtZW50cyh7XG4gICAgICAvLyBvbiByZWFsIGRldmljZXMgYnVuZGxlSWQgaXMgYWx3YXlzIHVzZWRcbiAgICAgIGFwcDogKCF0aGlzLmlzUmVhbERldmljZSgpID8gdGhpcy5vcHRzLmFwcCA6IG51bGwpIHx8IHRoaXMub3B0cy5idW5kbGVJZCxcbiAgICAgIHVkaWQ6IHRoaXMub3B0cy51ZGlkLFxuICAgICAgcHJvY2Vzc0FyZ3VtZW50czogdGhpcy5vcHRzLnByb2Nlc3NBcmd1bWVudHMsXG4gICAgICBpZ25vcmVTdGFydHVwRXhpdDogdGhpcy5zaG91bGRJZ25vcmVJbnN0cnVtZW50c0V4aXQoKSxcbiAgICAgIGJvb3RzdHJhcDogYm9vdHN0cmFwUGF0aCxcbiAgICAgIHRlbXBsYXRlOiB0aGlzLm9wdHMuYXV0b21hdGlvblRyYWNlVGVtcGxhdGVQYXRoLFxuICAgICAgaW5zdHJ1bWVudHNQYXRoOiB0aGlzLm9wdHMuaW5zdHJ1bWVudHNQYXRoLFxuICAgICAgd2l0aG91dERlbGF5OiB0aGlzLm9wdHMud2l0aG91dERlbGF5LFxuICAgICAgcGxhdGZvcm1WZXJzaW9uOiB0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uLFxuICAgICAgd2ViU29ja2V0OiB0aGlzLm9wdHMud2ViU29ja2V0LFxuICAgICAgbGF1bmNoVGltZW91dDogdGhpcy5vcHRzLmxhdW5jaFRpbWVvdXQsXG4gICAgICBmbGFrZXlSZXRyaWVzOiB0aGlzLm9wdHMuYmFja2VuZFJldHJpZXMsXG4gICAgICByZWFsRGV2aWNlOiB0aGlzLmlzUmVhbERldmljZSgpLFxuICAgICAgc2ltdWxhdG9yU2RrQW5kRGV2aWNlOiB0aGlzLmlvc1Nka1ZlcnNpb24gPj0gNy4xID8gYXdhaXQgZ2V0QWRqdXN0ZWREZXZpY2VOYW1lKHRoaXMub3B0cykgOiBudWxsLFxuICAgICAgdG1wRGlyOiBwYXRoLnJlc29sdmUodGhpcy5vcHRzLnRtcERpciB8fCAnL3RtcCcsICdhcHBpdW0taW5zdHJ1bWVudHMnKSxcbiAgICAgIHRyYWNlRGlyOiB0aGlzLm9wdHMudHJhY2VEaXIsXG4gICAgICBsb2NhbGU6IHRoaXMub3B0cy5sb2NhbGUsXG4gICAgICBsYW5ndWFnZTogdGhpcy5vcHRzLmxhbmd1YWdlXG4gICAgfSk7XG4gICAgcmV0dXJuIGluc3RydW1lbnRzO1xuICB9XG5cbiAgYXN5bmMgc3RhcnRJbnN0cnVtZW50cyAoKSB7XG4gICAgbG9nZ2VyLmRlYnVnKFwiU3RhcnRpbmcgVUlBdXRvQ2xpZW50LCBhbmQgbGF1bmNoaW5nIEluc3RydW1lbnRzLlwiKTtcblxuICAgIGF3YWl0IEIuYWxsKFtcbiAgICAgIHRoaXMudWlBdXRvQ2xpZW50LnN0YXJ0KCkudGhlbigoKSA9PiB7IHRoaXMuaW5zdHJ1bWVudHMucmVnaXN0ZXJMYXVuY2goKTsgfSksXG4gICAgICB0aGlzLmluc3RydW1lbnRzLmxhdW5jaCgpXG4gICAgXSk7XG4gIH1cblxuICBhc3luYyBjb25maWd1cmVCb290c3RyYXAgKCkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIlNldHRpbmcgYm9vdHN0cmFwIGNvbmZpZyBrZXlzL3ZhbHVlc1wiKTtcbiAgICBsZXQgaXNWZXJib3NlID0gdHJ1ZTsgLy8gVE9ETzogbGV2ZWwgd2FzIGNvbmZpZ3VyZWQgYWNjb3JkaW5nIHRvIGxvZ2dlclxuICAgIGxldCBjbWQgPSAndGFyZ2V0ID0gJC50YXJnZXQoKTtcXG4nO1xuICAgIGNtZCArPSAnYXUgPSAkO1xcbic7XG4gICAgY21kICs9IGAkLmlzVmVyYm9zZSA9ICR7aXNWZXJib3NlfTtcXG5gO1xuICAgIC8vIE5vdCB1c2luZyB1aWF1dG8gZ3JhY2UgcGVyaW9kIGJlY2F1c2Ugb2YgYnVnLlxuICAgIC8vIGNtZCArPSAnJC50YXJnZXQoKS5zZXRUaW1lb3V0KDEpO1xcbic7XG4gICAgYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoY21kKTtcbiAgfVxuXG4gIGFzeW5jIGdldFNvdXJjZUZvckVsZW1lbnRGb3JYTUwgKGN0eCkge1xuICAgIGxldCBzb3VyY2U7XG4gICAgaWYgKCFjdHgpIHtcbiAgICAgIHNvdXJjZSA9IGF3YWl0IHRoaXMudWlBdXRvQ2xpZW50LnNlbmRDb21tYW5kKFwiYXUubWFpbkFwcCgpLmdldFRyZWVGb3JYTUwoKVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc291cmNlID0gYXdhaXQgdGhpcy51aUF1dG9DbGllbnQuc2VuZENvbW1hbmQoYGF1LmdldEVsZW1lbnQoJyR7Y3R4fScpLmdldFRyZWVGb3JYTUwoKWApO1xuICAgIH1cbiAgICAvLyBUT0RPOiBhbGwgdGhpcyBqc29uL3htbCBsb2dpYyBpcyB2ZXJ5IGV4cGVuc2l2ZSwgd2UgbmVlZFxuICAgIC8vIHRvIHVzZSBhIFNBWCBwYXJzZXIgaW5zdGVhZC5cbiAgICBpZiAoc291cmNlKSB7XG4gICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoc291cmNlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gdGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuIGJ1dCB3ZSd2ZSByZWNlaXZlZCBidWcgcmVwb3J0czsgdGhpcyB3aWxsIGhlbHAgdXMgdHJhY2sgZG93blxuICAgICAgLy8gd2hhdCdzIHdyb25nIGluIGdldFRyZWVGb3JYTUxcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQmFkIHJlc3BvbnNlIGZyb20gZ2V0VHJlZUZvclhNTC4gcmVzIHdhcyAke0pTT04uc3RyaW5naWZ5KHNvdXJjZSl9YCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHJlYWxEZXZpY2UgKCkge1xuICAgIHRoaXMuX3JlYWxEZXZpY2UgPSB0aGlzLl9yZWFsRGV2aWNlIHx8IHRoaXMuZ2V0SURldmljZU9iaigpO1xuICAgIHJldHVybiB0aGlzLl9yZWFsRGV2aWNlO1xuICB9XG5cbiAgc2V0IHJlYWxEZXZpY2UgKHJkKSB7XG4gICAgdGhpcy5fcmVhbERldmljZSA9IHJkO1xuICB9XG59XG5cbmZvciAobGV0IFtjbWQsIGZuXSBvZiBfLnRvUGFpcnMoY29tbWFuZHMpKSB7XG4gIElvc0RyaXZlci5wcm90b3R5cGVbY21kXSA9IGZuO1xufVxuXG5cbmV4cG9ydCB7IElvc0RyaXZlciwgZGVmYXVsdFNlcnZlckNhcHMgfTtcbmV4cG9ydCBkZWZhdWx0IElvc0RyaXZlcjtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
