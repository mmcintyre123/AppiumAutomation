require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _index = require('../index');

var _index2 = _interopRequireDefault(_index);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _appiumSupport = require('appium-support');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var should = _chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('xcode @skip-linux', function () {
  it('should get the path to xcode executable', function callee$1$0() {
    var path;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getPath());

        case 2:
          path = context$2$0.sent;

          should.exist(path);
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path));

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  describe('getVersion', function () {
    var versionRE = /\d\.\d\.*\d*/;

    it('should get the version of xcode', function callee$2$0() {
      var version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 2:
            version = context$3$0.sent;

            should.exist(version);
            _lodash2['default'].isString(version).should.be['true'];
            versionRE.test(version).should.be['true'];

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should get the path and version again, these values are cached', function callee$2$0() {
      var before, path, after, version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getPath());

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 4:
            before = new Date();
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(_index2['default'].getPath());

          case 7:
            path = context$3$0.sent;
            after = new Date();

            should.exist(path);
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path));

          case 12:
            (after - before).should.be.at.most(2);

            before = new Date();
            context$3$0.next = 16;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 16:
            version = context$3$0.sent;

            after = new Date();

            should.exist(version);
            _lodash2['default'].isString(version).should.be['true'];
            versionRE.test(version).should.be['true'];
            (after - before).should.be.at.most(2);

          case 22:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should get the parsed version', function callee$2$0() {
      var nonParsedVersion, version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 2:
            nonParsedVersion = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion(true));

          case 5:
            version = context$3$0.sent;

            should.exist(version);
            _lodash2['default'].isString(version.versionString).should.be['true'];
            version.versionString.should.eql(nonParsedVersion);

            parseFloat(version.versionFloat).should.equal(version.versionFloat);
            parseInt(version.major).should.equal(version.major);
            parseInt(version.minor).should.equal(version.minor);

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  it('should clear the cache if asked to', function callee$1$0() {
    var before, after;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          _index2['default'].clearInternalCache();

          before = new Date();
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(_index2['default'].getPath());

        case 4:
          after = new Date();

          (after - before).should.be.at.least(6);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should get max iOS SDK version', function callee$1$0() {
    var version;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getMaxIOSSDK());

        case 2:
          version = context$2$0.sent;

          should.exist(version);
          (typeof version).should.equal('string');
          (parseFloat(version) - 6.1).should.be.at.least(0);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get a list of iOS devices', function callee$1$0() {
    var devices;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getConnectedDevices());

        case 2:
          devices = context$2$0.sent;

          should.exist(devices);
          (typeof devices).should.equal('object');

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get the path to instruments binary', function callee$1$0() {
    var instrumentsPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getInstrumentsPath());

        case 2:
          instrumentsPath = context$2$0.sent;

          should.exist(instrumentsPath);
          (typeof instrumentsPath).should.equal('string');
          instrumentsPath.length.should.be.above(3);
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(instrumentsPath));

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  describe('ui automation', function () {
    var _this2 = this;

    before(function callee$2$0() {
      var version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion(true));

          case 2:
            version = context$3$0.sent;

            if (version.major >= 8) {
              this.skip();
            }

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should find the automation trace template', function callee$2$0() {
      var path, suffix;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getAutomationTraceTemplatePath());

          case 2:
            path = context$3$0.sent;

            should.exist(path);
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path).should.eventually.be['true']);

          case 6:
            suffix = ".tracetemplate";

            path.slice(-suffix.length).should.equal(suffix);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});
//# sourceMappingURL=data:application/json;base64,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QUk7O0FBRVIsa0JBQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7OzZDQUNiLGtCQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBSzs7O0FBQzNDLGtCQUFNLEdBQUcsZ0JBQWdCOztBQUM3QixnQkFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDOzs7Ozs7O0tBQ2pELENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L3hjb2RlLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHJhbnNwaWxlOm1vY2hhXG5cbmltcG9ydCB4Y29kZSBmcm9tICcuLi9pbmRleCc7XG5pbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuXG5sZXQgc2hvdWxkID0gY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ3hjb2RlIEBza2lwLWxpbnV4JywgKCkgPT4ge1xuICBpdCgnc2hvdWxkIGdldCB0aGUgcGF0aCB0byB4Y29kZSBleGVjdXRhYmxlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBwYXRoID0gYXdhaXQgeGNvZGUuZ2V0UGF0aCgpO1xuICAgIHNob3VsZC5leGlzdChwYXRoKTtcbiAgICBhd2FpdCBmcy5leGlzdHMocGF0aCk7XG5cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFZlcnNpb24nLCAoKSA9PiB7XG4gICAgbGV0IHZlcnNpb25SRSA9IC9cXGRcXC5cXGRcXC4qXFxkKi87XG5cbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgdmVyc2lvbiBvZiB4Y29kZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbigpO1xuICAgICAgc2hvdWxkLmV4aXN0KHZlcnNpb24pO1xuICAgICAgXy5pc1N0cmluZyh2ZXJzaW9uKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIHZlcnNpb25SRS50ZXN0KHZlcnNpb24pLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdGhlIHBhdGggYW5kIHZlcnNpb24gYWdhaW4sIHRoZXNlIHZhbHVlcyBhcmUgY2FjaGVkJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgeGNvZGUuZ2V0UGF0aCgpO1xuICAgICAgYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbigpO1xuXG4gICAgICBsZXQgYmVmb3JlID0gbmV3IERhdGUoKTtcbiAgICAgIGxldCBwYXRoID0gYXdhaXQgeGNvZGUuZ2V0UGF0aCgpO1xuICAgICAgbGV0IGFmdGVyID0gbmV3IERhdGUoKTtcblxuICAgICAgc2hvdWxkLmV4aXN0KHBhdGgpO1xuICAgICAgYXdhaXQgZnMuZXhpc3RzKHBhdGgpO1xuICAgICAgKGFmdGVyLWJlZm9yZSkuc2hvdWxkLmJlLmF0Lm1vc3QoMik7XG5cbiAgICAgIGJlZm9yZSA9IG5ldyBEYXRlKCk7XG4gICAgICBsZXQgdmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldFZlcnNpb24oKTtcbiAgICAgIGFmdGVyID0gbmV3IERhdGUoKTtcblxuICAgICAgc2hvdWxkLmV4aXN0KHZlcnNpb24pO1xuICAgICAgXy5pc1N0cmluZyh2ZXJzaW9uKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIHZlcnNpb25SRS50ZXN0KHZlcnNpb24pLnNob3VsZC5iZS50cnVlO1xuICAgICAgKGFmdGVyLWJlZm9yZSkuc2hvdWxkLmJlLmF0Lm1vc3QoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgcGFyc2VkIHZlcnNpb24nLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgbm9uUGFyc2VkVmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldFZlcnNpb24oKTtcbiAgICAgIGxldCB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbih0cnVlKTtcbiAgICAgIHNob3VsZC5leGlzdCh2ZXJzaW9uKTtcbiAgICAgIF8uaXNTdHJpbmcodmVyc2lvbi52ZXJzaW9uU3RyaW5nKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIHZlcnNpb24udmVyc2lvblN0cmluZy5zaG91bGQuZXFsKG5vblBhcnNlZFZlcnNpb24pO1xuXG4gICAgICBwYXJzZUZsb2F0KHZlcnNpb24udmVyc2lvbkZsb2F0KS5zaG91bGQuZXF1YWwodmVyc2lvbi52ZXJzaW9uRmxvYXQpO1xuICAgICAgcGFyc2VJbnQodmVyc2lvbi5tYWpvcikuc2hvdWxkLmVxdWFsKHZlcnNpb24ubWFqb3IpO1xuICAgICAgcGFyc2VJbnQodmVyc2lvbi5taW5vcikuc2hvdWxkLmVxdWFsKHZlcnNpb24ubWlub3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGNsZWFyIHRoZSBjYWNoZSBpZiBhc2tlZCB0bycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICB4Y29kZS5jbGVhckludGVybmFsQ2FjaGUoKTtcblxuICAgIGxldCBiZWZvcmUgPSBuZXcgRGF0ZSgpO1xuICAgIGF3YWl0IHhjb2RlLmdldFBhdGgoKTtcbiAgICBsZXQgYWZ0ZXIgPSBuZXcgRGF0ZSgpO1xuICAgIChhZnRlci1iZWZvcmUpLnNob3VsZC5iZS5hdC5sZWFzdCg2KTtcblxuICB9KTtcblxuICBpdCgnc2hvdWxkIGdldCBtYXggaU9TIFNESyB2ZXJzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG5cbiAgICBzaG91bGQuZXhpc3QodmVyc2lvbik7XG4gICAgKHR5cGVvZiB2ZXJzaW9uKS5zaG91bGQuZXF1YWwoJ3N0cmluZycpO1xuICAgIChwYXJzZUZsb2F0KHZlcnNpb24pLTYuMSkuc2hvdWxkLmJlLmF0LmxlYXN0KDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGdldCBhIGxpc3Qgb2YgaU9TIGRldmljZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGRldmljZXMgPSBhd2FpdCB4Y29kZS5nZXRDb25uZWN0ZWREZXZpY2VzKCk7XG4gICAgc2hvdWxkLmV4aXN0KGRldmljZXMpO1xuICAgICh0eXBlb2YgZGV2aWNlcykuc2hvdWxkLmVxdWFsKCdvYmplY3QnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgdGhlIHBhdGggdG8gaW5zdHJ1bWVudHMgYmluYXJ5JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBpbnN0cnVtZW50c1BhdGggPSBhd2FpdCB4Y29kZS5nZXRJbnN0cnVtZW50c1BhdGgoKTtcblxuICAgIHNob3VsZC5leGlzdChpbnN0cnVtZW50c1BhdGgpO1xuICAgICh0eXBlb2YgaW5zdHJ1bWVudHNQYXRoKS5zaG91bGQuZXF1YWwoJ3N0cmluZycpO1xuICAgIGluc3RydW1lbnRzUGF0aC5sZW5ndGguc2hvdWxkLmJlLmFib3ZlKDMpO1xuICAgIGF3YWl0IGZzLmV4aXN0cyhpbnN0cnVtZW50c1BhdGgpO1xuICB9KTtcblxuICBkZXNjcmliZSgndWkgYXV0b21hdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICBiZWZvcmUoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRWZXJzaW9uKHRydWUpO1xuICAgICAgaWYgKHZlcnNpb24ubWFqb3IgPj0gOCkge1xuICAgICAgICB0aGlzLnNraXAoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGZpbmQgdGhlIGF1dG9tYXRpb24gdHJhY2UgdGVtcGxhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcGF0aCA9IGF3YWl0IHhjb2RlLmdldEF1dG9tYXRpb25UcmFjZVRlbXBsYXRlUGF0aCgpO1xuXG4gICAgICBzaG91bGQuZXhpc3QocGF0aCk7XG4gICAgICBhd2FpdCBmcy5leGlzdHMocGF0aCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUudHJ1ZTtcbiAgICAgIGxldCBzdWZmaXggPSBcIi50cmFjZXRlbXBsYXRlXCI7XG4gICAgICBwYXRoLnNsaWNlKC1zdWZmaXgubGVuZ3RoKS5zaG91bGQuZXF1YWwoc3VmZml4KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==